version: "3"
services:
  postgres:
    image: postgres:14
    restart: always
    environment:
      TZ: "Asia/Shanghai"
      POSTGRES_DB: "testdb"
      POSTGRES_USER: "postgres"
      POSTGRES_PASSWORD: "postgres"
    ports:
      - "5432:5432"
    volumes:
      - ./data/postgresql:/var/lib/postgresql/data


  # flow:
  #   image: nodered/node-red:2.2.3
  #   environment:
  #     - TZ=Asia/Shanghai
  #   ports:
  #     - "1880:1880"
  #   # networks:
  #   #   - node-red-net
  #   volumes:
  #     - ./data/flows:/data
  #   restart: always

  redis:
    container_name: remoting_redis
    image: redis:6.2.5
    ports:
      - "6379:6379"
    volumes:
      - ./data/redis.conf:/usr/local/etc/redis/redis.conf
      - ./data/redis/data:/data
    restart: always

  # mqtt:
  #   container_name: remoting_mqtt
  #   image: eclipse-mosquitto
  #   volumes:
  #     - ./mosquitto.conf:/mosquitto/config/mosquitto.conf
  #   ports:
  #     - "1883:1883"
  #     - "9001:9001"
  #   restart: always


  emqx:
    image: emqx/emqx:5.0.4
    container_name: emqx
    environment:
      - EMQX_LOADED_PLUGINS="emqx_management,emqx_auth_http,emqx_dashboard"
      - EMQX_DASHBOARD__DEFAULT_USER__LOGIN=zyhh
      - EMQX_DASHBOARD__DEFAULT_USER__PASSWORD=zyhh.com
      - EMQX_NODE__MAX_PORTS=65535
      - EMQX_MQTT__MAX_PACKET_SIZE=16MB
    ports:
      - "18083:18083"
      - "1883:1883"
      - "8083:8083"
      - "8883:8883"
    volumes:
      - ./logs:/opt/emqx/log
    restart: always


  # networks:
  #   emqx-bridge:
  #     driver: bridge

  # nginx:
  #     image: nginx:1.22
  #     restart: always
  #     ports:
  #       - 80:80
  #       - 1883:1883
  #     volumes:
  #       - ./nginx.conf:/etc/nginx/nginx.conf
  #       - ./nginx/logs:/var/log/nginx
  #       - ./nginx/conf.d:/etc/nginx/conf.d

  # emqx1:
  #   image: emqx/emqx:5.0.4
  #   container_name: emqx1
  #   environment:
  #     - "EMQX_NODE_NAME=emqx@node1.emqx.io"
  #     - "EMQX_CLUSTER__DISCOVERY_STRATEGY=static"
  #     - "EMQX_DASHBOARD__DEFAULT_USER__LOGIN=zyhh"
  #     - "EMQX_DASHBOARD__DEFAULT_USER__PASSWORD=zyhh.com"
  #     - "EMQX_CLUSTER__STATIC__SEEDS=[emqx@node1.emqx.io,emqx@node2.emqx.io]"
  #   healthcheck:
  #     test: [ "CMD", "/opt/emqx/bin/emqx_ctl", "status" ]
  #     interval: 5s
  #     timeout: 25s
  #     retries: 5
  #   ports:
  #     - "18083:18083"
  #     - "1883:1883"
  #     - "8083:8083"
  #     - "8883:8883"
  #   networks:
  #     emqx-bridge:
  #       aliases:
  #         - node1.emqx.io

  # emqx2:
  #   image: emqx/emqx:5.0.4
  #   container_name: emqx2
  #   environment:
  #     - "EMQX_NODE_NAME=emqx@node2.emqx.io"
  #     - "EMQX_CLUSTER__DISCOVERY_STRATEGY=static"
  #     - "EMQX_DASHBOARD__DEFAULT_USER__LOGIN=zyhh"
  #     - "EMQX_DASHBOARD__DEFAULT_USER__PASSWORD=zyhh.com"
  #     - "EMQX_CLUSTER__STATIC__SEEDS=[emqx@node1.emqx.io,emqx@node2.emqx.io]"
  #   healthcheck:
  #     test: [ "CMD", "/opt/emqx/bin/emqx_ctl", "status" ]
  #     interval: 5s
  #     timeout: 25s
  #     retries: 5
  #   ports:
  #     - "18084:18083"
  #     - "1884:1883"
  #     - "8084:8083"
  #     - "8884:8883"
  #   networks:
  #     emqx-bridge:
  #       aliases:
  #         - node2.emqx.io

  # volumes:
  #   node-red-data:


  # networks:
  #   emqx-bridge:
  #     driver: bridge
  #   node-red-net:

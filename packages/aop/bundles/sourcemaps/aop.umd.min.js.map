{"version":3,"sources":["aop.umd.min.js"],"names":["global","factory","exports","module","require","define","amd","aop","umd","js","tslib_1","this","core_1","unwrapExports","x","__esModule","Object","prototype","hasOwnProperty","call","createCommonjsModule","fn","AopActions_1","AopActions","defineProperty","value","IAdvisor","AdvisorToken","InjectToken","RegistAspectAction_1","RegistAspectAction","_super","registAspect","__extends","working","container","data","type","targetType","matchs","getLifeScope","getClassDecorators","surm","actions","includes","hasOwnClassMetadata","name","aspectMgr","get","raiseContainer","forEach","metadata","getOwnTypeMetadata","Array","isArray","length","meta","isClass","add","classAnnations","params","constructor","ActionComposite","Advice","createAdviceDecorator","adviceName","adapter","afterPointcutAdapter","metadataExtends","createMethodDecorator","args","next","match","arg","isString","isRegExp","setMetadata","pointcut","annotationArgName","annotationName","Aspect","createClassDecorator","annotation","within","After","AfterReturning","returning","AfterThrowing","throwing","Around","Before","Pointcut","NonePointcut","decorators","__exportStar","isValideAspectTarget_1","isValideAspectTarget","String","Date","Boolean","Number","IAdvisorChainFactory","AdvisorChainFactoryToken","JoinpointState_1","JoinpointState","IJoinpoint","JoinpointToken","Joinpoint_1","Joinpoint","options","provJoinpoint","fullName","state","advicer","annotations","target","__decorate","Injectable","__metadata","joinpoints","IAdvisorChain","AdvisorChainToken","AdvisorChainFactory_1","AdvisorChainFactory","advisor","advices","getAdvicers","adviceType","invoaction","joinPoint","valueOrthrowing","undefined","before","after","afterThrowing","afterReturning","_this","cloneJp","lang","assign","invokeAdvice","isUndefined","advChain","resolve","jp","process","_a","providers","push","Provider","createExtends","inst","provider","_cache_JoinPoint","advice","create","curj","d_1","test","filter","a","decorator","getContainer","aspectType","syncInvoke","apply","propertyKey","concat","__param","Inject","ContainerToken","IAdvisorProceeding","AdvisorProceedingToken","AdvisorChain_1","AdvisorChain","action","getRecognizer","RecognizerToken","alias","recognize","proceeding","IProxyMethod","ProxyMethodToken","ProxyMethod_1","joinpoints_2","ProxyMethod","_advisor","enumerable","configurable","_liefScope","proceed","methodName","getAdvices","descriptor","set","getMethod","bind","proxy","setMethod","isFunction","propertyMethod","liefScope","_i","arguments","val","exeErr","getMethodMetadatas","getMethodParameters","adChain","err","Singleton","ReturningType_1","ReturningType","AsyncPromiseProceeding_1","AsyncPromiseProceeding","then","returningValue","Promise","promise","AsyncObservableProceeding_1","AsyncObservableProceeding","flatMap","isObservable","isPromise","observable","ReturningRecognizer_1","ReturningRecognizer","sync","SyncProceeding_1","SyncProceeding","access","BindMethodPointcutAction_1","BindMethodPointcutAction","bindMethodPointcut","hasRegister","toString","className","getClassName","methods","getOwnPropertyDescriptors","forIn","item","allmethods","getParamerterNames","InvokeBeforeConstructorAction_1","InvokeBeforeConstructorAction","providerMap","InvokeAfterConstructorAction_1","InvokeAfterConstructorAction","invokeAfterConstructorAdvices","IAdviceMatcher","AdviceMatcherToken","MatchPointcutAction_1","MatchPointcutAction","matchPointcut","matcher","aspects","adviceMetas","mpt","setAdvices","some","isAdviceEquals","advice1","advice2","AopActionFactory_1","AopActionFactory","invokeBeforeConstructorAdvices","exetndsInstance","ExetndsInstanceAction","ExetndsInstanceAction_1","p","ExtendsProvider","extends","Advisor_1","Advisor","MapSet","aspectIocs","key","has","hasRegisterAdvices","keys","m","aspect","metas","getOwnMethodMetadata","defaultContainer","AdviceMatcher_1","AdviceMatcher","aspectMeta","first","indexOf","anno","matched","adviceNames","advices_1","n","adv","matchAspectSelf","points_1","decorators_2","name_1","getOwnPropertyNames","filterPointcut","substring","startsWith","points","matchedPointcut","match_1","matchTypeFactory","map","expresses","method","hasOwnMethodMetadata","pointcuts","trim","tranlateExpress","pointcutReg_1","source","Reflect","getMetadataKeys","mergeExpress","spiltBrace","strExp","expressToFunc","exp","annotation_1","replace","matcher_1","RegExp","classnames_1","split","torken_1","getTokenImpl","idxOr","idxAd","leftExp","rightExp","flag","express","idx","rel","AopModule_1","AopModule","setup","register","lifeScope","LifeScopeToken","addAction","IocState","design","runtime","LifeState","beforeConstructor","AfterInit","onInit","afterConstructor","registerDecorator","IocExt"],"mappings":"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","file":"../aop.umd.min.js","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('tslib'), require('@ts-ioc/core')) :\n\ttypeof define === 'function' && define.amd ? define(['tslib', '@ts-ioc/core'], factory) :\n\t(global.aop = global.aop || {}, global.aop.umd = global.aop.umd || {}, global.aop.umd.js = factory(global.tslib_1,global['@ts-ioc/core']));\n}(this, (function (tslib_1,core_1) { 'use strict';\n\ntslib_1 = tslib_1 && tslib_1.hasOwnProperty('default') ? tslib_1['default'] : tslib_1;\ncore_1 = core_1 && core_1.hasOwnProperty('default') ? core_1['default'] : core_1;\n\nfunction unwrapExports (x) {\n\treturn x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;\n}\n\nfunction createCommonjsModule(fn, module) {\n\treturn module = { exports: {} }, fn(module, module.exports), module.exports;\n}\n\nvar AopActions_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * aop actions.\n *\n * @export\n * @enum {number}\n */\nvar AopActions;\n(function (AopActions) {\n    /**\n     * register aspect service.\n     */\n    AopActions[\"registAspect\"] = \"registAspect\";\n    /**\n     * extends intstance.\n     */\n    AopActions[\"exetndsInstance\"] = \"exetndsInstance\";\n    /**\n     * match pointcut.\n     */\n    AopActions[\"matchPointcut\"] = \"matchPointcut\";\n    /**\n     * bind property pointcut.\n     */\n    AopActions[\"bindPropertyPointcut\"] = \"bindPropertyPointcut\";\n    /**\n     * bind method pointcut for instance.\n     */\n    AopActions[\"bindMethodPointcut\"] = \"bindMethodPointcut\";\n    AopActions[\"invokeBeforeConstructorAdvices\"] = \"invokeBeforeConstructorAdvices\";\n    AopActions[\"invokeAfterConstructorAdvices\"] = \"invokeAfterConstructorAdvices\";\n})(AopActions = exports.AopActions || (exports.AopActions = {}));\n\n\n\n\n});\n\nunwrapExports(AopActions_1);\nvar AopActions_2 = AopActions_1.AopActions;\n\nvar IAdvisor = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aop IAdvisor interface token.\n * it is a token id, you can register yourself IAdvisor for this.\n */\nexports.AdvisorToken = new core_1.InjectToken('DI_IAdvisor');\n\n\n\n\n});\n\nunwrapExports(IAdvisor);\nvar IAdvisor_1 = IAdvisor.AdvisorToken;\n\nvar RegistAspectAction_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n/**\n * regist aspect action.\n *\n * @export\n * @class RegistAspectAction\n * @extends {ActionComposite}\n */\nvar RegistAspectAction = /** @class */ (function (_super) {\n    tslib_1.__extends(RegistAspectAction, _super);\n    function RegistAspectAction() {\n        return _super.call(this, AopActions_1.AopActions.registAspect) || this;\n    }\n    RegistAspectAction.prototype.working = function (container, data) {\n        var type = data.targetType;\n        var lifeScope = container.getLifeScope();\n        var matchs = lifeScope.getClassDecorators(function (surm) { return surm.actions.includes(AopActions_1.AopActions.registAspect) && core_1.hasOwnClassMetadata(surm.name, type); });\n        var aspectMgr = container.get(IAdvisor.AdvisorToken);\n        var raiseContainer = data.raiseContainer || container;\n        matchs.forEach(function (surm) {\n            var metadata = core_1.getOwnTypeMetadata(surm.name, type);\n            if (Array.isArray(metadata) && metadata.length > 0) {\n                metadata.forEach(function (meta) {\n                    if (core_1.isClass(meta.type)) {\n                        aspectMgr.add(meta.type, raiseContainer);\n                    }\n                });\n            }\n        });\n    };\n    RegistAspectAction.classAnnations = { \"name\": \"RegistAspectAction\", \"params\": { \"constructor\": [], \"working\": [\"container\", \"data\"] } };\n    return RegistAspectAction;\n}(core_1.ActionComposite));\nexports.RegistAspectAction = RegistAspectAction;\n\n\n\n\n});\n\nunwrapExports(RegistAspectAction_1);\nvar RegistAspectAction_2 = RegistAspectAction_1.RegistAspectAction;\n\nvar Advice = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\nfunction createAdviceDecorator(adviceName, adapter, afterPointcutAdapter, metadataExtends) {\n    return core_1.createMethodDecorator('Advice', function (args) {\n        if (adapter) {\n            adapter(args);\n        }\n        args.next({\n            match: function (arg) { return core_1.isString(arg) || core_1.isRegExp(arg); },\n            setMetadata: function (metadata, arg) {\n                metadata.pointcut = arg;\n            }\n        });\n        if (afterPointcutAdapter) {\n            afterPointcutAdapter(args);\n        }\n        args.next({\n            match: function (arg) { return core_1.isString(arg); },\n            setMetadata: function (metadata, arg) {\n                metadata.annotationArgName = arg;\n            }\n        });\n        args.next({\n            match: function (arg) { return core_1.isString(arg); },\n            setMetadata: function (metadata, arg) {\n                metadata.annotationName = arg;\n            }\n        });\n    }, function (metadata) {\n        if (metadataExtends) {\n            metadata = metadataExtends(metadata);\n        }\n        metadata.adviceName = adviceName;\n        return metadata;\n    });\n}\nexports.createAdviceDecorator = createAdviceDecorator;\n/**\n * aop advice decorator.\n *\n * @Advice\n */\nexports.Advice = createAdviceDecorator('Advice');\n\n\n\n\n});\n\nunwrapExports(Advice);\nvar Advice_1 = Advice.createAdviceDecorator;\nvar Advice_2 = Advice.Advice;\n\nvar Aspect = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aspect decorator. define aspect service.\n *\n * @Aspect\n */\nexports.Aspect = core_1.createClassDecorator('Aspect', function (args) {\n    args.next({\n        match: function (arg) { return core_1.isString(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.annotation = arg;\n        }\n    });\n    args.next({\n        match: function (arg) { return core_1.isArray(arg) || core_1.isClass(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.within = arg;\n        }\n    });\n});\n\n\n\n\n});\n\nunwrapExports(Aspect);\nvar Aspect_1 = Aspect.Aspect;\n\nvar After = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * aop after advice decorator.\n *\n * @After\n */\nexports.After = Advice.createAdviceDecorator('After');\n\n\n\n\n});\n\nunwrapExports(After);\nvar After_1 = After.After;\n\nvar AfterReturning = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n/**\n * aop after returning advice decorator.\n *\n * @AfterReturning\n */\nexports.AfterReturning = Advice.createAdviceDecorator('AfterReturning', null, function (args) {\n    args.next({\n        match: function (arg) { return core_1.isString(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.returning = arg;\n        }\n    });\n});\n\n\n\n\n});\n\nunwrapExports(AfterReturning);\nvar AfterReturning_1 = AfterReturning.AfterReturning;\n\nvar AfterThrowing = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n/**\n * aop after throwing advice decorator.\n *\n * @AfterThrowing\n */\nexports.AfterThrowing = Advice.createAdviceDecorator('AfterThrowing', null, function (args) {\n    args.next({\n        match: function (arg) { return core_1.isString(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.throwing = arg;\n        }\n    });\n});\n\n\n\n\n});\n\nunwrapExports(AfterThrowing);\nvar AfterThrowing_1 = AfterThrowing.AfterThrowing;\n\nvar Around = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n/**\n * aop Around advice decorator.\n *\n * @Around\n */\nexports.Around = Advice.createAdviceDecorator('Around', null, function (args) {\n    args.next({\n        match: function (arg) { return core_1.isString(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.args = arg;\n        }\n    });\n    args.next({\n        match: function (arg) { return core_1.isString(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.returning = arg;\n        }\n    });\n    args.next({\n        match: function (arg) { return core_1.isString(arg); },\n        setMetadata: function (metadata, arg) {\n            metadata.throwing = arg;\n        }\n    });\n});\n\n\n\n\n});\n\nunwrapExports(Around);\nvar Around_1 = Around.Around;\n\nvar Before = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * aop Before advice decorator.\n *\n * @Before\n */\nexports.Before = Advice.createAdviceDecorator('Before');\n\n\n\n\n});\n\nunwrapExports(Before);\nvar Before_1 = Before.Before;\n\nvar Pointcut = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * aop Pointcut advice decorator.\n *\n * @Pointcut\n */\nexports.Pointcut = Advice.createAdviceDecorator('Pointcut');\n\n\n\n\n});\n\nunwrapExports(Pointcut);\nvar Pointcut_1 = Pointcut.Pointcut;\n\nvar NonePointcut = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * NonePointcut decorator, define class not work with aop.\n *\n * @NonePointcut\n */\nexports.NonePointcut = core_1.createClassDecorator('NonePointcut');\n\n\n\n\n});\n\nunwrapExports(NonePointcut);\nvar NonePointcut_1 = NonePointcut.NonePointcut;\n\nvar decorators = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\ntslib_1.__exportStar(Advice, exports);\ntslib_1.__exportStar(Aspect, exports);\ntslib_1.__exportStar(After, exports);\ntslib_1.__exportStar(AfterReturning, exports);\ntslib_1.__exportStar(AfterThrowing, exports);\ntslib_1.__exportStar(Around, exports);\ntslib_1.__exportStar(Before, exports);\ntslib_1.__exportStar(Pointcut, exports);\ntslib_1.__exportStar(NonePointcut, exports);\n\n\n\n\n});\n\nunwrapExports(decorators);\n\nvar isValideAspectTarget_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n/**\n * is target can aspect or not.\n *\n * @export\n * @param {Type<any>} targetType\n * @returns {boolean}\n */\nfunction isValideAspectTarget(targetType) {\n    if (!core_1.isClass(targetType)\n        || targetType === Object\n        || targetType === String\n        || targetType === Date\n        || targetType === Boolean\n        || targetType === Number) {\n        return false;\n    }\n    if (core_1.hasOwnClassMetadata(decorators.NonePointcut, targetType)) {\n        return false;\n    }\n    return true;\n}\nexports.isValideAspectTarget = isValideAspectTarget;\n\n\n\n\n});\n\nunwrapExports(isValideAspectTarget_1);\nvar isValideAspectTarget_2 = isValideAspectTarget_1.isValideAspectTarget;\n\nvar IAdvisorChainFactory = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aop IAdvisorChainFactory interface token.\n * it is a token id, you can register yourself IAdvisorChainFactory for this.\n */\nexports.AdvisorChainFactoryToken = new core_1.InjectToken('DI_IAdvisorChainFactory');\n\n\n\n\n});\n\nunwrapExports(IAdvisorChainFactory);\nvar IAdvisorChainFactory_1 = IAdvisorChainFactory.AdvisorChainFactoryToken;\n\nvar JoinpointState_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar JoinpointState;\n(function (JoinpointState) {\n    JoinpointState[\"Before\"] = \"Before\";\n    JoinpointState[\"Pointcut\"] = \"Pointcut\";\n    JoinpointState[\"After\"] = \"After\";\n    JoinpointState[\"AfterReturning\"] = \"AfterReturning\";\n    JoinpointState[\"AfterThrowing\"] = \"AfterThrowing\";\n})(JoinpointState = exports.JoinpointState || (exports.JoinpointState = {}));\n\n\n\n\n});\n\nunwrapExports(JoinpointState_1);\nvar JoinpointState_2 = JoinpointState_1.JoinpointState;\n\nvar IJoinpoint = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n* Aop IJoinpoint interface token.\n* it is a token id, you can register yourself IJoinpoint for this.\n*/\nexports.JoinpointToken = new core_1.InjectToken('DI_IJoinpoint');\n\n\n\n\n});\n\nunwrapExports(IJoinpoint);\nvar IJoinpoint_1 = IJoinpoint.JoinpointToken;\n\nvar Joinpoint_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n/**\n * Join point data.\n *\n * @export\n * @class Joinpoint\n * @implements {IJoinpoint}\n */\nvar Joinpoint = /** @class */ (function () {\n    function Joinpoint(options) {\n        this.provJoinpoint = options.provJoinpoint;\n        this.name = options.name;\n        this.fullName = options.fullName;\n        this.params = options.params || [];\n        this.args = options.args;\n        this.returning = options.returning;\n        this.throwing = options.throwing;\n        this.state = options.state;\n        this.advicer = options.advicer;\n        this.annotations = options.annotations;\n        this.target = options.target;\n        this.targetType = options.targetType;\n    }\n    Joinpoint.classAnnations = { \"name\": \"Joinpoint\", \"params\": { \"constructor\": [\"options\"] } };\n    Joinpoint = tslib_1.__decorate([\n        core_1.Injectable(IJoinpoint.JoinpointToken),\n        decorators.NonePointcut(),\n        tslib_1.__metadata(\"design:paramtypes\", [Object])\n    ], Joinpoint);\n    return Joinpoint;\n}());\nexports.Joinpoint = Joinpoint;\n\n\n\n\n});\n\nunwrapExports(Joinpoint_1);\nvar Joinpoint_2 = Joinpoint_1.Joinpoint;\n\nvar joinpoints = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\ntslib_1.__exportStar(JoinpointState_1, exports);\ntslib_1.__exportStar(IJoinpoint, exports);\ntslib_1.__exportStar(Joinpoint_1, exports);\n\n\n\n\n});\n\nunwrapExports(joinpoints);\n\nvar IAdvisorChain = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aop IAdvisorChain interface token.\n * it is a token id, you can register yourself IAdvisorChain for this.\n */\nexports.AdvisorChainToken = new core_1.InjectToken('DI_IAdvisorChain');\n\n\n\n\n});\n\nunwrapExports(IAdvisorChain);\nvar IAdvisorChain_1 = IAdvisorChain.AdvisorChainToken;\n\nvar AdvisorChainFactory_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n\nvar AdvisorChainFactory = /** @class */ (function () {\n    function AdvisorChainFactory(container, advisor, advices) {\n        this.container = container;\n        this.advisor = advisor;\n        this.advices = advices;\n    }\n    AdvisorChainFactory.prototype.getAdvicers = function (adviceType) {\n        return (adviceType ? this.advices[adviceType] : null) || [];\n    };\n    AdvisorChainFactory.prototype.invoaction = function (joinPoint, state, valueOrthrowing) {\n        joinPoint.state = state;\n        joinPoint.returning = undefined;\n        joinPoint.throwing = undefined;\n        switch (state) {\n            case joinpoints.JoinpointState.Before:\n                this.before(joinPoint);\n                break;\n            case joinpoints.JoinpointState.Pointcut:\n                this.pointcut(joinPoint);\n                break;\n            case joinpoints.JoinpointState.After:\n                joinPoint.returning = valueOrthrowing;\n                this.after(joinPoint);\n                break;\n            case joinpoints.JoinpointState.AfterThrowing:\n                joinPoint.throwing = valueOrthrowing;\n                this.afterThrowing(joinPoint);\n                break;\n            case joinpoints.JoinpointState.AfterReturning:\n                joinPoint.returning = valueOrthrowing;\n                this.afterReturning(joinPoint);\n                break;\n        }\n    };\n    AdvisorChainFactory.prototype.before = function (joinPoint) {\n        var _this = this;\n        var cloneJp = core_1.lang.assign({}, joinPoint);\n        this.getAdvicers('Around')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n        if (!core_1.isUndefined(cloneJp.args)) {\n            joinPoint.args = cloneJp.args;\n        }\n        this.getAdvicers('Before')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n    };\n    AdvisorChainFactory.prototype.pointcut = function (joinPoint) {\n        var _this = this;\n        var cloneJp = core_1.lang.assign({}, joinPoint);\n        this.getAdvicers('Pointcut')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n        if (!core_1.isUndefined(cloneJp.args)) {\n            joinPoint.args = cloneJp.args;\n        }\n    };\n    AdvisorChainFactory.prototype.after = function (joinPoint) {\n        var _this = this;\n        var cloneJp = core_1.lang.assign({}, joinPoint);\n        this.getAdvicers('Around')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n        this.getAdvicers('After')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n    };\n    AdvisorChainFactory.prototype.afterThrowing = function (joinPoint) {\n        var _this = this;\n        var cloneJp = core_1.lang.assign({}, joinPoint);\n        this.getAdvicers('Around')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n        this.getAdvicers('AfterThrowing')\n            .forEach(function (advicer) {\n            _this.invokeAdvice(cloneJp, advicer);\n        });\n    };\n    AdvisorChainFactory.prototype.afterReturning = function (joinPoint) {\n        var _this = this;\n        var cloneJp = core_1.lang.assign({}, joinPoint);\n        var advChain = this.container.resolve(IAdvisorChain.AdvisorChainToken, { joinPoint: cloneJp });\n        this.getAdvicers('Around')\n            .forEach(function (advicer) {\n            advChain.next(function (jp) {\n                return _this.invokeAdvice(jp, advicer);\n            });\n        });\n        this.getAdvicers('AfterReturning')\n            .forEach(function (advicer) {\n            advChain.next(function (jp) {\n                return _this.invokeAdvice(jp, advicer);\n            });\n        });\n        advChain.next(function (jp) {\n            if (!core_1.isUndefined(jp.returning)) {\n                joinPoint.returning = jp.returning;\n            }\n            return joinPoint;\n        });\n        advChain.process();\n    };\n    AdvisorChainFactory.prototype.invokeAdvice = function (joinPoint, advicer) {\n        var _this = this;\n        var _a;\n        var providers = [];\n        providers.push(core_1.Provider.createExtends(joinpoints.Joinpoint, joinPoint, function (inst, provider) {\n            inst._cache_JoinPoint = provider.resolve(_this.container);\n        }));\n        var metadata = advicer.advice;\n        if (!core_1.isUndefined(joinPoint.args) && metadata.args) {\n            providers.push(core_1.Provider.create(metadata.args, joinPoint.args));\n        }\n        if (metadata.annotationArgName) {\n            providers.push(core_1.Provider.create(metadata.annotationArgName, function () {\n                var curj = joinPoint;\n                var annotations = curj.annotations;\n                while (!annotations && joinPoint.provJoinpoint) {\n                    curj = joinPoint.provJoinpoint;\n                    if (curj && curj.annotations) {\n                        annotations = curj.annotations;\n                        break;\n                    }\n                }\n                if (core_1.isArray(annotations)) {\n                    if (metadata.annotationName) {\n                        var d_1 = metadata.annotationName;\n                        d_1 = /^@/.test(d_1) ? d_1 : \"@\" + d_1;\n                        return annotations.filter(function (a) { return a.decorator === d_1; });\n                    }\n                    return annotations;\n                }\n                else {\n                    return [];\n                }\n            }));\n        }\n        if (!core_1.isUndefined(joinPoint.returning) && metadata.returning) {\n            providers.push(core_1.Provider.create(metadata.returning, joinPoint.returning));\n        }\n        if (!core_1.isUndefined(joinPoint.throwing) && metadata.throwing) {\n            providers.push(core_1.Provider.create(metadata.throwing, joinPoint.throwing));\n        }\n        return (_a = this.advisor.getContainer(advicer.aspectType, this.container)).syncInvoke.apply(_a, [advicer.aspectType, advicer.advice.propertyKey, null].concat(providers));\n    };\n    AdvisorChainFactory.classAnnations = { \"name\": \"AdvisorChainFactory\", \"params\": { \"constructor\": [\"container\", \"advisor\", \"advices\"], \"getAdvicers\": [\"adviceType\"], \"invoaction\": [\"joinPoint\", \"state\", \"valueOrthrowing\"], \"before\": [\"joinPoint\"], \"pointcut\": [\"joinPoint\"], \"after\": [\"joinPoint\"], \"afterThrowing\": [\"joinPoint\"], \"afterReturning\": [\"joinPoint\"], \"invokeAdvice\": [\"joinPoint\", \"advicer\"] } };\n    AdvisorChainFactory = tslib_1.__decorate([\n        decorators.NonePointcut(),\n        core_1.Injectable(IAdvisorChainFactory.AdvisorChainFactoryToken),\n        tslib_1.__param(0, core_1.Inject(core_1.ContainerToken)), tslib_1.__param(1, core_1.Inject(IAdvisor.AdvisorToken)),\n        tslib_1.__metadata(\"design:paramtypes\", [Object, Object, Object])\n    ], AdvisorChainFactory);\n    return AdvisorChainFactory;\n}());\nexports.AdvisorChainFactory = AdvisorChainFactory;\n\n\n\n\n});\n\nunwrapExports(AdvisorChainFactory_1);\nvar AdvisorChainFactory_2 = AdvisorChainFactory_1.AdvisorChainFactory;\n\nvar IAdvisorProceeding = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aop IAdvisorProceeding interface token.\n * it is a token id, you can register yourself IAdvisorProceeding for this.\n */\nexports.AdvisorProceedingToken = new core_1.InjectToken('DI_IAdvisorProceeding');\n\n\n\n\n});\n\nunwrapExports(IAdvisorProceeding);\nvar IAdvisorProceeding_1 = IAdvisorProceeding.AdvisorProceedingToken;\n\nvar AdvisorChain_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\nvar AdvisorChain = /** @class */ (function () {\n    function AdvisorChain(joinPoint) {\n        this.joinPoint = joinPoint;\n        this.actions = [];\n    }\n    AdvisorChain.prototype.next = function (action) {\n        this.actions.push(action);\n    };\n    AdvisorChain.prototype.getRecognizer = function () {\n        return this.container.get(core_1.RecognizerToken, this.joinPoint.state);\n    };\n    AdvisorChain.prototype.process = function () {\n        var _a;\n        var alias = this.getRecognizer().recognize(this.joinPoint.returning);\n        (_a = this.container.get(IAdvisorProceeding.AdvisorProceedingToken, alias)).proceeding.apply(_a, [this.joinPoint].concat(this.actions));\n    };\n    AdvisorChain.classAnnations = { \"name\": \"AdvisorChain\", \"params\": { \"constructor\": [\"joinPoint\"], \"next\": [\"action\"], \"getRecognizer\": [], \"process\": [] } };\n    tslib_1.__decorate([\n        core_1.Inject(core_1.ContainerToken),\n        tslib_1.__metadata(\"design:type\", Object)\n    ], AdvisorChain.prototype, \"container\", void 0);\n    AdvisorChain = tslib_1.__decorate([\n        decorators.NonePointcut(),\n        core_1.Injectable(IAdvisorChain.AdvisorChainToken),\n        tslib_1.__metadata(\"design:paramtypes\", [joinpoints.Joinpoint])\n    ], AdvisorChain);\n    return AdvisorChain;\n}());\nexports.AdvisorChain = AdvisorChain;\n\n\n\n\n});\n\nunwrapExports(AdvisorChain_1);\nvar AdvisorChain_2 = AdvisorChain_1.AdvisorChain;\n\nvar IProxyMethod = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aop proxy method interface token.\n * it is a token id, you can register yourself IProxyMethod for this.\n */\nexports.ProxyMethodToken = new core_1.InjectToken('DI_IProxyMethod');\n\n\n\n\n});\n\nunwrapExports(IProxyMethod);\nvar IProxyMethod_1 = IProxyMethod.ProxyMethodToken;\n\nvar ProxyMethod_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\nvar joinpoints_2 = joinpoints;\n\n\n\n\nvar ProxyMethod = /** @class */ (function () {\n    function ProxyMethod(container) {\n        this.container = container;\n    }\n    Object.defineProperty(ProxyMethod.prototype, \"advisor\", {\n        get: function () {\n            if (!this._advisor) {\n                this._advisor = this.container.get(IAdvisor.AdvisorToken);\n            }\n            return this._advisor;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(ProxyMethod.prototype, \"liefScope\", {\n        get: function () {\n            if (!this._liefScope) {\n                this._liefScope = this.container.getLifeScope();\n            }\n            return this._liefScope;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ProxyMethod.prototype.proceed = function (target, targetType, pointcut, provJoinpoint) {\n        var aspectMgr = this.advisor;\n        var fullName = pointcut.fullName;\n        var methodName = pointcut.name;\n        var advices = aspectMgr.getAdvices(fullName);\n        if (advices && pointcut) {\n            if (pointcut.descriptor && (pointcut.descriptor.get || pointcut.descriptor.set)) {\n                if (pointcut.descriptor.get) {\n                    var getMethod = pointcut.descriptor.get.bind(target);\n                    pointcut.descriptor.get = this.proxy(getMethod, advices, target, targetType, pointcut, provJoinpoint);\n                }\n                if (pointcut.descriptor.set) {\n                    var setMethod = pointcut.descriptor.set.bind(target);\n                    pointcut.descriptor.set = this.proxy(setMethod, advices, target, targetType, pointcut, provJoinpoint);\n                }\n                Object.defineProperty(target, methodName, pointcut.descriptor);\n            }\n            else if (core_1.isFunction(target[methodName])) {\n                var propertyMethod = target[methodName].bind(target);\n                target[methodName] = this.proxy(propertyMethod, advices, target, targetType, pointcut, provJoinpoint);\n            }\n        }\n    };\n    ProxyMethod.prototype.proxy = function (propertyMethod, advices, target, targetType, pointcut, provJoinpoint) {\n        var _this = this;\n        var fullName = pointcut.fullName;\n        var methodName = pointcut.name;\n        var liefScope = this.liefScope;\n        var container = this.container;\n        return function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            var joinPoint = _this.container.resolve(joinpoints_2.Joinpoint, core_1.Provider.create('options', {\n                name: methodName,\n                fullName: fullName,\n                provJoinpoint: provJoinpoint,\n                annotations: provJoinpoint ? null : liefScope.getMethodMetadatas(targetType, methodName),\n                params: liefScope.getMethodParameters(targetType, target, methodName),\n                args: args,\n                target: target,\n                targetType: targetType\n            }));\n            var adChain = container.resolve(IAdvisorChainFactory.AdvisorChainFactoryToken, { container: container, advisor: _this.advisor, advices: advices });\n            adChain.invoaction(joinPoint, joinpoints.JoinpointState.Before);\n            adChain.invoaction(joinPoint, joinpoints.JoinpointState.Pointcut);\n            var val, exeErr;\n            try {\n                val = propertyMethod.apply(void 0, joinPoint.args);\n            }\n            catch (err) {\n                exeErr = err;\n            }\n            adChain.invoaction(joinPoint, joinpoints.JoinpointState.After, val);\n            if (exeErr) {\n                adChain.invoaction(joinPoint, joinpoints.JoinpointState.AfterThrowing, exeErr);\n            }\n            else {\n                adChain.invoaction(joinPoint, joinpoints.JoinpointState.AfterReturning, val);\n                return joinPoint.returning;\n            }\n        };\n    };\n    ProxyMethod.classAnnations = { \"name\": \"ProxyMethod\", \"params\": { \"constructor\": [\"container\"], \"proceed\": [\"target\", \"targetType\", \"pointcut\", \"provJoinpoint\"], \"proxy\": [\"propertyMethod\", \"advices\", \"target\", \"targetType\", \"pointcut\", \"provJoinpoint\"] } };\n    ProxyMethod = tslib_1.__decorate([\n        decorators.NonePointcut(),\n        core_1.Singleton(IProxyMethod.ProxyMethodToken),\n        tslib_1.__param(0, core_1.Inject(core_1.ContainerToken)),\n        tslib_1.__metadata(\"design:paramtypes\", [Object])\n    ], ProxyMethod);\n    return ProxyMethod;\n}());\nexports.ProxyMethod = ProxyMethod;\n\n\n\n\n});\n\nunwrapExports(ProxyMethod_1);\nvar ProxyMethod_2 = ProxyMethod_1.ProxyMethod;\n\nvar ReturningType_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * Returning Type\n *\n * @export\n * @enum {number}\n */\nvar ReturningType;\n(function (ReturningType) {\n    /**\n     * it is a sync returning\n     */\n    ReturningType[\"sync\"] = \"sync\";\n    /**\n     * it is promise asyce returning\n     */\n    ReturningType[\"promise\"] = \"promise\";\n    /**\n     * it is observable asyce returning\n     */\n    ReturningType[\"observable\"] = \"observable\";\n})(ReturningType = exports.ReturningType || (exports.ReturningType = {}));\n\n\n\n\n});\n\nunwrapExports(ReturningType_1);\nvar ReturningType_2 = ReturningType_1.ReturningType;\n\nvar AsyncPromiseProceeding_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\nvar AsyncPromiseProceeding = /** @class */ (function () {\n    function AsyncPromiseProceeding() {\n    }\n    AsyncPromiseProceeding.prototype.proceeding = function (joinPoint) {\n        var actions = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            actions[_i - 1] = arguments[_i];\n        }\n        if (joinPoint.returning) {\n            actions.forEach((function (action) {\n                joinPoint.returning = joinPoint.returning.then(function (val) {\n                    joinPoint.returningValue = val;\n                    return Promise.resolve(action(joinPoint))\n                        .then(function () {\n                        return joinPoint.returningValue;\n                    });\n                });\n            }));\n        }\n    };\n    AsyncPromiseProceeding.classAnnations = { \"name\": \"AsyncPromiseProceeding\", \"params\": { \"constructor\": [], \"proceeding\": [\"joinPoint\", \"actions\"] } };\n    AsyncPromiseProceeding = tslib_1.__decorate([\n        decorators.NonePointcut(),\n        core_1.Singleton(IAdvisorProceeding.AdvisorProceedingToken, ReturningType_1.ReturningType.promise),\n        tslib_1.__metadata(\"design:paramtypes\", [])\n    ], AsyncPromiseProceeding);\n    return AsyncPromiseProceeding;\n}());\nexports.AsyncPromiseProceeding = AsyncPromiseProceeding;\n\n\n\n\n});\n\nunwrapExports(AsyncPromiseProceeding_1);\nvar AsyncPromiseProceeding_2 = AsyncPromiseProceeding_1.AsyncPromiseProceeding;\n\nvar AsyncObservableProceeding_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\nvar AsyncObservableProceeding = /** @class */ (function () {\n    function AsyncObservableProceeding() {\n    }\n    AsyncObservableProceeding.prototype.proceeding = function (joinPoint) {\n        var actions = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            actions[_i - 1] = arguments[_i];\n        }\n        if (core_1.isFunction(joinPoint.returning.flatMap)) {\n            actions.forEach(function (action) {\n                joinPoint.returning = joinPoint.returning.flatMap(function (val) {\n                    joinPoint.returningValue = val;\n                    action(joinPoint);\n                    if (core_1.isObservable(joinPoint.returningValue)) {\n                        return joinPoint.returningValue;\n                    }\n                    else if (core_1.isPromise(joinPoint.returningValue)) {\n                        return joinPoint.returningValue;\n                    }\n                    else {\n                        return Promise.resolve(joinPoint.returningValue);\n                    }\n                });\n            });\n        }\n        else {\n            actions.forEach(function (action) {\n                action(joinPoint);\n            });\n        }\n    };\n    AsyncObservableProceeding.classAnnations = { \"name\": \"AsyncObservableProceeding\", \"params\": { \"constructor\": [], \"proceeding\": [\"joinPoint\", \"actions\"] } };\n    AsyncObservableProceeding = tslib_1.__decorate([\n        decorators.NonePointcut(),\n        core_1.Singleton(IAdvisorProceeding.AdvisorProceedingToken, ReturningType_1.ReturningType.observable),\n        tslib_1.__metadata(\"design:paramtypes\", [])\n    ], AsyncObservableProceeding);\n    return AsyncObservableProceeding;\n}());\nexports.AsyncObservableProceeding = AsyncObservableProceeding;\n\n\n\n\n});\n\nunwrapExports(AsyncObservableProceeding_1);\nvar AsyncObservableProceeding_2 = AsyncObservableProceeding_1.AsyncObservableProceeding;\n\nvar ReturningRecognizer_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\nvar ReturningRecognizer = /** @class */ (function () {\n    function ReturningRecognizer() {\n    }\n    ReturningRecognizer.prototype.recognize = function (value) {\n        if (core_1.isPromise(value)) {\n            return ReturningType_1.ReturningType.promise;\n        }\n        if (core_1.isObservable(value)) {\n            return ReturningType_1.ReturningType.observable;\n        }\n        return ReturningType_1.ReturningType.sync;\n    };\n    ReturningRecognizer.classAnnations = { \"name\": \"ReturningRecognizer\", \"params\": { \"constructor\": [], \"recognize\": [\"value\"] } };\n    ReturningRecognizer = tslib_1.__decorate([\n        decorators.NonePointcut(),\n        core_1.Singleton(core_1.RecognizerToken, joinpoints.JoinpointState.AfterReturning),\n        tslib_1.__metadata(\"design:paramtypes\", [])\n    ], ReturningRecognizer);\n    return ReturningRecognizer;\n}());\nexports.ReturningRecognizer = ReturningRecognizer;\n\n\n\n\n});\n\nunwrapExports(ReturningRecognizer_1);\nvar ReturningRecognizer_2 = ReturningRecognizer_1.ReturningRecognizer;\n\nvar SyncProceeding_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\nvar SyncProceeding = /** @class */ (function () {\n    function SyncProceeding() {\n    }\n    SyncProceeding.prototype.proceeding = function (joinPoint) {\n        var actions = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            actions[_i - 1] = arguments[_i];\n        }\n        joinPoint.returningValue = joinPoint.returning;\n        actions.forEach((function (action) {\n            action(joinPoint);\n        }));\n    };\n    SyncProceeding.classAnnations = { \"name\": \"SyncProceeding\", \"params\": { \"proceeding\": [\"joinPoint\", \"actions\"] } };\n    SyncProceeding = tslib_1.__decorate([\n        decorators.NonePointcut(),\n        core_1.Singleton(IAdvisorProceeding.AdvisorProceedingToken, ReturningType_1.ReturningType.sync)\n    ], SyncProceeding);\n    return SyncProceeding;\n}());\nexports.SyncProceeding = SyncProceeding;\n\n\n\n\n});\n\nunwrapExports(SyncProceeding_1);\nvar SyncProceeding_2 = SyncProceeding_1.SyncProceeding;\n\nvar access = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\ntslib_1.__exportStar(IAdvisorChainFactory, exports);\ntslib_1.__exportStar(AdvisorChainFactory_1, exports);\ntslib_1.__exportStar(IAdvisorChain, exports);\ntslib_1.__exportStar(AdvisorChain_1, exports);\ntslib_1.__exportStar(IProxyMethod, exports);\ntslib_1.__exportStar(ProxyMethod_1, exports);\ntslib_1.__exportStar(AsyncPromiseProceeding_1, exports);\ntslib_1.__exportStar(AsyncObservableProceeding_1, exports);\ntslib_1.__exportStar(IAdvisorProceeding, exports);\ntslib_1.__exportStar(ReturningRecognizer_1, exports);\ntslib_1.__exportStar(ReturningType_1, exports);\ntslib_1.__exportStar(SyncProceeding_1, exports);\n\n\n\n\n});\n\nunwrapExports(access);\n\nvar BindMethodPointcutAction_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n/**\n * bind method pointcut action.\n *\n * @export\n * @class BindMethodPointcutAction\n * @extends {ActionComposite}\n */\nvar BindMethodPointcutAction = /** @class */ (function (_super) {\n    tslib_1.__extends(BindMethodPointcutAction, _super);\n    function BindMethodPointcutAction() {\n        return _super.call(this, AopActions_1.AopActions.bindMethodPointcut) || this;\n    }\n    BindMethodPointcutAction.prototype.working = function (container, data) {\n        // aspect class do nothing.\n        if (!data.target || !isValideAspectTarget_1.isValideAspectTarget(data.targetType)) {\n            return;\n        }\n        if (!container.hasRegister(access.ProxyMethodToken.toString())) {\n            return;\n        }\n        var proxy = container.get(access.ProxyMethodToken);\n        var target = data.target;\n        var targetType = data.targetType;\n        var className = core_1.getClassName(targetType);\n        var methods = [];\n        var decorators = Object.getOwnPropertyDescriptors(targetType.prototype);\n        core_1.lang.forIn(decorators, function (item, name) {\n            if (name === 'constructor') {\n                return;\n            }\n            methods.push({\n                name: name,\n                fullName: className + \".\" + name,\n                descriptor: item\n            });\n        });\n        var allmethods = core_1.getParamerterNames(targetType);\n        core_1.lang.forIn(allmethods, function (item, name) {\n            if (name === 'constructor') {\n                return;\n            }\n            if (core_1.isUndefined(decorators[name])) {\n                methods.push({\n                    name: name,\n                    fullName: className + \".\" + name\n                });\n            }\n        });\n        methods.forEach(function (pointcut) {\n            proxy.proceed(target, targetType, pointcut, target['_cache_JoinPoint']);\n        });\n    };\n    BindMethodPointcutAction.classAnnations = { \"name\": \"BindMethodPointcutAction\", \"params\": { \"constructor\": [], \"working\": [\"container\", \"data\"] } };\n    return BindMethodPointcutAction;\n}(core_1.ActionComposite));\nexports.BindMethodPointcutAction = BindMethodPointcutAction;\n\n\n\n\n});\n\nunwrapExports(BindMethodPointcutAction_1);\nvar BindMethodPointcutAction_2 = BindMethodPointcutAction_1.BindMethodPointcutAction;\n\nvar InvokeBeforeConstructorAction_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n/**\n * actions invoke before constructor.\n *\n * @export\n * @class InvokeBeforeConstructorAction\n * @extends {ActionComposite}\n */\nvar InvokeBeforeConstructorAction = /** @class */ (function (_super) {\n    tslib_1.__extends(InvokeBeforeConstructorAction, _super);\n    function InvokeBeforeConstructorAction() {\n        return _super.call(this, AopActions_1.AopActions.registAspect) || this;\n    }\n    InvokeBeforeConstructorAction.prototype.working = function (container, data) {\n        // aspect class do nothing.\n        if (!isValideAspectTarget_1.isValideAspectTarget(data.targetType)) {\n            return;\n        }\n        var advisor = container.get(IAdvisor.AdvisorToken);\n        var className = core_1.getClassName(data.targetType);\n        var advices = advisor.getAdvices(className + '.constructor');\n        if (!advices) {\n            return;\n        }\n        var targetType = data.targetType;\n        var target = data.target;\n        var joinPoint = container.resolve(joinpoints.Joinpoint, core_1.Provider.create('options', {\n            name: 'constructor',\n            state: joinpoints.JoinpointState.Before,\n            fullName: className + '.constructor',\n            target: target,\n            args: data.args,\n            params: data.params,\n            targetType: targetType\n        }));\n        var providers = [core_1.Provider.create(joinpoints.Joinpoint, joinPoint)];\n        if (data.providerMap) {\n            providers.push(data.providerMap);\n        }\n        advices.Before.forEach(function (advicer) {\n            var _a;\n            (_a = advisor.getContainer(advicer.aspectType, container)).syncInvoke.apply(_a, [advicer.aspectType, advicer.advice.propertyKey, null].concat(providers)); // new Joinpoint(joinPoint) // container.resolve(Joinpoint, { json: joinPoint })\n        });\n        advices.Around.forEach(function (advicer) {\n            var _a;\n            (_a = advisor.getContainer(advicer.aspectType, container)).syncInvoke.apply(_a, [advicer.aspectType, advicer.advice.propertyKey, null].concat(providers));\n        });\n    };\n    InvokeBeforeConstructorAction.classAnnations = { \"name\": \"InvokeBeforeConstructorAction\", \"params\": { \"constructor\": [], \"working\": [\"container\", \"data\"] } };\n    return InvokeBeforeConstructorAction;\n}(core_1.ActionComposite));\nexports.InvokeBeforeConstructorAction = InvokeBeforeConstructorAction;\n\n\n\n\n});\n\nunwrapExports(InvokeBeforeConstructorAction_1);\nvar InvokeBeforeConstructorAction_2 = InvokeBeforeConstructorAction_1.InvokeBeforeConstructorAction;\n\nvar InvokeAfterConstructorAction_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n/**\n * invoke after constructor action.\n *\n * @export\n * @class InvokeAfterConstructorAction\n * @extends {ActionComposite}\n */\nvar InvokeAfterConstructorAction = /** @class */ (function (_super) {\n    tslib_1.__extends(InvokeAfterConstructorAction, _super);\n    function InvokeAfterConstructorAction() {\n        return _super.call(this, AopActions_1.AopActions.invokeAfterConstructorAdvices) || this;\n    }\n    InvokeAfterConstructorAction.prototype.working = function (container, data) {\n        // aspect class do nothing.\n        if (!data.target || !isValideAspectTarget_1.isValideAspectTarget(data.targetType)) {\n            return;\n        }\n        var advisor = container.get(IAdvisor.AdvisorToken);\n        var className = core_1.getClassName(data.targetType);\n        var advices = advisor.getAdvices(className + '.constructor');\n        if (!advices) {\n            return;\n        }\n        var targetType = data.targetType;\n        var target = data.target;\n        var joinPoint = container.resolve(joinpoints.Joinpoint, core_1.Provider.create('options', {\n            name: 'constructor',\n            state: joinpoints.JoinpointState.After,\n            fullName: className + '.constructor',\n            target: target,\n            args: data.args,\n            params: data.params,\n            targetType: targetType\n        }));\n        var providers = [core_1.Provider.create(joinpoints.Joinpoint, joinPoint)];\n        if (data.providerMap) {\n            providers.push(data.providerMap);\n        }\n        advices.After.forEach(function (advicer) {\n            var _a;\n            (_a = advisor.getContainer(advicer.aspectType, container)).syncInvoke.apply(_a, [advicer.aspectType, advicer.advice.propertyKey, null].concat(providers));\n        });\n        advices.Around.forEach(function (advicer) {\n            var _a;\n            (_a = advisor.getContainer(advicer.aspectType, container)).syncInvoke.apply(_a, [advicer.aspectType, advicer.advice.propertyKey, null].concat(providers));\n        });\n    };\n    InvokeAfterConstructorAction.classAnnations = { \"name\": \"InvokeAfterConstructorAction\", \"params\": { \"constructor\": [], \"working\": [\"container\", \"data\"] } };\n    return InvokeAfterConstructorAction;\n}(core_1.ActionComposite));\nexports.InvokeAfterConstructorAction = InvokeAfterConstructorAction;\n\n\n\n\n});\n\nunwrapExports(InvokeAfterConstructorAction_1);\nvar InvokeAfterConstructorAction_2 = InvokeAfterConstructorAction_1.InvokeAfterConstructorAction;\n\nvar IAdviceMatcher = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n/**\n * Aop advice matcher interface token.\n * it is a token id, you can register yourself IActionBuilder for this.\n */\nexports.AdviceMatcherToken = new core_1.InjectToken('DI_IAdviceMatcher');\n\n\n\n\n});\n\nunwrapExports(IAdviceMatcher);\nvar IAdviceMatcher_1 = IAdviceMatcher.AdviceMatcherToken;\n\nvar MatchPointcutAction_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n/**\n *  match pointcut action.\n *\n * @export\n * @class MatchPointcutAction\n * @extends {ActionComposite}\n */\nvar MatchPointcutAction = /** @class */ (function (_super) {\n    tslib_1.__extends(MatchPointcutAction, _super);\n    function MatchPointcutAction() {\n        return _super.call(this, AopActions_1.AopActions.matchPointcut) || this;\n    }\n    MatchPointcutAction.prototype.working = function (container, data) {\n        var _this = this;\n        // aspect class do nothing.\n        if (!isValideAspectTarget_1.isValideAspectTarget(data.targetType)) {\n            return;\n        }\n        var advisor = container.get(IAdvisor.AdvisorToken);\n        var matcher = container.get(IAdviceMatcher.AdviceMatcherToken);\n        advisor.aspects.forEach(function (adviceMetas, type) {\n            var matchpoints = matcher.match(type, data.targetType, adviceMetas, data.target);\n            matchpoints.forEach(function (mpt) {\n                var fullName = mpt.fullName;\n                var advice = mpt.advice;\n                var advices = advisor.getAdvices(fullName);\n                if (!advices) {\n                    advices = {\n                        Before: [],\n                        Pointcut: [],\n                        After: [],\n                        Around: [],\n                        AfterThrowing: [],\n                        AfterReturning: []\n                    };\n                    advisor.setAdvices(fullName, advices);\n                }\n                var advicer = core_1.lang.assign(mpt, {\n                    aspectType: type\n                });\n                if (advice.adviceName === 'Before') {\n                    if (!advices.Before.some(function (a) { return _this.isAdviceEquals(a.advice, advice); })) {\n                        advices.Before.push(advicer);\n                    }\n                }\n                else if (advice.adviceName === 'Pointcut') {\n                    if (!advices.Pointcut.some(function (a) { return _this.isAdviceEquals(a.advice, advice); })) {\n                        advices.Pointcut.push(advicer);\n                    }\n                }\n                else if (advice.adviceName === 'Around') {\n                    if (!advices.Around.some(function (a) { return _this.isAdviceEquals(a.advice, advice); })) {\n                        advices.Around.push(advicer);\n                    }\n                }\n                else if (advice.adviceName === 'After') {\n                    if (!advices.After.some(function (a) { return _this.isAdviceEquals(a.advice, advice); })) {\n                        advices.After.push(advicer);\n                    }\n                }\n                else if (advice.adviceName === 'AfterThrowing') {\n                    if (!advices.AfterThrowing.some(function (a) { return _this.isAdviceEquals(a.advice, advice); })) {\n                        advices.AfterThrowing.push(advicer);\n                    }\n                }\n                else if (advice.adviceName === 'AfterReturning') {\n                    if (!advices.AfterReturning.some(function (a) { return _this.isAdviceEquals(a.advice, advice); })) {\n                        advices.AfterReturning.push(advicer);\n                    }\n                }\n            });\n        });\n    };\n    MatchPointcutAction.prototype.isAdviceEquals = function (advice1, advice2) {\n        if (!advice1 || !advice2) {\n            return false;\n        }\n        if (advice1 === advice2) {\n            return true;\n        }\n        return advice1.adviceName === advice2.adviceName\n            && advice1.pointcut === advice2.pointcut\n            && advice1.propertyKey === advice2.propertyKey;\n    };\n    MatchPointcutAction.classAnnations = { \"name\": \"MatchPointcutAction\", \"params\": { \"constructor\": [], \"working\": [\"container\", \"data\"], \"isAdviceEquals\": [\"advice1\", \"advice2\"] } };\n    return MatchPointcutAction;\n}(core_1.ActionComposite));\nexports.MatchPointcutAction = MatchPointcutAction;\n\n\n\n\n});\n\nunwrapExports(MatchPointcutAction_1);\nvar MatchPointcutAction_2 = MatchPointcutAction_1.MatchPointcutAction;\n\nvar AopActionFactory_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n/**\n * aop action factory.\n *\n * @export\n * @class AopActionFactory\n */\nvar AopActionFactory = /** @class */ (function () {\n    function AopActionFactory() {\n    }\n    AopActionFactory.prototype.create = function (type) {\n        var action;\n        switch (type) {\n            case AopActions_1.AopActions.registAspect:\n                action = new RegistAspectAction_1.RegistAspectAction();\n                break;\n            case AopActions_1.AopActions.matchPointcut:\n                action = new actions.MatchPointcutAction();\n                break;\n            case AopActions_1.AopActions.invokeBeforeConstructorAdvices:\n                action = new actions.InvokeBeforeConstructorAction();\n                break;\n            case AopActions_1.AopActions.invokeAfterConstructorAdvices:\n                action = new actions.InvokeAfterConstructorAction();\n                break;\n            case AopActions_1.AopActions.bindMethodPointcut:\n                action = new actions.BindMethodPointcutAction();\n                break;\n            // case AopActions.bindPropertyPointcut:\n            //     action = new BindPropertyPointcutAction();\n            //     break;\n            case AopActions_1.AopActions.exetndsInstance:\n                action = new actions.ExetndsInstanceAction();\n                break;\n        }\n        return action;\n    };\n    AopActionFactory.classAnnations = { \"name\": \"AopActionFactory\", \"params\": { \"create\": [\"type\"] } };\n    return AopActionFactory;\n}());\nexports.AopActionFactory = AopActionFactory;\n\n\n\n\n});\n\nunwrapExports(AopActionFactory_1);\nvar AopActionFactory_2 = AopActionFactory_1.AopActionFactory;\n\nvar ExetndsInstanceAction_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n/**\n * extends instance action.\n *\n * @export\n * @class ExetndsInstanceAction\n * @extends {ActionComposite}\n */\nvar ExetndsInstanceAction = /** @class */ (function (_super) {\n    tslib_1.__extends(ExetndsInstanceAction, _super);\n    function ExetndsInstanceAction() {\n        return _super.call(this, AopActions_1.AopActions.registAspect) || this;\n    }\n    ExetndsInstanceAction.prototype.working = function (container, data) {\n        // aspect class do nothing.\n        if (!data.target || !data.providers || data.providers.length < 1) {\n            return;\n        }\n        data.providers.forEach(function (p) {\n            if (p && p instanceof core_1.ExtendsProvider) {\n                p.extends(data.target);\n            }\n        });\n    };\n    ExetndsInstanceAction.classAnnations = { \"name\": \"ExetndsInstanceAction\", \"params\": { \"constructor\": [], \"working\": [\"container\", \"data\"] } };\n    return ExetndsInstanceAction;\n}(core_1.ActionComposite));\nexports.ExetndsInstanceAction = ExetndsInstanceAction;\n\n\n\n\n});\n\nunwrapExports(ExetndsInstanceAction_1);\nvar ExetndsInstanceAction_2 = ExetndsInstanceAction_1.ExetndsInstanceAction;\n\nvar actions = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\ntslib_1.__exportStar(AopActions_1, exports);\ntslib_1.__exportStar(RegistAspectAction_1, exports);\ntslib_1.__exportStar(BindMethodPointcutAction_1, exports);\ntslib_1.__exportStar(InvokeBeforeConstructorAction_1, exports);\ntslib_1.__exportStar(InvokeAfterConstructorAction_1, exports);\n// export * from './BindPropertyPointcutAction';\ntslib_1.__exportStar(MatchPointcutAction_1, exports);\ntslib_1.__exportStar(AopActionFactory_1, exports);\ntslib_1.__exportStar(ExetndsInstanceAction_1, exports);\n\n\n\n\n});\n\nunwrapExports(actions);\n\nvar Advisor_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n/**\n * for global aop advisor.\n *\n * @export\n * @class Advisor\n */\nvar Advisor = /** @class */ (function () {\n    function Advisor() {\n        this.aspects = new core_1.MapSet();\n        this.aspectIocs = new core_1.MapSet();\n        this.advices = new core_1.MapSet();\n    }\n    Advisor.prototype.setAdvices = function (key, advices) {\n        if (!this.advices.has(key)) {\n            this.advices.set(key, advices);\n        }\n    };\n    Advisor.prototype.getAdvices = function (key) {\n        if (!this.advices.has(key)) {\n            return null;\n        }\n        return this.advices.get(key);\n    };\n    Advisor.prototype.hasRegisterAdvices = function (targetType) {\n        var _this = this;\n        var methods = core_1.lang.keys(Object.getOwnPropertyDescriptors(targetType.prototype));\n        var className = core_1.getClassName(targetType);\n        return methods.some(function (m) { return _this.advices.has(className + \".\" + m); });\n    };\n    Advisor.prototype.add = function (aspect, raiseContainer) {\n        if (!this.aspects.has(aspect)) {\n            var metas = core_1.getOwnMethodMetadata(decorators.Advice, aspect);\n            this.aspects.set(aspect, metas);\n            this.aspectIocs.set(aspect, raiseContainer);\n        }\n    };\n    Advisor.prototype.getContainer = function (aspect, defaultContainer) {\n        if (this.aspectIocs.has(aspect)) {\n            return this.aspectIocs.get(aspect) || defaultContainer;\n        }\n        return defaultContainer;\n    };\n    /**\n     * resolve aspect.\n     *\n     * @template T\n     * @param {Type<T>} aspect\n     * @param {...Providers[]} providers\n     * @returns {T}\n     * @memberof Advisor\n     */\n    Advisor.prototype.resolve = function (aspect) {\n        var providers = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            providers[_i - 1] = arguments[_i];\n        }\n        var _a;\n        if (this.aspectIocs.has(aspect)) {\n            return (_a = this.aspectIocs.get(aspect)).resolve.apply(_a, [aspect].concat(providers));\n        }\n        return null;\n    };\n    Advisor.classAnnations = { \"name\": \"Advisor\", \"params\": { \"constructor\": [], \"setAdvices\": [\"key\", \"advices\"], \"getAdvices\": [\"key\"], \"hasRegisterAdvices\": [\"targetType\"], \"add\": [\"aspect\", \"raiseContainer\"], \"getContainer\": [\"aspect\", \"defaultContainer\"], \"resolve\": [\"aspect\", \"providers\"] } };\n    Advisor = tslib_1.__decorate([\n        decorators.NonePointcut(),\n        core_1.Singleton(IAdvisor.AdvisorToken),\n        tslib_1.__metadata(\"design:paramtypes\", [])\n    ], Advisor);\n    return Advisor;\n}());\nexports.Advisor = Advisor;\n\n\n\n\n});\n\nunwrapExports(Advisor_1);\nvar Advisor_2 = Advisor_1.Advisor;\n\nvar AdviceMatcher_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n/**\n * advice matcher, use to match advice when a registered create instance.\n *\n * @export\n * @class AdviceMatcher\n * @implements {IAdviceMatcher}\n */\nvar AdviceMatcher = /** @class */ (function () {\n    function AdviceMatcher(container) {\n        this.container = container;\n    }\n    AdviceMatcher.prototype.match = function (aspectType, targetType, adviceMetas, target) {\n        var _this = this;\n        var aspectMeta = core_1.lang.first(core_1.getOwnTypeMetadata(decorators.Aspect, aspectType));\n        if (aspectMeta) {\n            if (aspectMeta.within) {\n                var ins = core_1.isArray(aspectMeta.within) ? aspectMeta.within : [aspectMeta.within];\n                if (ins.indexOf(targetType) < 0) {\n                    return [];\n                }\n            }\n            if (aspectMeta.annotation) {\n                var annotation = core_1.isFunction(aspectMeta.annotation) ? aspectMeta.annotation.toString() : aspectMeta.annotation;\n                var anno = (/^\\^?@\\w+/.test(annotation) ? '' : '@') + annotation;\n                if (!core_1.hasOwnClassMetadata(anno, targetType)) {\n                    return [];\n                }\n            }\n        }\n        var className = core_1.getClassName(targetType);\n        adviceMetas = adviceMetas || core_1.getOwnMethodMetadata(decorators.Advice, targetType);\n        // let advisor = this.container.get(AdvisorToken);\n        var matched = [];\n        if (targetType === aspectType) {\n            var adviceNames = core_1.lang.keys(adviceMetas);\n            if (adviceNames.length > 1) {\n                var advices_1 = [];\n                adviceNames.forEach(function (n) {\n                    advices_1 = advices_1.concat(adviceMetas[n]);\n                });\n                adviceNames.forEach(function (n) {\n                    advices_1.forEach(function (adv) {\n                        if (adv.propertyKey !== n) {\n                            if (_this.matchAspectSelf(n, adv)) {\n                                matched.push({\n                                    name: n,\n                                    fullName: className + \".\" + n,\n                                    advice: adv\n                                });\n                            }\n                        }\n                    });\n                });\n            }\n        }\n        else { // if (!advisor.hasRegisterAdvices(targetType)) {\n            var points_1 = [];\n            var decorators_2 = Object.getOwnPropertyDescriptors(targetType.prototype);\n            // match method.\n            for (var name_1 in decorators_2) {\n                points_1.push({\n                    name: name_1,\n                    fullName: className + \".\" + name_1\n                });\n            }\n            var allmethods = core_1.getParamerterNames(targetType);\n            core_1.lang.forIn(allmethods, function (item, name) {\n                if (name === 'constructor') {\n                    return;\n                }\n                if (core_1.isUndefined(decorators_2[name])) {\n                    points_1.push({\n                        name: name,\n                        fullName: className + \".\" + name\n                    });\n                }\n            });\n            Object.getOwnPropertyNames(adviceMetas).forEach(function (name) {\n                var advices = adviceMetas[name];\n                advices.forEach(function (metadata) {\n                    matched = matched.concat(_this.filterPointcut(targetType, points_1, metadata));\n                });\n            });\n        }\n        return matched;\n    };\n    AdviceMatcher.prototype.matchAspectSelf = function (name, metadata) {\n        if (metadata.pointcut) {\n            var pointcut = metadata.pointcut;\n            if (core_1.isString(pointcut)) {\n                if (/^execution\\(\\S+\\)$/.test(pointcut)) {\n                    pointcut = pointcut.substring(10, pointcut.length - 1);\n                }\n                return pointcut.startsWith(name);\n            }\n            else if (core_1.isRegExp(pointcut)) {\n                return pointcut.test(name);\n            }\n        }\n        return false;\n    };\n    AdviceMatcher.prototype.filterPointcut = function (type, points, metadata, target) {\n        if (!metadata.pointcut) {\n            return [];\n        }\n        var matchedPointcut;\n        if (metadata.pointcut) {\n            var match_1 = this.matchTypeFactory(type, metadata);\n            matchedPointcut = points.filter(function (p) { return match_1(p.name, p.fullName, type, target, p); });\n        }\n        matchedPointcut = matchedPointcut || [];\n        return matchedPointcut.map(function (p) {\n            return core_1.lang.assign({}, p, { advice: metadata });\n        });\n    };\n    AdviceMatcher.prototype.matchTypeFactory = function (type, metadata) {\n        var pointcut = metadata.pointcut;\n        var expresses = [];\n        if (metadata.within) {\n            expresses.push(function (method, fullName, targetType) {\n                if (core_1.isArray(metadata.within)) {\n                    return metadata.within.indexOf(targetType) >= 0;\n                }\n                else {\n                    return metadata.within === targetType;\n                }\n            });\n            expresses.push('&&');\n        }\n        if (metadata.target) {\n            expresses.push(function (method, fullName, targetType, target) {\n                return metadata.target = target;\n            });\n            expresses.push('&&');\n        }\n        if (metadata.annotation) {\n            expresses.push(function (method, fullName, targetType, target) {\n                return core_1.hasOwnMethodMetadata(metadata.annotation, targetType, method);\n            });\n            expresses.push('&&');\n        }\n        if (core_1.isString(pointcut)) {\n            var pointcuts = (pointcut || '').trim();\n            expresses.push(this.tranlateExpress(type, pointcuts));\n        }\n        else if (core_1.isRegExp(pointcut)) {\n            var pointcutReg_1 = pointcut;\n            if (/^\\^?@\\w+/.test(pointcutReg_1.source)) {\n                expresses.push(function (name, fullName, targetType) {\n                    var decName = Reflect.getMetadataKeys(type, name);\n                    return decName.some(function (n) { return core_1.isString(n) && pointcutReg_1.test(n); });\n                });\n            }\n            else {\n                expresses.push(function (name, fullName) { return pointcutReg_1.test(fullName); });\n            }\n        }\n        return this.mergeExpress.apply(this, expresses);\n    };\n    AdviceMatcher.prototype.spiltBrace = function (strExp) {\n        strExp = strExp.trim();\n        if (/^\\(/.test(strExp) && /\\)$/.test(strExp)) {\n            strExp = strExp.substring(1, strExp.length - 1).trim();\n        }\n        if (/^\\(/.test(strExp) && /\\)$/.test(strExp)) {\n            return this.spiltBrace(strExp);\n        }\n        else {\n            return strExp;\n        }\n    };\n    AdviceMatcher.prototype.expressToFunc = function (type, strExp) {\n        var _this = this;\n        if (/^@annotation\\(.*\\)$/.test(strExp)) {\n            var exp = strExp.substring(12, strExp.length - 1);\n            var annotation_1 = /^@/.test(exp) ? exp : ('@' + exp);\n            return function (name, fullName) { return core_1.hasOwnMethodMetadata(annotation_1, type, name) && !core_1.hasOwnClassMetadata(decorators.Aspect, type); };\n        }\n        else if (/^execution\\(.*\\)$/.test(strExp)) {\n            var exp = strExp.substring(10, strExp.length - 1);\n            if (exp === '*' || exp === '*.*') {\n                return function (name, fullName) { return !!name && !core_1.hasOwnClassMetadata(decorators.Aspect, type); };\n            }\n            else if (/^\\w+(\\((\\s*\\w+\\s*,)*\\s*\\w*\\))?$/.test(exp)) {\n                // if is method name, will match aspect self only.\n                return function () { return false; };\n            }\n            else if (/^([\\w\\*]+\\.)+[\\w\\*]+(\\((\\s*\\w+\\s*,)*\\s*\\w*\\))?$/.test(exp)) {\n                exp = exp.replace(/\\*\\*/gi, '(\\\\\\w+(\\\\\\.|\\\\\\/)){0,}\\\\\\w+')\n                    .replace(/\\*/gi, '\\\\\\w+')\n                    .replace(/\\./gi, '\\\\\\.')\n                    .replace(/\\//gi, '\\\\\\/');\n                var matcher_1 = new RegExp(exp + \"$\");\n                return function (name, fullName) { return matcher_1.test(fullName); };\n            }\n            else {\n                return function () { return false; };\n            }\n        }\n        else if (/^@within\\(\\s*\\w+/.test(strExp)) {\n            var classnames_1 = strExp.substring(strExp.indexOf('(') + 1, strExp.length - 1).split(',').map(function (n) { return n.trim(); });\n            return function (name, fullName, targetType) { return classnames_1.indexOf(core_1.getClassName(targetType)) >= 0; };\n        }\n        else if (/^@target\\(\\s*\\w+/.test(strExp)) {\n            var torken_1 = strExp.substring(strExp.indexOf('(') + 1, strExp.length - 1).trim();\n            return function (name, fullName, targetType) { return _this.container.getTokenImpl(torken_1) === targetType; };\n        }\n        else {\n            return function () { return false; };\n        }\n    };\n    AdviceMatcher.prototype.tranlateExpress = function (type, strExp) {\n        var expresses = [];\n        var idxOr = strExp.indexOf('||');\n        var idxAd = strExp.indexOf('&&');\n        if (idxAd < 0 && idxOr < 0) {\n            expresses.push(this.expressToFunc(type, this.spiltBrace(strExp)));\n        }\n        else {\n            if (idxOr > idxAd) {\n                var leftExp = this.spiltBrace(strExp.substring(0, idxOr));\n                if (leftExp) {\n                    expresses.push(this.tranlateExpress(type, leftExp));\n                }\n                var rightExp = this.spiltBrace(strExp.substring(idxOr + 2));\n                if (rightExp) {\n                    expresses.push('||');\n                    expresses.push(this.tranlateExpress(type, rightExp));\n                }\n            }\n            else if (idxAd > idxOr) {\n                var leftExp = this.spiltBrace(strExp.substring(0, idxAd));\n                if (leftExp) {\n                    expresses.push(this.tranlateExpress(type, leftExp));\n                }\n                var rightExp = this.spiltBrace(strExp.substring(idxAd + 2));\n                if (rightExp) {\n                    expresses.push('&&');\n                    expresses.push(this.tranlateExpress(type, rightExp));\n                }\n            }\n        }\n        return this.mergeExpress.apply(this, expresses);\n    };\n    AdviceMatcher.prototype.mergeExpress = function () {\n        var expresses = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            expresses[_i] = arguments[_i];\n        }\n        return function (method, fullName, targetType, pointcut) {\n            var flag;\n            expresses.forEach(function (express, idx) {\n                if (!core_1.isUndefined(flag)) {\n                    return;\n                }\n                if (core_1.isFunction(express)) {\n                    var rel = express(method, fullName, targetType, pointcut);\n                    if (idx < expresses.length - 2) {\n                        if (!rel && express[idx + 1] === '&&') {\n                            flag = false;\n                        }\n                        if (rel && express[idx + 1] === '||') {\n                            flag = true;\n                        }\n                    }\n                    else {\n                        flag = rel;\n                    }\n                }\n            });\n            return flag;\n        };\n    };\n    AdviceMatcher.classAnnations = { \"name\": \"AdviceMatcher\", \"params\": { \"constructor\": [\"container\"], \"match\": [\"aspectType\", \"targetType\", \"adviceMetas\", \"target\"], \"matchAspectSelf\": [\"name\", \"metadata\"], \"filterPointcut\": [\"type\", \"points\", \"metadata\", \"target\"], \"matchTypeFactory\": [\"type\", \"metadata\"], \"spiltBrace\": [\"strExp\"], \"expressToFunc\": [\"type\", \"strExp\"], \"tranlateExpress\": [\"type\", \"strExp\"], \"mergeExpress\": [\"expresses\"] } };\n    AdviceMatcher = tslib_1.__decorate([\n        decorators.NonePointcut(),\n        core_1.Singleton(IAdviceMatcher.AdviceMatcherToken),\n        tslib_1.__param(0, core_1.Inject(core_1.ContainerToken)),\n        tslib_1.__metadata(\"design:paramtypes\", [Object])\n    ], AdviceMatcher);\n    return AdviceMatcher;\n}());\nexports.AdviceMatcher = AdviceMatcher;\n\n\n\n\n});\n\nunwrapExports(AdviceMatcher_1);\nvar AdviceMatcher_2 = AdviceMatcher_1.AdviceMatcher;\n\nvar AopModule_1 = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\n\n\n\n\n\n\n\n\n/**\n * aop ext for ioc. auto run setup after registered.\n * with @IocExt('setup') decorator.\n * @export\n * @class AopModule\n */\nvar AopModule = /** @class */ (function () {\n    function AopModule(container) {\n        this.container = container;\n    }\n    /**\n     * register aop for container.\n     *\n     * @memberof AopModule\n     */\n    AopModule.prototype.setup = function () {\n        var container = this.container;\n        container.register(joinpoints.Joinpoint);\n        container.register(access.AdvisorChainFactory);\n        container.register(access.ReturningRecognizer);\n        container.register(access.SyncProceeding);\n        container.register(access.AsyncPromiseProceeding);\n        container.register(access.AsyncObservableProceeding);\n        container.register(access.AdvisorChain);\n        container.register(access.ProxyMethod);\n        container.register(Advisor_1.Advisor);\n        container.register(AdviceMatcher_1.AdviceMatcher);\n        var lifeScope = container.get(core_1.LifeScopeToken);\n        var factory = new AopActionFactory_1.AopActionFactory();\n        lifeScope.addAction(factory.create(actions.AopActions.registAspect), core_1.IocState.design);\n        lifeScope.addAction(factory.create(actions.AopActions.matchPointcut), core_1.IocState.runtime, core_1.LifeState.beforeConstructor);\n        lifeScope.addAction(factory.create(actions.AopActions.bindMethodPointcut), core_1.IocState.runtime, core_1.LifeState.AfterInit);\n        lifeScope.addAction(factory.create(actions.AopActions.invokeBeforeConstructorAdvices), core_1.IocState.runtime, core_1.LifeState.beforeConstructor);\n        lifeScope.addAction(factory.create(actions.AopActions.exetndsInstance), core_1.IocState.runtime, core_1.LifeState.onInit, core_1.LifeState.afterConstructor);\n        lifeScope.addAction(factory.create(actions.AopActions.invokeAfterConstructorAdvices), core_1.IocState.runtime, core_1.LifeState.afterConstructor);\n        lifeScope.registerDecorator(decorators.Aspect, actions.AopActions.registAspect, actions.AopActions.exetndsInstance);\n    };\n    AopModule.classAnnations = { \"name\": \"AopModule\", \"params\": { \"constructor\": [\"container\"], \"setup\": [] } };\n    AopModule = tslib_1.__decorate([\n        core_1.IocExt('setup'),\n        tslib_1.__param(0, core_1.Inject(core_1.ContainerToken)),\n        tslib_1.__metadata(\"design:paramtypes\", [Object])\n    ], AopModule);\n    return AopModule;\n}());\nexports.AopModule = AopModule;\n\n\n\n\n});\n\nunwrapExports(AopModule_1);\nvar AopModule_2 = AopModule_1.AopModule;\n\nvar D__workspace_github_tsioc_packages_aop_lib = createCommonjsModule(function (module, exports) {\nObject.defineProperty(exports, \"__esModule\", { value: true });\n\ntslib_1.__exportStar(actions, exports);\ntslib_1.__exportStar(decorators, exports);\ntslib_1.__exportStar(joinpoints, exports);\ntslib_1.__exportStar(access, exports);\ntslib_1.__exportStar(IAdvisor, exports);\ntslib_1.__exportStar(Advisor_1, exports);\ntslib_1.__exportStar(AdviceMatcher_1, exports);\ntslib_1.__exportStar(isValideAspectTarget_1, exports);\ntslib_1.__exportStar(AopModule_1, exports);\n\n\n\n\n});\n\nvar index$4 = unwrapExports(D__workspace_github_tsioc_packages_aop_lib);\n\nreturn index$4;\n\n})));\n\n//# sourceMappingURL=sourcemaps/aop.umd.js.map\n\n//# sourceMappingURL=sourcemaps/aop.umd.js.map\n"]}
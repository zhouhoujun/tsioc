!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@ts-ioc/core")):"function"==typeof define&&define.amd?define(["@ts-ioc/core"],e):(t.aop=t.aop||{},t.aop.umd=t.aop.umd||{},t.aop.umd.js=e(t["@ts-ioc/core"]))}(this,function(t){"use strict";t=t&&t.hasOwnProperty("default")?t.default:t;var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function o(t,e){return t(e={exports:{}},e.exports),e.exports}var r=o(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AopSymbols={IProxyMethod:Symbol("IProxyMethod"),IAdviceMatcher:Symbol("IAdviceMatcher"),IAdvisor:Symbol("IAdvisor"),IAdvisorChainFactory:Symbol("IAdvisorChainFactory"),IAdvisorChain:Symbol("IAdvisorChain"),IAdvisorProceeding:Symbol("IAdvisorProceeding"),IJoinpoint:Symbol("IJoinpoint")}});n(r);r.AopSymbols;var i=o(function(t,e){var n;(n=e.AopActions||(e.AopActions={})).registAspect="registAspect",n.exetndsInstance="exetndsInstance",n.matchPointcut="matchPointcut",n.bindPropertyPointcut="bindPropertyPointcut",n.bindMethodPointcut="bindMethodPointcut",n.invokeBeforeConstructorAdvices="invokeBeforeConstructorAdvices",n.invokeAfterConstructorAdvices="invokeAfterConstructorAdvices"});n(i);i.AopActions;var c=o(function(n,o){var c,a=e&&e.__extends||(c=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},function(t,e){function n(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),s=function(e){function n(){return e.call(this,i.AopActions.registAspect)||this}return a(n,e),n.prototype.working=function(e,n){var o=n.targetType,c=(n.propertyKey,e.getLifeScope().getClassDecorators(function(e){return e.actions.includes(i.AopActions.registAspect)&&t.hasOwnClassMetadata(e.name,o)})),a=e.get(r.AopSymbols.IAdvisor);c.forEach(function(e){var n=t.getOwnTypeMetadata(e.name,o);Array.isArray(n)&&n.length>0&&n.forEach(function(e){t.isClass(e.type)&&a.add(e.type)})})},n.classAnnations={name:"RegistAspectAction",params:{constructor:[],working:["container","data"]}},n}(t.ActionComposite);o.RegistAspectAction=s});n(c);c.RegistAspectAction;var a=o(function(e,n){function o(e,n,o,r){return t.createMethodDecorator("Advice",function(e){n&&n(e),e.next({isMetadata:function(e){return t.isClassMetadata(e,["pointcut"])},match:function(e){return t.isString(e)||t.isRegExp(e)},setMetadata:function(t,e){t.pointcut=e}}),o&&o(e),e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.annotationArgName=e}}),e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.annotation=e}})},function(t){return r&&(t=r(t)),t.adviceName=e,t})}n.createAdviceDecorator=o,n.Advice=o("Advice")});n(a);a.createAdviceDecorator,a.Advice;var s=o(function(e,n){n.Aspect=t.createClassDecorator("Aspect")});n(s);s.Aspect;var u=o(function(t,e){e.After=a.createAdviceDecorator("After")});n(u);u.After;var p=o(function(e,n){n.AfterReturning=a.createAdviceDecorator("AfterReturning",null,function(e){e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.returning=e}})})});n(p);p.AfterReturning;var f=o(function(e,n){n.AfterThrowing=a.createAdviceDecorator("AfterThrowing",null,function(e){e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.throwing=e}})})});n(f);f.AfterThrowing;var d=o(function(e,n){n.Around=a.createAdviceDecorator("Around",null,function(e){e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.args=e}}),e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.returning=e}}),e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.throwing=e}})})});n(d);d.Around;var g=o(function(t,e){e.Before=a.createAdviceDecorator("Before")});n(g);g.Before;var v=o(function(t,e){e.Pointcut=a.createAdviceDecorator("Pointcut")});n(v);v.Pointcut;var A=o(function(e,n){n.NonePointcut=t.createClassDecorator("NonePointcut")});n(A);A.NonePointcut;var l=o(function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}n(a),n(s),n(u),n(p),n(f),n(d),n(g),n(v),n(A)});n(l);var h=o(function(e,n){n.isValideAspectTarget=function(e){return!(!t.isClass(e)||e===Object||e===String||e===Date||e===Boolean||e===Number||t.hasOwnClassMetadata(l.NonePointcut,e))}});n(h);h.isValideAspectTarget;var y=o(function(e,n){var o=function(e){function n(){return e.call(this,i.AopActions.bindMethodPointcut)||this}return __extends(n,e),n.prototype.working=function(e,n){if(n.target&&h.isValideAspectTarget(n.targetType)){var o=e.get(r.AopSymbols.IProxyMethod),i=n.target,c=n.targetType,a=t.getClassName(c),s=[],u=Object.getOwnPropertyDescriptors(c.prototype);Object.keys(u).forEach(function(t){"constructor"!==t&&s.push({name:t,fullName:a+"."+t,descriptor:u[t]})});var p=t.getParamerterNames(c);Object.keys(p).forEach(function(e){"constructor"!==e&&t.isUndefined(u[e])&&s.push({name:e,fullName:a+"."+e})}),s.forEach(function(t){o.proceed(i,c,t,i._cache_JoinPoint)})}},n.classAnnations={name:"BindMethodPointcutAction",params:{constructor:[],working:["container","data"]}},n}(t.ActionComposite);n.BindMethodPointcutAction=o});n(y);y.BindMethodPointcutAction;var m=o(function(t,e){var n;(n=e.JoinpointState||(e.JoinpointState={})).Before="Before",n.Pointcut="Pointcut",n.After="After",n.AfterReturning="AfterReturning",n.AfterThrowing="AfterThrowing"});n(m);m.JoinpointState;var b=o(function(n,o){var i=e&&e.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=e&&e.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},a=function(){function e(t){this.provJoinpoint=t.provJoinpoint,this.name=t.name,this.fullName=t.fullName,this.params=t.params||[],this.args=t.args,this.returning=t.returning,this.throwing=t.throwing,this.state=t.state,this.advicer=t.advicer,this.annotations=t.annotations,this.target=t.target,this.targetType=t.targetType}return e.classAnnations={name:"Joinpoint",params:{constructor:["options"]}},e=i([t.Injectable(r.AopSymbols.IJoinpoint),l.NonePointcut(),c("design:paramtypes",[Object])],e)}();o.Joinpoint=a});n(b);b.Joinpoint;var P=o(function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}n(m),n(b)});n(P);var S=o(function(e,n){var o=function(e){function n(){return e.call(this,i.AopActions.registAspect)||this}return __extends(n,e),n.prototype.working=function(e,n){if(h.isValideAspectTarget(n.targetType)){var o=e.get(r.AopSymbols.IAdvisor),i=t.getClassName(n.targetType),c=o.getAdvices(i+".constructor");if(c){var a=n.targetType,s=n.target,u=e.resolve(P.Joinpoint,t.Provider.create("options",{name:"constructor",state:P.JoinpointState.Before,fullName:i+".constructor",target:s,args:n.args,targetType:a})),p=[t.Provider.create(P.Joinpoint,u)],f=e.get(t.symbols.IMethodAccessor);c.Before.forEach(function(t){f.syncInvoke.apply(f,[t.aspectType,t.advice.propertyKey,void 0].concat(p))}),c.Around.forEach(function(t){f.syncInvoke.apply(f,[t.aspectType,t.advice.propertyKey,void 0].concat(p))})}}},n.classAnnations={name:"InvokeBeforeConstructorAction",params:{constructor:[],working:["container","data"]}},n}(t.ActionComposite);n.InvokeBeforeConstructorAction=o});n(S);S.InvokeBeforeConstructorAction;var j=o(function(e,n){var o=function(e){function n(){return e.call(this,i.AopActions.invokeAfterConstructorAdvices)||this}return __extends(n,e),n.prototype.working=function(e,n){if(n.target&&h.isValideAspectTarget(n.targetType)){var o=e.get(r.AopSymbols.IAdvisor),i=t.getClassName(n.targetType),c=o.getAdvices(i+".constructor");if(c){var a=n.targetType,s=n.target,u=e.resolve(P.Joinpoint,t.Provider.create("options",{name:"constructor",state:P.JoinpointState.After,fullName:i+".constructor",target:s,args:n.args,targetType:a})),p=[t.Provider.create(P.Joinpoint,u)],f=e.get(t.symbols.IMethodAccessor);c.After.forEach(function(t){f.syncInvoke.apply(f,[t.aspectType,t.advice.propertyKey,void 0].concat(p))}),c.Around.forEach(function(t){f.syncInvoke.apply(f,[t.aspectType,t.advice.propertyKey,void 0].concat(p))})}}},n.classAnnations={name:"InvokeAfterConstructorAction",params:{constructor:[],working:["container","data"]}},n}(t.ActionComposite);n.InvokeAfterConstructorAction=o});n(j);j.InvokeAfterConstructorAction;var O=o(function(e,n){var o=function(t){function e(){return t.call(this,i.AopActions.matchPointcut)||this}return __extends(e,t),e.prototype.working=function(t,e){var n=this;if(h.isValideAspectTarget(e.targetType)){var o=t.get(r.AopSymbols.IAdvisor),i=t.get(r.AopSymbols.IAdviceMatcher);o.aspects.forEach(function(t,r){i.match(r,e.targetType,t).forEach(function(t){var e=t.fullName,i=t.advice,c=o.getAdvices(e);c||(c={Before:[],Pointcut:[],After:[],Around:[],AfterThrowing:[],AfterReturning:[]},o.setAdvices(e,c));var a=Object.assign(t,{aspectType:r});"Before"===i.adviceName?c.Before.some(function(t){return n.isAdviceEquals(t.advice,i)})||c.Before.push(a):"Pointcut"===i.adviceName?c.Pointcut.some(function(t){return n.isAdviceEquals(t.advice,i)})||c.Pointcut.push(a):"Around"===i.adviceName?c.Around.some(function(t){return n.isAdviceEquals(t.advice,i)})||c.Around.push(a):"After"===i.adviceName?c.After.some(function(t){return n.isAdviceEquals(t.advice,i)})||c.After.push(a):"AfterThrowing"===i.adviceName?c.AfterThrowing.some(function(t){return n.isAdviceEquals(t.advice,i)})||c.AfterThrowing.push(a):"AfterReturning"===i.adviceName&&(c.AfterReturning.some(function(t){return n.isAdviceEquals(t.advice,i)})||c.AfterReturning.push(a))})})}},e.prototype.isAdviceEquals=function(t,e){return!(!t||!e)&&(t===e||t.adviceName===e.adviceName&&t.pointcut===e.pointcut&&t.propertyKey===e.propertyKey)},e.classAnnations={name:"MatchPointcutAction",params:{constructor:[],working:["container","data"],isAdviceEquals:["advice1","advice2"]}},e}(t.ActionComposite);n.MatchPointcutAction=o});n(O);O.MatchPointcutAction;var w=o(function(t,e){var n=function(){function t(){}return t.prototype.create=function(t){var e;switch(t){case i.AopActions.registAspect:e=new c.RegistAspectAction;break;case i.AopActions.matchPointcut:e=new R.MatchPointcutAction;break;case i.AopActions.invokeBeforeConstructorAdvices:e=new R.InvokeBeforeConstructorAction;break;case i.AopActions.invokeAfterConstructorAdvices:e=new R.InvokeAfterConstructorAction;break;case i.AopActions.bindMethodPointcut:e=new R.BindMethodPointcutAction;break;case i.AopActions.exetndsInstance:e=new R.ExetndsInstanceAction}return e},t.classAnnations={name:"AopActionFactory",params:{create:["type"]}},t}();e.AopActionFactory=n});n(w);w.AopActionFactory;var _=o(function(e,n){var o=function(e){function n(){return e.call(this,i.AopActions.registAspect)||this}return __extends(n,e),n.prototype.working=function(e,n){!n.target||!n.providers||n.providers.length<1||n.providers.forEach(function(e){e&&e instanceof t.ExtendsProvider&&e.extends(n.target)})},n.classAnnations={name:"ExetndsInstanceAction",params:{constructor:[],working:["container","data"]}},n}(t.ActionComposite);n.ExetndsInstanceAction=o});n(_);_.ExetndsInstanceAction;var R=o(function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}n(i),n(c),n(y),n(S),n(j),n(O),n(w),n(_)});n(R);var I=o(function(n,o){var i=e&&e.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=e&&e.__param||function(t,e){return function(n,o){e(n,o,t)}},a=function(){function e(t,e){this.container=t,this.advices=e}return e.prototype.getAdvicers=function(t){return(t?this.advices[t]:null)||[]},e.prototype.invoaction=function(t,e,n){switch(t.state=e,t.returning=void 0,t.throwing=void 0,e){case P.JoinpointState.Before:this.before(t);break;case P.JoinpointState.Pointcut:this.pointcut(t);break;case P.JoinpointState.After:t.returning=n,this.after(t);break;case P.JoinpointState.AfterThrowing:t.throwing=n,this.afterThrowing(t);break;case P.JoinpointState.AfterReturning:t.returning=n,this.afterReturning(t)}},e.prototype.before=function(e){var n=this,o=Object.assign({},e);this.getAdvicers("Around").forEach(function(t){n.invokeAdvice(o,t)}),t.isUndefined(o.args)||(e.args=o.args),this.getAdvicers("Before").forEach(function(t){n.invokeAdvice(o,t)})},e.prototype.pointcut=function(e){var n=this,o=Object.assign({},e);this.getAdvicers("Pointcut").forEach(function(t){n.invokeAdvice(o,t)}),t.isUndefined(o.args)||(e.args=o.args)},e.prototype.after=function(t){var e=this,n=Object.assign({},t);this.getAdvicers("Around").forEach(function(t){e.invokeAdvice(n,t)}),this.getAdvicers("After").forEach(function(t){e.invokeAdvice(n,t)})},e.prototype.afterThrowing=function(t){var e=this,n=Object.assign({},t);this.getAdvicers("Around").forEach(function(t){e.invokeAdvice(n,t)}),this.getAdvicers("AfterThrowing").forEach(function(t){e.invokeAdvice(n,t)})},e.prototype.afterReturning=function(e){var n=this,o=Object.assign({},e),i=this.container.resolve(r.AopSymbols.IAdvisorChain,{joinPoint:o});this.getAdvicers("Around").forEach(function(t){i.next(function(e){return n.invokeAdvice(e,t)})}),this.getAdvicers("AfterReturning").forEach(function(t){i.next(function(e){return n.invokeAdvice(e,t)})}),i.next(function(n){return t.isUndefined(n.returning)||(e.returning=n.returning),e}),i.process()},e.prototype.invokeAdvice=function(e,n){var o=this,r=[];r.push(t.Provider.createExtends(P.Joinpoint,e,function(t,e){t._cache_JoinPoint=e.resolve(o.container)}));var i,c=n.advice;return!t.isUndefined(e.args)&&c.args&&r.push(t.Provider.create(c.args,e.args)),c.annotationArgName&&r.push(t.Provider.create(c.annotationArgName,function(){for(var n=e,o=n.annotations;!o&&e.provJoinpoint;)if((n=e.provJoinpoint)&&n.annotations){o=n.annotations;break}if(t.isArray(o)){if(c.annotation){var r=c.annotation;return r=/^@/.test(r)?r:"@"+r,o.filter(function(t){return t.decorator===r})}return o}return[]})),!t.isUndefined(e.returning)&&c.returning&&r.push(t.Provider.create(c.returning,e.returning)),!t.isUndefined(e.throwing)&&c.throwing&&r.push(t.Provider.create(c.throwing,e.throwing)),(i=this.container).syncInvoke.apply(i,[n.aspectType,n.advice.propertyKey,null].concat(r))},e.classAnnations={name:"AdvisorChainFactory",params:{constructor:["container","advices"],getAdvicers:["adviceType"],invoaction:["joinPoint","state","valueOrthrowing"],before:["joinPoint"],pointcut:["joinPoint"],after:["joinPoint"],afterThrowing:["joinPoint"],afterReturning:["joinPoint"],invokeAdvice:["joinPoint","advicer"]}},e=i([l.NonePointcut(),t.Injectable(r.AopSymbols.IAdvisorChainFactory),c(0,t.Inject(t.symbols.IContainer)),__metadata("design:paramtypes",[Object,Object])],e)}();o.AdvisorChainFactory=a});n(I);I.AdvisorChainFactory;var M=o(function(n,o){var i=e&&e.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=function(){function e(t){this.joinPoint=t,this.actions=[]}return e.prototype.next=function(t){this.actions.push(t)},e.prototype.getRecognizer=function(){return this.container.get(t.symbols.IRecognizer,this.joinPoint.state)},e.prototype.process=function(){var t,e=this.getRecognizer().recognize(this.joinPoint.returning);(t=this.container.get(r.AopSymbols.IAdvisorProceeding,e)).proceeding.apply(t,[this.joinPoint].concat(this.actions))},e.classAnnations={name:"AdvisorChain",params:{constructor:["joinPoint"],next:["action"],getRecognizer:[],process:[]}},i([t.Inject(t.symbols.IContainer),__metadata("design:type",Object)],e.prototype,"container",void 0),e=i([l.NonePointcut(),t.Injectable(r.AopSymbols.IAdvisorChain),__metadata("design:paramtypes",[P.Joinpoint])],e)}();o.AdvisorChain=c});n(M);M.AdvisorChain;var C=o(function(n,o){var i=e&&e.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=P,a=function(){function e(t){this.container=t}return Object.defineProperty(e.prototype,"aspectMgr",{get:function(){return this._aspectMgr||(this._aspectMgr=this.container.get(r.AopSymbols.IAdvisor)),this._aspectMgr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"liefScope",{get:function(){return this._liefScope||(this._liefScope=this.container.getLifeScope()),this._liefScope},enumerable:!0,configurable:!0}),e.prototype.proceed=function(e,n,o,r){var i=this.aspectMgr,c=o.fullName,a=o.name,s=i.getAdvices(c);if(s&&o)if(o.descriptor&&(o.descriptor.get||o.descriptor.set)){if(o.descriptor.get){var u=o.descriptor.get.bind(e);o.descriptor.get=this.proxy(u,s,e,n,o,r)}if(o.descriptor.set){var p=o.descriptor.set.bind(e);o.descriptor.set=this.proxy(p,s,e,n,o,r)}Object.defineProperty(e,a,o.descriptor)}else if(t.isFunction(e[a])){var f=e[a].bind(e);e[a]=this.proxy(f,s,e,n,o,r)}},e.prototype.proxy=function(e,n,o,i,a,s){var u=this,p=(this.aspectMgr,a.fullName),f=a.name,d=this.liefScope,g=this.container;return function(){for(var a=[],v=0;v<arguments.length;v++)a[v]=arguments[v];var A,l,h=u.container.resolve(c.Joinpoint,t.Provider.create("options",{name:f,fullName:p,provJoinpoint:s,annotations:s?null:d.getMethodMetadatas(i,f),params:d.getMethodParameters(i,o,f),args:a,target:o,targetType:i})),y=g.resolve(r.AopSymbols.IAdvisorChainFactory,{container:g,advices:n});y.invoaction(h,P.JoinpointState.Before),y.invoaction(h,P.JoinpointState.Pointcut);try{A=e.apply(void 0,h.args)}catch(t){l=t}if(y.invoaction(h,P.JoinpointState.After,A),!l)return y.invoaction(h,P.JoinpointState.AfterReturning,A),h.returning;y.invoaction(h,P.JoinpointState.AfterThrowing,l)}},e.classAnnations={name:"ProxyMethod",params:{constructor:["container"],proceed:["target","targetType","pointcut","provJoinpoint"],proxy:["propertyMethod","advices","target","targetType","pointcut","provJoinpoint"]}},e=i([l.NonePointcut(),t.Singleton(r.AopSymbols.IProxyMethod),__param(0,t.Inject(t.symbols.IContainer)),__metadata("design:paramtypes",[Object])],e)}();o.ProxyMethod=a});n(C);C.ProxyMethod;var k=o(function(t,e){var n;(n=e.ReturningType||(e.ReturningType={})).sync="sync",n.promise="promise",n.observable="observable"});n(k);k.ReturningType;var T=o(function(n,o){var i=e&&e.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=function(){function e(){}return e.prototype.proceeding=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t.returning&&e.forEach(function(e){t.returning=t.returning.then(function(n){return t.returningValue=n,Promise.resolve(e(t)).then(function(){return t.returningValue})})})},e.classAnnations={name:"AsyncPromiseProceeding",params:{constructor:[],proceeding:["joinPoint","actions"]}},e=i([l.NonePointcut(),t.Singleton(r.AopSymbols.IAdvisorProceeding,k.ReturningType.promise),__metadata("design:paramtypes",[])],e)}();o.AsyncPromiseProceeding=c});n(T);T.AsyncPromiseProceeding;var x=o(function(n,o){var i=e&&e.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=function(){function e(){}return e.prototype.proceeding=function(e){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];t.isFunction(e.returning.flatMap)?n.forEach(function(n){e.returning=e.returning.flatMap(function(o){return e.returningValue=o,n(e),t.isObservable(e.returningValue)?e.returningValue:t.isPromise(e.returningValue)?e.returningValue:Promise.resolve(e.returningValue)})}):n.forEach(function(t){t(e)})},e.classAnnations={name:"AsyncObservableProceeding",params:{constructor:[],proceeding:["joinPoint","actions"]}},e=i([l.NonePointcut(),t.Singleton(r.AopSymbols.IAdvisorProceeding,k.ReturningType.observable),__metadata("design:paramtypes",[])],e)}();o.AsyncObservableProceeding=c});n(x);x.AsyncObservableProceeding;var E=o(function(n,o){var r=e&&e.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},i=function(){function e(){}return e.prototype.recognize=function(e){return t.isPromise(e)?k.ReturningType.promise:t.isObservable(e)?k.ReturningType.observable:k.ReturningType.sync},e.classAnnations={name:"ReturningRecognizer",params:{constructor:[],recognize:["value"]}},e=r([l.NonePointcut(),t.Singleton(t.symbols.IRecognizer,P.JoinpointState.AfterReturning),__metadata("design:paramtypes",[])],e)}();o.ReturningRecognizer=i});n(E);E.ReturningRecognizer;var N=o(function(n,o){var i=e&&e.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=function(){function e(){}return e.prototype.proceeding=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t.returningValue=t.returning,e.forEach(function(e){e(t)})},e.classAnnations={name:"SyncProceeding",params:{proceeding:["joinPoint","actions"]}},e=i([l.NonePointcut(),t.Singleton(r.AopSymbols.IAdvisorProceeding,k.ReturningType.sync)],e)}();o.SyncProceeding=c});n(N);N.SyncProceeding;var J=o(function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}n(I),n(M),n(C),n(T),n(x),n(E),n(k),n(N)});n(J);var D=o(function(n,o){var i=e&&e.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=function(){function e(e){this.container=e,this.aspects=new t.MapSet,this.advices=new t.MapSet}return e.prototype.setAdvices=function(t,e){this.advices.has(t)||this.advices.set(t,e)},e.prototype.getAdvices=function(t){return this.advices.has(t)?this.advices.get(t):null},e.prototype.hasRegisterAdvices=function(e){var n=this,o=Object.keys(Object.getOwnPropertyDescriptors(e.prototype)),r=t.getClassName(e);return o.some(function(t){return n.advices.has(r+"."+t)})},e.prototype.add=function(e){if(!this.aspects.has(e)){var n=t.getOwnMethodMetadata(l.Advice,e);this.aspects.set(e,n)}},e.classAnnations={name:"Advisor",params:{constructor:["container"],setAdvices:["key","advices"],getAdvices:["key"],hasRegisterAdvices:["targetType"],add:["aspect"]}},e=i([l.NonePointcut(),t.Singleton(r.AopSymbols.IAdvisor),__param(0,t.Inject(t.symbols.IContainer)),__metadata("design:paramtypes",[Object])],e)}();o.Advisor=c});n(D);D.Advisor;var B=o(function(n,o){var i=e&&e.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=function(){function e(t){this.container=t}return e.prototype.match=function(e,n,o,i){var c=this,a=t.getClassName(n);o=o||t.getOwnMethodMetadata(l.Advice,n);this.container.get(r.AopSymbols.IAdvisor);var s=[];if(n===e){var u=Object.keys(o);if(u.length>1){var p=[];u.forEach(function(t){p=p.concat(o[t])}),u.forEach(function(t){p.forEach(function(e){e.propertyKey!==t&&c.matchAspectSelf(t,e)&&s.push({name:t,fullName:a+"."+t,advice:e})})})}}else{var f=[],d=Object.getOwnPropertyDescriptors(n.prototype);for(var g in d)f.push({name:g,fullName:a+"."+g});var v=t.getParamerterNames(n);Object.keys(v).forEach(function(e){"constructor"!==e&&t.isUndefined(d[e])&&f.push({name:e,fullName:a+"."+e})}),Object.getOwnPropertyNames(o).forEach(function(t){o[t].forEach(function(t){s=s.concat(c.filterPointcut(n,f,t))})})}return s},e.prototype.matchAspectSelf=function(e,n){if(n.pointcut){var o=n.pointcut;if(t.isString(o)){if(/^execution\(\S+\)$/.test(o))return(o=o.substring(10,o.length-1))===e}else if(t.isRegExp(o))return o.test(e)}return!1},e.prototype.filterPointcut=function(t,e,n){if(!n.pointcut)return[];var o;if(n.pointcut){var r=this.matchTypeFactory(t,n.pointcut);o=e.filter(function(t){return r(t.name,t.fullName,t)})}return(o=o||[]).map(function(t){return Object.assign({},t,{advice:n})})},e.prototype.matchTypeFactory=function(e,n){if(t.isString(n)){if(n=(n||"").trim(),/^@annotation\(\S+\)$/.test(n)){n=n.substring(12,n.length-1);var o=/^@/.test(n)?n:"@"+n;return function(n,r){return t.hasOwnMethodMetadata(o,e,n)&&!t.hasOwnClassMetadata(l.Aspect,e)}}if(/^execution\(\S+\)$/.test(n)&&(n=n.substring(10,n.length-1)),"*"===n||"*.*"===n)return function(n,o,r){return!!n&&!t.hasOwnClassMetadata(l.Aspect,e)};n=n.replace(/\*\*/gi,"(\\w+(\\.|\\/)){0,}\\w+").replace(/\*/gi,"\\w+").replace(/\./gi,"\\.").replace(/\//gi,"\\/");var r=new RegExp(n+"$");return function(t,e,n){return r.test(e)}}if(t.isRegExp(n)){var i=n;return/^\^?@\w+/.test(i.source)?function(n,o,r){return Reflect.getMetadataKeys(e,n).some(function(e){return t.isString(e)&&i.test(e)})}:function(t,e,n){return i.test(e)}}return null},e.classAnnations={name:"AdviceMatcher",params:{constructor:["container"],match:["aspectType","targetType","adviceMetas","instance"],matchAspectSelf:["name","metadata"],filterPointcut:["type","points","metadata"],matchTypeFactory:["type","pointcut"]}},e=i([l.NonePointcut(),t.Singleton(r.AopSymbols.IAdviceMatcher),__param(0,t.Inject(t.symbols.IContainer)),__metadata("design:paramtypes",[Object])],e)}();o.AdviceMatcher=c});n(B);B.AdviceMatcher;var F=o(function(n,o){var i=e&&e.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=function(){function e(t){this.container=t}return e.prototype.setup=function(){var e=this.container;e.register(P.Joinpoint),e.register(J.AdvisorChainFactory),e.register(J.ReturningRecognizer),e.register(J.SyncProceeding),e.register(J.AsyncPromiseProceeding),e.register(J.AsyncObservableProceeding),e.register(J.AdvisorChain),e.register(J.ProxyMethod),e.register(D.Advisor),e.register(B.AdviceMatcher);var n=e.get(t.symbols.LifeScope),o=new w.AopActionFactory;n.addAction(o.create(R.AopActions.registAspect),t.IocState.design),n.addAction(o.create(R.AopActions.matchPointcut),t.IocState.runtime,t.LifeState.beforeConstructor),n.addAction(o.create(R.AopActions.bindMethodPointcut),t.IocState.runtime,t.LifeState.AfterInit),n.addAction(o.create(R.AopActions.invokeBeforeConstructorAdvices),t.IocState.runtime,t.LifeState.beforeConstructor),n.addAction(o.create(R.AopActions.exetndsInstance),t.IocState.runtime,t.LifeState.onInit,t.LifeState.afterConstructor),n.addAction(o.create(R.AopActions.invokeAfterConstructorAdvices),t.IocState.runtime,t.LifeState.afterConstructor),n.registerDecorator(l.Aspect,R.AopActions.registAspect,R.AopActions.exetndsInstance)},e.symbols=r.AopSymbols,e.classAnnations={name:"AopModule",params:{constructor:["container"],setup:[]}},e=i([t.IocModule("setup"),__param(0,t.Inject(t.symbols.IContainer)),__metadata("design:paramtypes",[Object])],e)}();o.AopModule=c});n(F);F.AopModule;return n(o(function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}n(r),n(R),n(l),n(P),n(J),n(D),n(B),n(h),n(F)}))});
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@ts-ioc/core")):"function"==typeof define&&define.amd?define(["@ts-ioc/core"],e):(t.aop=t.aop||{},t.aop.umd=t.aop.umd||{},t.aop.umd.js=e(t["@ts-ioc/core"]))}(this,function(t){"use strict";function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){return e={exports:{}},t(e,e.exports),e.exports}t=t&&t.hasOwnProperty("default")?t.default:t;var o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};Object.defineProperty(exports,"__esModule",{value:!0});var r=o&&o.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=(o&&o.__decorate,o&&o.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}),c=o&&o.__param||function(t,e){return function(n,o){e(n,o,t)}},a=n(function(t,e){e.AopSymbols={IProxyMethod:Symbol("IProxyMethod"),IAdviceMatcher:Symbol("IAdviceMatcher"),IAdvisor:Symbol("IAdvisor"),IAdvisorChainFactory:Symbol("IAdvisorChainFactory"),IAdvisorChain:Symbol("IAdvisorChain"),IAdvisorProceeding:Symbol("IAdvisorProceeding"),IJoinpoint:Symbol("IJoinpoint")}});e(a);var s=n(function(t,e){!function(t){t.registAspect="registAspect",t.exetndsInstance="exetndsInstance",t.matchPointcut="matchPointcut",t.bindPropertyPointcut="bindPropertyPointcut",t.bindMethodPointcut="bindMethodPointcut",t.invokeBeforeConstructorAdvices="invokeBeforeConstructorAdvices",t.invokeAfterConstructorAdvices="invokeAfterConstructorAdvices"}(e.AopActions||(e.AopActions={}))});e(s);var u=n(function(e,n){var o=function(e){function n(){return e.call(this,s.AopActions.registAspect)||this}return r(n,e),n.prototype.working=function(e,n){var o=n.targetType,r=e.getLifeScope().getClassDecorators(function(e){return e.actions.includes(s.AopActions.registAspect)&&t.hasOwnClassMetadata(e.name,o)}),i=e.get(a.AopSymbols.IAdvisor);r.forEach(function(e){var n=t.getOwnTypeMetadata(e.name,o);Array.isArray(n)&&n.length>0&&n.forEach(function(e){t.isClass(e.type)&&i.add(e.type)})})},n.classAnnations={name:"RegistAspectAction",params:{constructor:[],working:["container","data"]}},n}(t.ActionComposite);n.RegistAspectAction=o});e(u);var f=n(function(e,n){function o(e,n,o,r){return t.createMethodDecorator("Advice",function(e){n&&n(e),e.next({isMetadata:function(e){return t.isClassMetadata(e,["pointcut"])},match:function(e){return t.isString(e)||t.isRegExp(e)},setMetadata:function(t,e){t.pointcut=e}}),o&&o(e),e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.annotationArgName=e}}),e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.annotation=e}})},function(t){return r&&(t=r(t)),t.adviceName=e,t})}n.createAdviceDecorator=o,n.Advice=o("Advice")});e(f);var p=n(function(e,n){n.Aspect=t.createClassDecorator("Aspect")});e(p);var d=n(function(t,e){e.After=f.createAdviceDecorator("After")});e(d);var g=n(function(e,n){n.AfterReturning=f.createAdviceDecorator("AfterReturning",null,function(e){e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.returning=e}})})});e(g);var v=n(function(e,n){n.AfterThrowing=f.createAdviceDecorator("AfterThrowing",null,function(e){e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.throwing=e}})})});e(v);var l=n(function(e,n){n.Around=f.createAdviceDecorator("Around",null,function(e){e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.args=e}}),e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.returning=e}}),e.next({match:function(e){return t.isString(e)},setMetadata:function(t,e){t.throwing=e}})})});e(l);var A=n(function(t,e){e.Before=f.createAdviceDecorator("Before")});e(A);var h=n(function(t,e){e.Pointcut=f.createAdviceDecorator("Pointcut")});e(h);var y=n(function(e,n){n.NonePointcut=t.createClassDecorator("NonePointcut")});e(y);var m=n(function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}n(f),n(p),n(d),n(g),n(v),n(l),n(A),n(h),n(y)});e(m);var b=n(function(e,n){n.isValideAspectTarget=function(e){return!(!t.isClass(e)||e===Object||e===String||e===Date||e===Boolean||e===Number||t.hasOwnClassMetadata(m.NonePointcut,e))}});e(b);var P=n(function(e,n){var o=function(e){function n(){return e.call(this,s.AopActions.bindMethodPointcut)||this}return r(n,e),n.prototype.working=function(e,n){if(n.target&&b.isValideAspectTarget(n.targetType)){var o=e.get(a.AopSymbols.IProxyMethod),r=n.target,i=n.targetType,c=t.getClassName(i),s=[],u=Object.getOwnPropertyDescriptors(i.prototype);Object.keys(u).forEach(function(t){"constructor"!==t&&s.push({name:t,fullName:c+"."+t,descriptor:u[t]})});var f=t.getParamerterNames(i);Object.keys(f).forEach(function(e){"constructor"!==e&&t.isUndefined(u[e])&&s.push({name:e,fullName:c+"."+e})}),s.forEach(function(t){o.proceed(r,i,t,r._cache_JoinPoint)})}},n.classAnnations={name:"BindMethodPointcutAction",params:{constructor:[],working:["container","data"]}},n}(t.ActionComposite);n.BindMethodPointcutAction=o});e(P);var S=n(function(t,e){!function(t){t.Before="Before",t.Pointcut="Pointcut",t.After="After",t.AfterReturning="AfterReturning",t.AfterThrowing="AfterThrowing"}(e.JoinpointState||(e.JoinpointState={}))});e(S);var j=n(function(e,n){var r=o&&o.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=function(){function e(t){this.provJoinpoint=t.provJoinpoint,this.name=t.name,this.fullName=t.fullName,this.params=t.params||[],this.args=t.args,this.returning=t.returning,this.throwing=t.throwing,this.state=t.state,this.advicer=t.advicer,this.annotations=t.annotations,this.target=t.target,this.targetType=t.targetType}return e.classAnnations={name:"Joinpoint",params:{constructor:["options"]}},e=r([t.Injectable(a.AopSymbols.IJoinpoint),m.NonePointcut(),i("design:paramtypes",[Object])],e)}();n.Joinpoint=c});e(j);var O=n(function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}n(S),n(j)});e(O);var w=n(function(e,n){var o=function(e){function n(){return e.call(this,s.AopActions.registAspect)||this}return r(n,e),n.prototype.working=function(e,n){if(b.isValideAspectTarget(n.targetType)){var o=e.get(a.AopSymbols.IAdvisor),r=t.getClassName(n.targetType),i=o.getAdvices(r+".constructor");if(i){var c=n.targetType,s=n.target,u=e.resolve(O.Joinpoint,t.Provider.create("options",{name:"constructor",state:O.JoinpointState.Before,fullName:r+".constructor",target:s,args:n.args,targetType:c})),f=[t.Provider.create(O.Joinpoint,u)],p=e.get(t.symbols.IMethodAccessor);i.Before.forEach(function(t){p.syncInvoke.apply(p,[t.aspectType,t.advice.propertyKey,void 0].concat(f))}),i.Around.forEach(function(t){p.syncInvoke.apply(p,[t.aspectType,t.advice.propertyKey,void 0].concat(f))})}}},n.classAnnations={name:"InvokeBeforeConstructorAction",params:{constructor:[],working:["container","data"]}},n}(t.ActionComposite);n.InvokeBeforeConstructorAction=o});e(w);var I=n(function(e,n){var o=function(e){function n(){return e.call(this,s.AopActions.invokeAfterConstructorAdvices)||this}return r(n,e),n.prototype.working=function(e,n){if(n.target&&b.isValideAspectTarget(n.targetType)){var o=e.get(a.AopSymbols.IAdvisor),r=t.getClassName(n.targetType),i=o.getAdvices(r+".constructor");if(i){var c=n.targetType,s=n.target,u=e.resolve(O.Joinpoint,t.Provider.create("options",{name:"constructor",state:O.JoinpointState.After,fullName:r+".constructor",target:s,args:n.args,targetType:c})),f=[t.Provider.create(O.Joinpoint,u)],p=e.get(t.symbols.IMethodAccessor);i.After.forEach(function(t){p.syncInvoke.apply(p,[t.aspectType,t.advice.propertyKey,void 0].concat(f))}),i.Around.forEach(function(t){p.syncInvoke.apply(p,[t.aspectType,t.advice.propertyKey,void 0].concat(f))})}}},n.classAnnations={name:"InvokeAfterConstructorAction",params:{constructor:[],working:["container","data"]}},n}(t.ActionComposite);n.InvokeAfterConstructorAction=o});e(I);var R=n(function(e,n){var o=function(t){function e(){return t.call(this,s.AopActions.matchPointcut)||this}return r(e,t),e.prototype.working=function(t,e){var n=this;if(b.isValideAspectTarget(e.targetType)){var o=t.get(a.AopSymbols.IAdvisor),r=t.get(a.AopSymbols.IAdviceMatcher);o.aspects.forEach(function(t,i){r.match(i,e.targetType,t).forEach(function(t){var e=t.fullName,r=t.advice,c=o.getAdvices(e);c||(c={Before:[],Pointcut:[],After:[],Around:[],AfterThrowing:[],AfterReturning:[]},o.setAdvices(e,c));var a=Object.assign(t,{aspectType:i});"Before"===r.adviceName?c.Before.some(function(t){return n.isAdviceEquals(t.advice,r)})||c.Before.push(a):"Pointcut"===r.adviceName?c.Pointcut.some(function(t){return n.isAdviceEquals(t.advice,r)})||c.Pointcut.push(a):"Around"===r.adviceName?c.Around.some(function(t){return n.isAdviceEquals(t.advice,r)})||c.Around.push(a):"After"===r.adviceName?c.After.some(function(t){return n.isAdviceEquals(t.advice,r)})||c.After.push(a):"AfterThrowing"===r.adviceName?c.AfterThrowing.some(function(t){return n.isAdviceEquals(t.advice,r)})||c.AfterThrowing.push(a):"AfterReturning"===r.adviceName&&(c.AfterReturning.some(function(t){return n.isAdviceEquals(t.advice,r)})||c.AfterReturning.push(a))})})}},e.prototype.isAdviceEquals=function(t,e){return!(!t||!e)&&(t===e||t.adviceName===e.adviceName&&t.pointcut===e.pointcut&&t.propertyKey===e.propertyKey)},e.classAnnations={name:"MatchPointcutAction",params:{constructor:[],working:["container","data"],isAdviceEquals:["advice1","advice2"]}},e}(t.ActionComposite);n.MatchPointcutAction=o});e(R);var M=n(function(t,e){var n=function(){function t(){}return t.prototype.create=function(t){var e;switch(t){case s.AopActions.registAspect:e=new u.RegistAspectAction;break;case s.AopActions.matchPointcut:e=new C.MatchPointcutAction;break;case s.AopActions.invokeBeforeConstructorAdvices:e=new C.InvokeBeforeConstructorAction;break;case s.AopActions.invokeAfterConstructorAdvices:e=new C.InvokeAfterConstructorAction;break;case s.AopActions.bindMethodPointcut:e=new C.BindMethodPointcutAction;break;case s.AopActions.exetndsInstance:e=new C.ExetndsInstanceAction}return e},t.classAnnations={name:"AopActionFactory",params:{create:["type"]}},t}();e.AopActionFactory=n});e(M);var k=n(function(e,n){var o=function(e){function n(){return e.call(this,s.AopActions.registAspect)||this}return r(n,e),n.prototype.working=function(e,n){!n.target||!n.providers||n.providers.length<1||n.providers.forEach(function(e){e&&e instanceof t.ExtendsProvider&&e.extends(n.target)})},n.classAnnations={name:"ExetndsInstanceAction",params:{constructor:[],working:["container","data"]}},n}(t.ActionComposite);n.ExetndsInstanceAction=o});e(k);var C=n(function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}n(s),n(u),n(P),n(w),n(I),n(R),n(M),n(k)});e(C);var T=n(function(e,n){var r=o&&o.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},s=function(){function e(t,e){this.container=t,this.advices=e}return e.prototype.getAdvicers=function(t){return(t?this.advices[t]:null)||[]},e.prototype.invoaction=function(t,e,n){switch(t.state=e,t.returning=void 0,t.throwing=void 0,e){case O.JoinpointState.Before:this.before(t);break;case O.JoinpointState.Pointcut:this.pointcut(t);break;case O.JoinpointState.After:t.returning=n,this.after(t);break;case O.JoinpointState.AfterThrowing:t.throwing=n,this.afterThrowing(t);break;case O.JoinpointState.AfterReturning:t.returning=n,this.afterReturning(t)}},e.prototype.before=function(e){var n=this,o=Object.assign({},e);this.getAdvicers("Around").forEach(function(t){n.invokeAdvice(o,t)}),t.isUndefined(o.args)||(e.args=o.args),this.getAdvicers("Before").forEach(function(t){n.invokeAdvice(o,t)})},e.prototype.pointcut=function(e){var n=this,o=Object.assign({},e);this.getAdvicers("Pointcut").forEach(function(t){n.invokeAdvice(o,t)}),t.isUndefined(o.args)||(e.args=o.args)},e.prototype.after=function(t){var e=this,n=Object.assign({},t);this.getAdvicers("Around").forEach(function(t){e.invokeAdvice(n,t)}),this.getAdvicers("After").forEach(function(t){e.invokeAdvice(n,t)})},e.prototype.afterThrowing=function(t){var e=this,n=Object.assign({},t);this.getAdvicers("Around").forEach(function(t){e.invokeAdvice(n,t)}),this.getAdvicers("AfterThrowing").forEach(function(t){e.invokeAdvice(n,t)})},e.prototype.afterReturning=function(e){var n=this,o=Object.assign({},e),r=this.container.resolve(a.AopSymbols.IAdvisorChain,{joinPoint:o});this.getAdvicers("Around").forEach(function(t){r.next(function(e){return n.invokeAdvice(e,t)})}),this.getAdvicers("AfterReturning").forEach(function(t){r.next(function(e){return n.invokeAdvice(e,t)})}),r.next(function(n){return t.isUndefined(n.returning)||(e.returning=n.returning),e}),r.process()},e.prototype.invokeAdvice=function(e,n){var o=this,r=[];r.push(t.Provider.createExtends(O.Joinpoint,e,function(t,e){t._cache_JoinPoint=e.resolve(o.container)}));var i=n.advice;return!t.isUndefined(e.args)&&i.args&&r.push(t.Provider.create(i.args,e.args)),i.annotationArgName&&r.push(t.Provider.create(i.annotationArgName,function(){for(var n=e,o=n.annotations;!o&&e.provJoinpoint;)if((n=e.provJoinpoint)&&n.annotations){o=n.annotations;break}if(t.isArray(o)){if(i.annotation){var r=i.annotation;return r=/^@/.test(r)?r:"@"+r,o.filter(function(t){return t.decorator===r})}return o}return[]})),!t.isUndefined(e.returning)&&i.returning&&r.push(t.Provider.create(i.returning,e.returning)),!t.isUndefined(e.throwing)&&i.throwing&&r.push(t.Provider.create(i.throwing,e.throwing)),(c=this.container).syncInvoke.apply(c,[n.aspectType,n.advice.propertyKey,null].concat(r));var c},e.classAnnations={name:"AdvisorChainFactory",params:{constructor:["container","advices"],getAdvicers:["adviceType"],invoaction:["joinPoint","state","valueOrthrowing"],before:["joinPoint"],pointcut:["joinPoint"],after:["joinPoint"],afterThrowing:["joinPoint"],afterReturning:["joinPoint"],invokeAdvice:["joinPoint","advicer"]}},e=r([m.NonePointcut(),t.Injectable(a.AopSymbols.IAdvisorChainFactory),c(0,t.Inject(t.symbols.IContainer)),i("design:paramtypes",[Object,Object])],e)}();n.AdvisorChainFactory=s});e(T);var _=n(function(e,n){var r=o&&o.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=function(){function e(t){this.joinPoint=t,this.actions=[]}return e.prototype.next=function(t){this.actions.push(t)},e.prototype.getRecognizer=function(){return this.container.get(t.symbols.IRecognizer,this.joinPoint.state)},e.prototype.process=function(){var t=this.getRecognizer().recognize(this.joinPoint.returning);(e=this.container.get(a.AopSymbols.IAdvisorProceeding,t)).proceeding.apply(e,[this.joinPoint].concat(this.actions));var e},e.classAnnations={name:"AdvisorChain",params:{constructor:["joinPoint"],next:["action"],getRecognizer:[],process:[]}},r([t.Inject(t.symbols.IContainer),i("design:type",Object)],e.prototype,"container",void 0),e=r([m.NonePointcut(),t.Injectable(a.AopSymbols.IAdvisorChain),i("design:paramtypes",[O.Joinpoint])],e)}();n.AdvisorChain=c});e(_);var x=n(function(e,n){var r=o&&o.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},s=O,u=function(){function e(t){this.container=t}return Object.defineProperty(e.prototype,"aspectMgr",{get:function(){return this._aspectMgr||(this._aspectMgr=this.container.get(a.AopSymbols.IAdvisor)),this._aspectMgr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"liefScope",{get:function(){return this._liefScope||(this._liefScope=this.container.getLifeScope()),this._liefScope},enumerable:!0,configurable:!0}),e.prototype.proceed=function(e,n,o,r){var i=this.aspectMgr,c=o.fullName,a=o.name,s=i.getAdvices(c);if(s&&o)if(o.descriptor&&(o.descriptor.get||o.descriptor.set)){if(o.descriptor.get){var u=o.descriptor.get.bind(e);o.descriptor.get=this.proxy(u,s,e,n,o,r)}if(o.descriptor.set){var f=o.descriptor.set.bind(e);o.descriptor.set=this.proxy(f,s,e,n,o,r)}Object.defineProperty(e,a,o.descriptor)}else if(t.isFunction(e[a])){var p=e[a].bind(e);e[a]=this.proxy(p,s,e,n,o,r)}},e.prototype.proxy=function(e,n,o,r,i,c){var u=this,f=i.fullName,p=i.name,d=this.liefScope,g=this.container;return function(){for(var i=[],v=0;v<arguments.length;v++)i[v]=arguments[v];var l=u.container.resolve(s.Joinpoint,t.Provider.create("options",{name:p,fullName:f,provJoinpoint:c,annotations:c?null:d.getMethodMetadatas(r,p),params:d.getMethodParameters(r,o,p),args:i,target:o,targetType:r})),A=g.resolve(a.AopSymbols.IAdvisorChainFactory,{container:g,advices:n});A.invoaction(l,O.JoinpointState.Before),A.invoaction(l,O.JoinpointState.Pointcut);var h,y;try{h=e.apply(void 0,l.args)}catch(t){y=t}if(A.invoaction(l,O.JoinpointState.After,h),!y)return A.invoaction(l,O.JoinpointState.AfterReturning,h),l.returning;A.invoaction(l,O.JoinpointState.AfterThrowing,y)}},e.classAnnations={name:"ProxyMethod",params:{constructor:["container"],proceed:["target","targetType","pointcut","provJoinpoint"],proxy:["propertyMethod","advices","target","targetType","pointcut","provJoinpoint"]}},e=r([m.NonePointcut(),t.Singleton(a.AopSymbols.IProxyMethod),c(0,t.Inject(t.symbols.IContainer)),i("design:paramtypes",[Object])],e)}();n.ProxyMethod=u});e(x);var E=n(function(t,e){!function(t){t.sync="sync",t.promise="promise",t.observable="observable"}(e.ReturningType||(e.ReturningType={}))});e(E);var N=n(function(e,n){var r=o&&o.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=function(){function e(){}return e.prototype.proceeding=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t.returning&&e.forEach(function(e){t.returning=t.returning.then(function(n){return t.returningValue=n,Promise.resolve(e(t)).then(function(){return t.returningValue})})})},e.classAnnations={name:"AsyncPromiseProceeding",params:{constructor:[],proceeding:["joinPoint","actions"]}},e=r([m.NonePointcut(),t.Singleton(a.AopSymbols.IAdvisorProceeding,E.ReturningType.promise),i("design:paramtypes",[])],e)}();n.AsyncPromiseProceeding=c});e(N);var J=n(function(e,n){var r=o&&o.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=function(){function e(){}return e.prototype.proceeding=function(e){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];t.isFunction(e.returning.flatMap)?n.forEach(function(n){e.returning=e.returning.flatMap(function(o){return e.returningValue=o,n(e),t.isObservable(e.returningValue)?e.returningValue:t.isPromise(e.returningValue)?e.returningValue:Promise.resolve(e.returningValue)})}):n.forEach(function(t){t(e)})},e.classAnnations={name:"AsyncObservableProceeding",params:{constructor:[],proceeding:["joinPoint","actions"]}},e=r([m.NonePointcut(),t.Singleton(a.AopSymbols.IAdvisorProceeding,E.ReturningType.observable),i("design:paramtypes",[])],e)}();n.AsyncObservableProceeding=c});e(J);var D=n(function(e,n){var r=o&&o.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},c=function(){function e(){}return e.prototype.recognize=function(e){return t.isPromise(e)?E.ReturningType.promise:t.isObservable(e)?E.ReturningType.observable:E.ReturningType.sync},e.classAnnations={name:"ReturningRecognizer",params:{constructor:[],recognize:["value"]}},e=r([m.NonePointcut(),t.Singleton(t.symbols.IRecognizer,O.JoinpointState.AfterReturning),i("design:paramtypes",[])],e)}();n.ReturningRecognizer=c});e(D);var B=n(function(e,n){var r=o&&o.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},i=function(){function e(){}return e.prototype.proceeding=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t.returningValue=t.returning,e.forEach(function(e){e(t)})},e.classAnnations={name:"SyncProceeding",params:{proceeding:["joinPoint","actions"]}},e=r([m.NonePointcut(),t.Singleton(a.AopSymbols.IAdvisorProceeding,E.ReturningType.sync)],e)}();n.SyncProceeding=i});e(B);var F=n(function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}n(T),n(_),n(x),n(N),n(J),n(D),n(E),n(B)});e(F);var V=n(function(e,n){var r=o&&o.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},s=function(){function e(e){this.container=e,this.aspects=new t.MapSet,this.advices=new t.MapSet}return e.prototype.setAdvices=function(t,e){this.advices.has(t)||this.advices.set(t,e)},e.prototype.getAdvices=function(t){return this.advices.has(t)?this.advices.get(t):null},e.prototype.hasRegisterAdvices=function(e){var n=this,o=Object.keys(Object.getOwnPropertyDescriptors(e.prototype)),r=t.getClassName(e);return o.some(function(t){return n.advices.has(r+"."+t)})},e.prototype.add=function(e){if(!this.aspects.has(e)){var n=t.getOwnMethodMetadata(m.Advice,e);this.aspects.set(e,n)}},e.classAnnations={name:"Advisor",params:{constructor:["container"],setAdvices:["key","advices"],getAdvices:["key"],hasRegisterAdvices:["targetType"],add:["aspect"]}},e=r([m.NonePointcut(),t.Singleton(a.AopSymbols.IAdvisor),c(0,t.Inject(t.symbols.IContainer)),i("design:paramtypes",[Object])],e)}();n.Advisor=s});e(V);var z=n(function(e,n){var r=o&&o.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},s=function(){function e(t){this.container=t}return e.prototype.match=function(e,n,o,r){var i=this,c=t.getClassName(n);o=o||t.getOwnMethodMetadata(m.Advice,n);this.container.get(a.AopSymbols.IAdvisor);var s=[];if(n===e){var u=Object.keys(o);if(u.length>1){var f=[];u.forEach(function(t){f=f.concat(o[t])}),u.forEach(function(t){f.forEach(function(e){e.propertyKey!==t&&i.matchAspectSelf(t,e)&&s.push({name:t,fullName:c+"."+t,advice:e})})})}}else{var p=[],d=Object.getOwnPropertyDescriptors(n.prototype);for(var g in d)p.push({name:g,fullName:c+"."+g});var v=t.getParamerterNames(n);Object.keys(v).forEach(function(e){"constructor"!==e&&t.isUndefined(d[e])&&p.push({name:e,fullName:c+"."+e})}),Object.getOwnPropertyNames(o).forEach(function(t){o[t].forEach(function(t){s=s.concat(i.filterPointcut(n,p,t))})})}return s},e.prototype.matchAspectSelf=function(e,n){if(n.pointcut){var o=n.pointcut;if(t.isString(o)){if(/^execution\(\S+\)$/.test(o))return(o=o.substring(10,o.length-1))===e}else if(t.isRegExp(o))return o.test(e)}return!1},e.prototype.filterPointcut=function(t,e,n){if(!n.pointcut)return[];var o;if(n.pointcut){var r=this.matchTypeFactory(t,n.pointcut);o=e.filter(function(t){return r(t.name,t.fullName,t)})}return(o=o||[]).map(function(t){return Object.assign({},t,{advice:n})})},e.prototype.matchTypeFactory=function(e,n){if(t.isString(n)){if(n=(n||"").trim(),/^@annotation\(\S+\)$/.test(n)){n=n.substring(12,n.length-1);var o=/^@/.test(n)?n:"@"+n;return function(n,r){return t.hasOwnMethodMetadata(o,e,n)&&!t.hasOwnClassMetadata(m.Aspect,e)}}if(/^execution\(\S+\)$/.test(n)&&(n=n.substring(10,n.length-1)),"*"===n||"*.*"===n)return function(n,o,r){return!!n&&!t.hasOwnClassMetadata(m.Aspect,e)};n=n.replace(/\*\*/gi,"(\\w+(\\.|\\/)){0,}\\w+").replace(/\*/gi,"\\w+").replace(/\./gi,"\\.").replace(/\//gi,"\\/");var r=new RegExp(n+"$");return function(t,e,n){return r.test(e)}}if(t.isRegExp(n)){var i=n;return/^\^?@\w+/.test(i.source)?function(n,o,r){return Reflect.getMetadataKeys(e,n).some(function(e){return t.isString(e)&&i.test(e)})}:function(t,e,n){return i.test(e)}}return null},e.classAnnations={name:"AdviceMatcher",params:{constructor:["container"],match:["aspectType","targetType","adviceMetas","instance"],matchAspectSelf:["name","metadata"],filterPointcut:["type","points","metadata"],matchTypeFactory:["type","pointcut"]}},e=r([m.NonePointcut(),t.Singleton(a.AopSymbols.IAdviceMatcher),c(0,t.Inject(t.symbols.IContainer)),i("design:paramtypes",[Object])],e)}();n.AdviceMatcher=s});e(z);var q=n(function(e,n){var r=o&&o.__decorate||function(t,e,n,o){var r,i=arguments.length,c=i<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(c=(i<3?r(c):i>3?r(e,n,c):r(e,n))||c);return i>3&&c&&Object.defineProperty(e,n,c),c},s=function(){function e(t){this.container=t}return e.prototype.setup=function(){var e=this.container;e.register(O.Joinpoint),e.register(F.AdvisorChainFactory),e.register(F.ReturningRecognizer),e.register(F.SyncProceeding),e.register(F.AsyncPromiseProceeding),e.register(F.AsyncObservableProceeding),e.register(F.AdvisorChain),e.register(F.ProxyMethod),e.register(V.Advisor),e.register(z.AdviceMatcher);var n=e.get(t.symbols.LifeScope),o=new M.AopActionFactory;n.addAction(o.create(C.AopActions.registAspect),t.IocState.design),n.addAction(o.create(C.AopActions.matchPointcut),t.IocState.runtime,t.LifeState.beforeConstructor),n.addAction(o.create(C.AopActions.bindMethodPointcut),t.IocState.runtime,t.LifeState.AfterInit),n.addAction(o.create(C.AopActions.invokeBeforeConstructorAdvices),t.IocState.runtime,t.LifeState.beforeConstructor),n.addAction(o.create(C.AopActions.exetndsInstance),t.IocState.runtime,t.LifeState.onInit,t.LifeState.afterConstructor),n.addAction(o.create(C.AopActions.invokeAfterConstructorAdvices),t.IocState.runtime,t.LifeState.afterConstructor),n.registerDecorator(m.Aspect,C.AopActions.registAspect,C.AopActions.exetndsInstance)},e.symbols=a.AopSymbols,e.classAnnations={name:"AopModule",params:{constructor:["container"],setup:[]}},e=r([t.IocModule("setup"),c(0,t.Inject(t.symbols.IContainer)),i("design:paramtypes",[Object])],e)}();n.AopModule=s});e(q);return e(n(function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}n(a),n(C),n(m),n(O),n(F),n(V),n(z),n(b),n(q)}))});
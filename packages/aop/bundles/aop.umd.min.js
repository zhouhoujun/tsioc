!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@ts-ioc/core")):"function"==typeof define&&define.amd?define(["@ts-ioc/core"],t):(e.aop=e.aop||{},e.aop.umd=e.aop.umd||{},e.aop.umd.js=t(e["@ts-ioc/core"]))}(this,function(e){"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return t={exports:{}},e(t,t.exports),t.exports}e=e&&e.hasOwnProperty("default")?e.default:e;var o="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=o&&o.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=(o&&o.__decorate,o&&o.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}),c=o&&o.__param||function(e,t){return function(n,o){t(n,o,e)}},a=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AopSymbols={IProxyMethod:Symbol("IProxyMethod"),IAdviceMatcher:Symbol("IAdviceMatcher"),IAdvisor:Symbol("IAdvisor"),IAdvisorChainFactory:Symbol("IAdvisorChainFactory"),IAdvisorChain:Symbol("IAdvisorChain"),IAdvisorProceeding:Symbol("IAdvisorProceeding"),IJoinpoint:Symbol("IJoinpoint")}});t(a);var s=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});!function(e){e.registAspect="registAspect",e.exetndsInstance="exetndsInstance",e.matchPointcut="matchPointcut",e.bindPropertyPointcut="bindPropertyPointcut",e.bindMethodPointcut="bindMethodPointcut",e.invokeBeforeConstructorAdvices="invokeBeforeConstructorAdvices",e.invokeAfterConstructorAdvices="invokeAfterConstructorAdvices"}(t.AopActions||(t.AopActions={}))});t(s);var u=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function n(){return t.call(this,s.AopActions.registAspect)||this}return r(n,t),n.prototype.working=function(t,n){var o=n.targetType,r=t.getLifeScope().getClassDecorators(function(t){return t.actions.includes(s.AopActions.registAspect)&&e.hasOwnClassMetadata(t.name,o)}),i=t.get(a.AopSymbols.IAdvisor);r.forEach(function(t){var n=e.getOwnTypeMetadata(t.name,o);Array.isArray(n)&&n.length>0&&n.forEach(function(t){e.isClass(t.type)&&i.add(t.type)})})},n.classAnnations={name:"RegistAspectAction",params:{constructor:[],working:["container","data"]}},n}(e.ActionComposite);n.RegistAspectAction=o});t(u);var f=n(function(t,n){function o(t,n,o,r){return e.createMethodDecorator("Advice",function(t){n&&n(t),t.next({isMetadata:function(t){return e.isClassMetadata(t,["pointcut"])},match:function(t){return e.isString(t)||e.isRegExp(t)},setMetadata:function(e,t){e.pointcut=t}}),o&&o(t),t.next({match:function(t){return e.isString(t)},setMetadata:function(e,t){e.annotationArgName=t}}),t.next({match:function(t){return e.isString(t)},setMetadata:function(e,t){e.annotation=t}})},function(e){return r&&(e=r(e)),e.adviceName=t,e})}Object.defineProperty(n,"__esModule",{value:!0}),n.createAdviceDecorator=o,n.Advice=o("Advice")});t(f);var p=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.Aspect=e.createClassDecorator("Aspect")});t(p);var d=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.After=f.createAdviceDecorator("After")});t(d);var v=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AfterReturning=f.createAdviceDecorator("AfterReturning",null,function(t){t.next({match:function(t){return e.isString(t)},setMetadata:function(e,t){e.returning=t}})})});t(v);var l=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.AfterThrowing=f.createAdviceDecorator("AfterThrowing",null,function(t){t.next({match:function(t){return e.isString(t)},setMetadata:function(e,t){e.throwing=t}})})});t(l);var g=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.Around=f.createAdviceDecorator("Around",null,function(t){t.next({match:function(t){return e.isString(t)},setMetadata:function(e,t){e.args=t}}),t.next({match:function(t){return e.isString(t)},setMetadata:function(e,t){e.returning=t}}),t.next({match:function(t){return e.isString(t)},setMetadata:function(e,t){e.throwing=t}})})});t(g);var y=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Before=f.createAdviceDecorator("Before")});t(y);var A=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Pointcut=f.createAdviceDecorator("Pointcut")});t(A);var h=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.NonePointcut=e.createClassDecorator("NonePointcut")});t(h);var m=n(function(e,t){function n(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(f),n(p),n(d),n(v),n(l),n(g),n(y),n(A),n(h)});t(m);var b=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isValideAspectTarget=function(t){return!(!e.isClass(t)||t===Object||t===String||t===Date||t===Boolean||t===Number||e.hasOwnClassMetadata(m.NonePointcut,t))}});t(b);var P=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function n(){return t.call(this,s.AopActions.bindMethodPointcut)||this}return r(n,t),n.prototype.working=function(t,n){if(n.target&&b.isValideAspectTarget(n.targetType)){var o=t.get(a.AopSymbols.IProxyMethod),r=n.target,i=n.targetType,c=e.getClassName(i),s=[],u=Object.getOwnPropertyDescriptors(i.prototype);Object.keys(u).forEach(function(e){"constructor"!==e&&s.push({name:e,fullName:c+"."+e,descriptor:u[e]})});var f=e.getParamerterNames(i);Object.keys(f).forEach(function(t){"constructor"!==t&&e.isUndefined(u[t])&&s.push({name:t,fullName:c+"."+t})}),s.forEach(function(e){o.proceed(r,i,e,r._cache_JoinPoint)})}},n.classAnnations={name:"BindMethodPointcutAction",params:{constructor:[],working:["container","data"]}},n}(e.ActionComposite);n.BindMethodPointcutAction=o});t(P);var j=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});!function(e){e.Before="Before",e.Pointcut="Pointcut",e.After="After",e.AfterReturning="AfterReturning",e.AfterThrowing="AfterThrowing"}(t.JoinpointState||(t.JoinpointState={}))});t(j);var O=n(function(t,n){var r=o&&o.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function t(e){this.provJoinpoint=e.provJoinpoint,this.name=e.name,this.fullName=e.fullName,this.params=e.params||[],this.args=e.args,this.returning=e.returning,this.throwing=e.throwing,this.state=e.state,this.advicer=e.advicer,this.annotations=e.annotations,this.target=e.target,this.targetType=e.targetType}return t.classAnnations={name:"Joinpoint",params:{constructor:["options"]}},t=r([e.Injectable(a.AopSymbols.IJoinpoint),m.NonePointcut(),i("design:paramtypes",[Object])],t)}();n.Joinpoint=c});t(O);var _=n(function(e,t){function n(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(j),n(O)});t(_);var M=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function n(){return t.call(this,s.AopActions.registAspect)||this}return r(n,t),n.prototype.working=function(t,n){if(b.isValideAspectTarget(n.targetType)){var o=t.get(a.AopSymbols.IAdvisor),r=e.getClassName(n.targetType),i=o.getAdvices(r+".constructor");if(i){var c=n.targetType,s=n.target,u=t.resolve(_.Joinpoint,e.Provider.create("options",{name:"constructor",state:_.JoinpointState.Before,fullName:r+".constructor",target:s,args:n.args,targetType:c})),f=[e.Provider.create(_.Joinpoint,u)],p=t.get(e.symbols.IMethodAccessor);i.Before.forEach(function(e){p.syncInvoke.apply(p,[e.aspectType,e.advice.propertyKey,void 0].concat(f))}),i.Around.forEach(function(e){p.syncInvoke.apply(p,[e.aspectType,e.advice.propertyKey,void 0].concat(f))})}}},n.classAnnations={name:"InvokeBeforeConstructorAction",params:{constructor:[],working:["container","data"]}},n}(e.ActionComposite);n.InvokeBeforeConstructorAction=o});t(M);var S=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function n(){return t.call(this,s.AopActions.invokeAfterConstructorAdvices)||this}return r(n,t),n.prototype.working=function(t,n){if(n.target&&b.isValideAspectTarget(n.targetType)){var o=t.get(a.AopSymbols.IAdvisor),r=e.getClassName(n.targetType),i=o.getAdvices(r+".constructor");if(i){var c=n.targetType,s=n.target,u=t.resolve(_.Joinpoint,e.Provider.create("options",{name:"constructor",state:_.JoinpointState.After,fullName:r+".constructor",target:s,args:n.args,targetType:c})),f=[e.Provider.create(_.Joinpoint,u)],p=t.get(e.symbols.IMethodAccessor);i.After.forEach(function(e){p.syncInvoke.apply(p,[e.aspectType,e.advice.propertyKey,void 0].concat(f))}),i.Around.forEach(function(e){p.syncInvoke.apply(p,[e.aspectType,e.advice.propertyKey,void 0].concat(f))})}}},n.classAnnations={name:"InvokeAfterConstructorAction",params:{constructor:[],working:["container","data"]}},n}(e.ActionComposite);n.InvokeAfterConstructorAction=o});t(S);var w=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=function(e){function t(){return e.call(this,s.AopActions.matchPointcut)||this}return r(t,e),t.prototype.working=function(e,t){var n=this;if(b.isValideAspectTarget(t.targetType)){var o=e.get(a.AopSymbols.IAdvisor),r=e.get(a.AopSymbols.IAdviceMatcher);o.aspects.forEach(function(e,i){r.match(i,t.targetType,e).forEach(function(e){var t=e.fullName,r=e.advice,c=o.getAdvices(t);c||(c={Before:[],Pointcut:[],After:[],Around:[],AfterThrowing:[],AfterReturning:[]},o.setAdvices(t,c));var a=Object.assign(e,{aspectType:i});"Before"===r.adviceName?c.Before.some(function(e){return n.isAdviceEquals(e.advice,r)})||c.Before.push(a):"Pointcut"===r.adviceName?c.Pointcut.some(function(e){return n.isAdviceEquals(e.advice,r)})||c.Pointcut.push(a):"Around"===r.adviceName?c.Around.some(function(e){return n.isAdviceEquals(e.advice,r)})||c.Around.push(a):"After"===r.adviceName?c.After.some(function(e){return n.isAdviceEquals(e.advice,r)})||c.After.push(a):"AfterThrowing"===r.adviceName?c.AfterThrowing.some(function(e){return n.isAdviceEquals(e.advice,r)})||c.AfterThrowing.push(a):"AfterReturning"===r.adviceName&&(c.AfterReturning.some(function(e){return n.isAdviceEquals(e.advice,r)})||c.AfterReturning.push(a))})})}},t.prototype.isAdviceEquals=function(e,t){return!(!e||!t)&&(e===t||e.adviceName===t.adviceName&&e.pointcut===t.pointcut&&e.propertyKey===t.propertyKey)},t.classAnnations={name:"MatchPointcutAction",params:{constructor:[],working:["container","data"],isAdviceEquals:["advice1","advice2"]}},t}(e.ActionComposite);n.MatchPointcutAction=o});t(w);var I=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.create=function(e){var t;switch(e){case s.AopActions.registAspect:t=new u.RegistAspectAction;break;case s.AopActions.matchPointcut:t=new k.MatchPointcutAction;break;case s.AopActions.invokeBeforeConstructorAdvices:t=new k.InvokeBeforeConstructorAction;break;case s.AopActions.invokeAfterConstructorAdvices:t=new k.InvokeAfterConstructorAction;break;case s.AopActions.bindMethodPointcut:t=new k.BindMethodPointcutAction;break;case s.AopActions.exetndsInstance:t=new k.ExetndsInstanceAction}return t},e.classAnnations={name:"AopActionFactory",params:{create:["type"]}},e}();t.AopActionFactory=n});t(I);var R=n(function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var o=function(t){function n(){return t.call(this,s.AopActions.registAspect)||this}return r(n,t),n.prototype.working=function(t,n){!n.target||!n.providers||n.providers.length<1||n.providers.forEach(function(t){t&&t instanceof e.ExtendsProvider&&t.extends(n.target)})},n.classAnnations={name:"ExetndsInstanceAction",params:{constructor:[],working:["container","data"]}},n}(e.ActionComposite);n.ExetndsInstanceAction=o});t(R);var k=n(function(e,t){function n(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(s),n(u),n(P),n(M),n(S),n(w),n(I),n(R)});t(k);var C=n(function(t,n){var r=o&&o.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(e,t){this.container=e,this.advices=t}return t.prototype.getAdvicers=function(e){return(e?this.advices[e]:null)||[]},t.prototype.invoaction=function(e,t,n){switch(e.state=t,e.returning=void 0,e.throwing=void 0,t){case _.JoinpointState.Before:this.before(e);break;case _.JoinpointState.Pointcut:this.pointcut(e);break;case _.JoinpointState.After:e.returning=n,this.after(e);break;case _.JoinpointState.AfterThrowing:e.throwing=n,this.afterThrowing(e);break;case _.JoinpointState.AfterReturning:e.returning=n,this.afterReturning(e)}},t.prototype.before=function(t){var n=this,o=Object.assign({},t);this.getAdvicers("Around").forEach(function(e){n.invokeAdvice(o,e)}),e.isUndefined(o.args)||(t.args=o.args),this.getAdvicers("Before").forEach(function(e){n.invokeAdvice(o,e)})},t.prototype.pointcut=function(t){var n=this,o=Object.assign({},t);this.getAdvicers("Pointcut").forEach(function(e){n.invokeAdvice(o,e)}),e.isUndefined(o.args)||(t.args=o.args)},t.prototype.after=function(e){var t=this,n=Object.assign({},e);this.getAdvicers("Around").forEach(function(e){t.invokeAdvice(n,e)}),this.getAdvicers("After").forEach(function(e){t.invokeAdvice(n,e)})},t.prototype.afterThrowing=function(e){var t=this,n=Object.assign({},e);this.getAdvicers("Around").forEach(function(e){t.invokeAdvice(n,e)}),this.getAdvicers("AfterThrowing").forEach(function(e){t.invokeAdvice(n,e)})},t.prototype.afterReturning=function(t){var n=this,o=Object.assign({},t),r=this.container.resolve(a.AopSymbols.IAdvisorChain,{joinPoint:o});this.getAdvicers("Around").forEach(function(e){r.next(function(t){return n.invokeAdvice(t,e)})}),this.getAdvicers("AfterReturning").forEach(function(e){r.next(function(t){return n.invokeAdvice(t,e)})}),r.next(function(n){return e.isUndefined(n.returning)||(t.returning=n.returning),t}),r.process()},t.prototype.invokeAdvice=function(t,n){var o=this,r=[];r.push(e.Provider.createExtends(_.Joinpoint,t,function(e,t){e._cache_JoinPoint=t.resolve(o.container)}));var i=n.advice;return!e.isUndefined(t.args)&&i.args&&r.push(e.Provider.create(i.args,t.args)),i.annotationArgName&&r.push(e.Provider.create(i.annotationArgName,function(){for(var n=t,o=n.annotations;!o&&t.provJoinpoint;)if((n=t.provJoinpoint)&&n.annotations){o=n.annotations;break}if(e.isArray(o)){if(i.annotation){var r=i.annotation;return r=/^@/.test(r)?r:"@"+r,o.filter(function(e){return e.decorator===r})}return o}return[]})),!e.isUndefined(t.returning)&&i.returning&&r.push(e.Provider.create(i.returning,t.returning)),!e.isUndefined(t.throwing)&&i.throwing&&r.push(e.Provider.create(i.throwing,t.throwing)),(c=this.container).syncInvoke.apply(c,[n.aspectType,n.advice.propertyKey,null].concat(r));var c},t.classAnnations={name:"AdvisorChainFactory",params:{constructor:["container","advices"],getAdvicers:["adviceType"],invoaction:["joinPoint","state","valueOrthrowing"],before:["joinPoint"],pointcut:["joinPoint"],after:["joinPoint"],afterThrowing:["joinPoint"],afterReturning:["joinPoint"],invokeAdvice:["joinPoint","advicer"]}},t=r([m.NonePointcut(),e.Injectable(a.AopSymbols.IAdvisorChainFactory),c(0,e.Inject(e.symbols.IContainer)),i("design:paramtypes",[Object,Object])],t)}();n.AdvisorChainFactory=s});t(C);var T=n(function(t,n){var r=o&&o.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function t(e){this.joinPoint=e,this.actions=[]}return t.prototype.next=function(e){this.actions.push(e)},t.prototype.getRecognizer=function(){return this.container.get(e.symbols.IRecognizer,this.joinPoint.state)},t.prototype.process=function(){var e=this.getRecognizer().recognize(this.joinPoint.returning);(t=this.container.get(a.AopSymbols.IAdvisorProceeding,e)).proceeding.apply(t,[this.joinPoint].concat(this.actions));var t},t.classAnnations={name:"AdvisorChain",params:{constructor:["joinPoint"],next:["action"],getRecognizer:[],process:[]}},r([e.Inject(e.symbols.IContainer),i("design:type",Object)],t.prototype,"container",void 0),t=r([m.NonePointcut(),e.Injectable(a.AopSymbols.IAdvisorChain),i("design:paramtypes",[_.Joinpoint])],t)}();n.AdvisorChain=c});t(T);var x=n(function(t,n){var r=o&&o.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var s=_,u=function(){function t(e){this.container=e}return Object.defineProperty(t.prototype,"aspectMgr",{get:function(){return this._aspectMgr||(this._aspectMgr=this.container.get(a.AopSymbols.IAdvisor)),this._aspectMgr},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"liefScope",{get:function(){return this._liefScope||(this._liefScope=this.container.getLifeScope()),this._liefScope},enumerable:!0,configurable:!0}),t.prototype.proceed=function(t,n,o,r){var i=this.aspectMgr,c=o.fullName,a=o.name,s=i.getAdvices(c);if(s&&o)if(o.descriptor&&(o.descriptor.get||o.descriptor.set)){if(o.descriptor.get){var u=o.descriptor.get.bind(t);o.descriptor.get=this.proxy(u,s,t,n,o,r)}if(o.descriptor.set){var f=o.descriptor.set.bind(t);o.descriptor.set=this.proxy(f,s,t,n,o,r)}Object.defineProperty(t,a,o.descriptor)}else if(e.isFunction(t[a])){var p=t[a].bind(t);t[a]=this.proxy(p,s,t,n,o,r)}},t.prototype.proxy=function(t,n,o,r,i,c){var u=this,f=i.fullName,p=i.name,d=this.liefScope,v=this.container;return function(){for(var i=[],l=0;l<arguments.length;l++)i[l]=arguments[l];var g=u.container.resolve(s.Joinpoint,e.Provider.create("options",{name:p,fullName:f,provJoinpoint:c,annotations:c?null:d.getMethodMetadatas(r,p),params:d.getMethodParameters(r,o,p),args:i,target:o,targetType:r})),y=v.resolve(a.AopSymbols.IAdvisorChainFactory,{container:v,advices:n});y.invoaction(g,_.JoinpointState.Before),y.invoaction(g,_.JoinpointState.Pointcut);var A,h;try{A=t.apply(void 0,g.args)}catch(e){h=e}if(y.invoaction(g,_.JoinpointState.After,A),!h)return y.invoaction(g,_.JoinpointState.AfterReturning,A),g.returning;y.invoaction(g,_.JoinpointState.AfterThrowing,h)}},t.classAnnations={name:"ProxyMethod",params:{constructor:["container"],proceed:["target","targetType","pointcut","provJoinpoint"],proxy:["propertyMethod","advices","target","targetType","pointcut","provJoinpoint"]}},t=r([m.NonePointcut(),e.Singleton(a.AopSymbols.IProxyMethod),c(0,e.Inject(e.symbols.IContainer)),i("design:paramtypes",[Object])],t)}();n.ProxyMethod=u});t(x);var E=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});!function(e){e.sync="sync",e.promise="promise",e.observable="observable"}(t.ReturningType||(t.ReturningType={}))});t(E);var N=n(function(t,n){var r=o&&o.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function t(){}return t.prototype.proceeding=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e.returning&&t.forEach(function(t){e.returning=e.returning.then(function(n){return e.returningValue=n,Promise.resolve(t(e)).then(function(){return e.returningValue})})})},t.classAnnations={name:"AsyncPromiseProceeding",params:{constructor:[],proceeding:["joinPoint","actions"]}},t=r([m.NonePointcut(),e.Singleton(a.AopSymbols.IAdvisorProceeding,E.ReturningType.promise),i("design:paramtypes",[])],t)}();n.AsyncPromiseProceeding=c});t(N);var J=n(function(t,n){var r=o&&o.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function t(){}return t.prototype.proceeding=function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];e.isFunction(t.returning.flatMap)?n.forEach(function(n){t.returning=t.returning.flatMap(function(o){return t.returningValue=o,n(t),e.isObservable(t.returningValue)?t.returningValue:e.isPromise(t.returningValue)?t.returningValue:Promise.resolve(t.returningValue)})}):n.forEach(function(e){e(t)})},t.classAnnations={name:"AsyncObservableProceeding",params:{constructor:[],proceeding:["joinPoint","actions"]}},t=r([m.NonePointcut(),e.Singleton(a.AopSymbols.IAdvisorProceeding,E.ReturningType.observable),i("design:paramtypes",[])],t)}();n.AsyncObservableProceeding=c});t(J);var D=n(function(t,n){var r=o&&o.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function t(){}return t.prototype.recognize=function(t){return e.isPromise(t)?E.ReturningType.promise:e.isObservable(t)?E.ReturningType.observable:E.ReturningType.sync},t.classAnnations={name:"ReturningRecognizer",params:{constructor:[],recognize:["value"]}},t=r([m.NonePointcut(),e.Singleton(e.symbols.IRecognizer,_.JoinpointState.AfterReturning),i("design:paramtypes",[])],t)}();n.ReturningRecognizer=c});t(D);var B=n(function(t,n){var r=o&&o.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.proceeding=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];e.returningValue=e.returning,t.forEach(function(t){t(e)})},t.classAnnations={name:"SyncProceeding",params:{proceeding:["joinPoint","actions"]}},t=r([m.NonePointcut(),e.Singleton(a.AopSymbols.IAdvisorProceeding,E.ReturningType.sync)],t)}();n.SyncProceeding=i});t(B);var F=n(function(e,t){function n(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(C),n(T),n(x),n(N),n(J),n(D),n(E),n(B)});t(F);var V=n(function(t,n){var r=o&&o.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(t){this.container=t,this.aspects=new e.MapSet,this.advices=new e.MapSet}return t.prototype.setAdvices=function(e,t){this.advices.has(e)||this.advices.set(e,t)},t.prototype.getAdvices=function(e){return this.advices.has(e)?this.advices.get(e):null},t.prototype.hasRegisterAdvices=function(t){var n=this,o=Object.keys(Object.getOwnPropertyDescriptors(t.prototype)),r=e.getClassName(t);return o.some(function(e){return n.advices.has(r+"."+e)})},t.prototype.add=function(t){if(!this.aspects.has(t)){var n=e.getOwnMethodMetadata(m.Advice,t);this.aspects.set(t,n)}},t.classAnnations={name:"Advisor",params:{constructor:["container"],setAdvices:["key","advices"],getAdvices:["key"],hasRegisterAdvices:["targetType"],add:["aspect"]}},t=r([m.NonePointcut(),e.Singleton(a.AopSymbols.IAdvisor),c(0,e.Inject(e.symbols.IContainer)),i("design:paramtypes",[Object])],t)}();n.Advisor=s});t(V);var z=n(function(t,n){var r=o&&o.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(e){this.container=e}return t.prototype.match=function(t,n,o,r){var i=this,c=e.getClassName(n);o=o||e.getOwnMethodMetadata(m.Advice,n);this.container.get(a.AopSymbols.IAdvisor);var s=[];if(n===t){var u=Object.keys(o);if(u.length>1){var f=[];u.forEach(function(e){f=f.concat(o[e])}),u.forEach(function(e){f.forEach(function(t){t.propertyKey!==e&&i.matchAspectSelf(e,t)&&s.push({name:e,fullName:c+"."+e,advice:t})})})}}else{var p=[],d=Object.getOwnPropertyDescriptors(n.prototype);for(var v in d)p.push({name:v,fullName:c+"."+v});var l=e.getParamerterNames(n);Object.keys(l).forEach(function(t){"constructor"!==t&&e.isUndefined(d[t])&&p.push({name:t,fullName:c+"."+t})}),Object.getOwnPropertyNames(o).forEach(function(e){o[e].forEach(function(e){s=s.concat(i.filterPointcut(n,p,e))})})}return s},t.prototype.matchAspectSelf=function(t,n){if(n.pointcut){var o=n.pointcut;if(e.isString(o)){if(/^execution\(\S+\)$/.test(o))return(o=o.substring(10,o.length-1))===t}else if(e.isRegExp(o))return o.test(t)}return!1},t.prototype.filterPointcut=function(e,t,n){if(!n.pointcut)return[];var o;if(n.pointcut){var r=this.matchTypeFactory(e,n.pointcut);o=t.filter(function(e){return r(e.name,e.fullName,e)})}return(o=o||[]).map(function(e){return Object.assign({},e,{advice:n})})},t.prototype.matchTypeFactory=function(t,n){if(e.isString(n)){if(n=(n||"").trim(),/^@annotation\(\S+\)$/.test(n)){n=n.substring(12,n.length-1);var o=/^@/.test(n)?n:"@"+n;return function(n,r){return e.hasOwnMethodMetadata(o,t,n)&&!e.hasOwnClassMetadata(m.Aspect,t)}}if(/^execution\(\S+\)$/.test(n)&&(n=n.substring(10,n.length-1)),"*"===n||"*.*"===n)return function(n,o,r){return!!n&&!e.hasOwnClassMetadata(m.Aspect,t)};n=n.replace(/\*\*/gi,"(\\w+(\\.|\\/)){0,}\\w+").replace(/\*/gi,"\\w+").replace(/\./gi,"\\.").replace(/\//gi,"\\/");var r=new RegExp(n+"$");return function(e,t,n){return r.test(t)}}if(e.isRegExp(n)){var i=n;return/^\^?@\w+/.test(i.source)?function(n,o,r){return Reflect.getMetadataKeys(t,n).some(function(t){return e.isString(t)&&i.test(t)})}:function(e,t,n){return i.test(t)}}return null},t.classAnnations={name:"AdviceMatcher",params:{constructor:["container"],match:["aspectType","targetType","adviceMetas","instance"],matchAspectSelf:["name","metadata"],filterPointcut:["type","points","metadata"],matchTypeFactory:["type","pointcut"]}},t=r([m.NonePointcut(),e.Singleton(a.AopSymbols.IAdviceMatcher),c(0,e.Inject(e.symbols.IContainer)),i("design:paramtypes",[Object])],t)}();n.AdviceMatcher=s});t(z);var q=n(function(t,n){var r=o&&o.__decorate||function(e,t,n,o){var r,i=arguments.length,c=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(c=(i<3?r(c):i>3?r(t,n,c):r(t,n))||c);return i>3&&c&&Object.defineProperty(t,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function t(e){this.container=e}return t.prototype.setup=function(){var t=this.container;t.register(_.Joinpoint),t.register(F.AdvisorChainFactory),t.register(F.ReturningRecognizer),t.register(F.SyncProceeding),t.register(F.AsyncPromiseProceeding),t.register(F.AsyncObservableProceeding),t.register(F.AdvisorChain),t.register(F.ProxyMethod),t.register(V.Advisor),t.register(z.AdviceMatcher);var n=t.get(e.symbols.LifeScope),o=new I.AopActionFactory;n.addAction(o.create(k.AopActions.registAspect),e.IocState.design),n.addAction(o.create(k.AopActions.matchPointcut),e.IocState.runtime,e.LifeState.beforeConstructor),n.addAction(o.create(k.AopActions.bindMethodPointcut),e.IocState.runtime,e.LifeState.AfterInit),n.addAction(o.create(k.AopActions.invokeBeforeConstructorAdvices),e.IocState.runtime,e.LifeState.beforeConstructor),n.addAction(o.create(k.AopActions.exetndsInstance),e.IocState.runtime,e.LifeState.onInit,e.LifeState.afterConstructor),n.addAction(o.create(k.AopActions.invokeAfterConstructorAdvices),e.IocState.runtime,e.LifeState.afterConstructor),n.registerDecorator(m.Aspect,k.AopActions.registAspect,k.AopActions.exetndsInstance)},t.symbols=a.AopSymbols,t.classAnnations={name:"AopModule",params:{constructor:["container"],setup:[]}},t=r([e.IocModule("setup"),c(0,e.Inject(e.symbols.IContainer)),i("design:paramtypes",[Object])],t)}();n.AopModule=s});t(q);return t(n(function(e,t){function n(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),n(a),n(k),n(m),n(_),n(F),n(V),n(z),n(b),n(q)}))});
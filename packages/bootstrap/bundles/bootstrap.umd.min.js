!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("tslib"),require("@ts-ioc/core"),require("reflect-metadata")):"function"==typeof define&&define.amd?define(["tslib","@ts-ioc/core","reflect-metadata"],t):(e.bootstrap=e.bootstrap||{},e.bootstrap.umd=e.bootstrap.umd||{},e.bootstrap.umd.js=t(e.tslib_1,e.core_1,e.Reflect))}(this,function(g,h,e){"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}g=g&&g.hasOwnProperty("default")?g.default:g,h=h&&h.hasOwnProperty("default")?h.default:h,e=e&&e.hasOwnProperty("default")?e.default:e;var o=n(function(e,t){function n(e,t,n,o){return h.createClassDecorator(e,function(e){n&&n(e)},function(e){return o&&(e=o(e)),t&&!e.annotationBuilder&&(e.annotationBuilder=t),e})}Object.defineProperty(t,"__esModule",{value:!0}),t.createAnnotationDecorator=n,t.Annotation=n("Annotation")});t(o);o.createAnnotationDecorator,o.Annotation;var i=n(function(e,t){function n(t,n,o,r,i){return h.createClassDecorator(t,function(e){r&&r(e)},function(e){(i&&(e=i(e)),!e.name&&h.isClass(e.token))&&(/^[a-z]$/.test(e.token.name)&&e.token.classAnnations?e.name=e.token.classAnnations.name:e.name=e.token.name);return e.decorType=t,n&&!e.builder&&(e.builder=n),o&&!e.annotationBuilder&&(e.annotationBuilder=o),e})}Object.defineProperty(t,"__esModule",{value:!0}),t.createDIModuleDecorator=n,t.DIModule=n("DIModule")});t(i);i.createDIModuleDecorator,i.DIModule;var r=n(function(e,t){function n(e,t,n,o,r){return i.createDIModuleDecorator(e,t,n,o,function(n){return r&&r(n),n.builder&&setTimeout(function(){var e,t=n.builder;h.isClass(t)?e=h.isFunction(t.create)?t.create():new t:h.isObject(t)&&(e=t),e&&(n.globals&&e.use.apply(e,n.globals),e.bootstrap(n.type))},500),n})}Object.defineProperty(t,"__esModule",{value:!0}),t.createBootstrapDecorator=n,t.Bootstrap=n("Bootstrap")});t(r);r.createBootstrapDecorator,r.Bootstrap;var u=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),g.__exportStar(o,t),g.__exportStar(i,t),g.__exportStar(r,t)});t(u);var a=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AppConfigureToken=new h.InjectToken("DI_APP_Configuration"),t.DefaultConfigureToken=new h.InjectToken("DI_Default_Configuration"),t.AppConfigureLoaderToken=new h.InjectToken("DI_Configure_Loader")});t(a);a.AppConfigureToken,a.DefaultConfigureToken,a.AppConfigureLoaderToken;var c=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="DI_ModuleBuilder",o=function(t){function e(e){return t.call(this,e,n)||this}return g.__extends(e,t),e.classAnnations={name:"InjectModuleBuilderToken",params:{constructor:["type"]}},e}(h.Registration);t.InjectModuleBuilderToken=o,t.DefaultModuleBuilderToken=new o(Object),t.ModuleBuilderToken=new h.Registration(Object,n)});t(c);c.InjectModuleBuilderToken,c.DefaultModuleBuilderToken,c.ModuleBuilderToken;var d=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="DI_AnnotationBuilder",o=function(t){function e(e){return t.call(this,e,n)||this}return g.__extends(e,t),e.classAnnations={name:"InjectAnnotationBuilder",params:{constructor:["type"]}},e}(h.Registration);t.InjectAnnotationBuilder=o,t.AnnotationBuilderToken=new h.Registration(Object,n),t.DefaultAnnotationBuilderToken=new o("default")});t(d);d.InjectAnnotationBuilder,d.AnnotationBuilderToken,d.DefaultAnnotationBuilderToken;var f=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}var r;return(r=e).prototype.build=function(o,r,i){return g.__awaiter(this,void 0,void 0,function(){var t,n;return g.__generator(this,function(e){switch(e.label){case 0:return r=this.getTokenMetaConfig(o,r),t=this.getBuilder(o,r),this.isEqual(t)?[3,1]:[2,t.build(o,r,i)];case 1:return[4,this.createInstance(o,r,i)];case 2:return(n=e.sent())?h.isFunction(n.anBeforeInit)?[4,Promise.resolve(n.anBeforeInit(r))]:[3,4]:[2,null];case 3:e.sent(),e.label=4;case 4:return[4,this.buildStrategy(n,r)];case 5:return n=e.sent(),h.isFunction(n.anAfterInit)?[4,Promise.resolve(n.anAfterInit(r))]:[3,7];case 6:e.sent(),e.label=7;case 7:return[2,n]}})})},e.prototype.buildByConfig=function(n,o){return g.__awaiter(this,void 0,void 0,function(){var t;return g.__generator(this,function(e){return h.isToken(n)?(t=n,[2,this.build(t,null,o)]):(t=this.getType(n),[2,this.build(t,n,o)])})})},e.prototype.createInstance=function(t,e,n){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(e){if(!t)return console.log("can not find annotation token."),[2,null];if(!this.container.has(t)){if(!h.isClass(t))return console.log("can not find token "+(t?t.toString():null)+" in container."),[2,null];this.container.register(t)}return[2,this.resolveToken(t,n)]})})},e.prototype.getBuilder=function(e,t){var n,o=this;return t&&t.annotationBuilder&&(h.isClass(t.annotationBuilder)&&(this.container.has(t.annotationBuilder)||this.container.register(t.annotationBuilder)),h.isToken(t.annotationBuilder)?n=this.container.resolve(t.annotationBuilder,{container:this.container}):t.annotationBuilder instanceof r&&(n=t.annotationBuilder)),!n&&e&&this.container.getTokenExtendsChain(e).forEach(function(e){if(n)return!1;var t=new d.InjectAnnotationBuilder(e);return o.container.has(t)&&(n=o.container.resolve(t,{container:o.container})),!0}),n&&!n.container&&(n.container=this.container),n||this},e.prototype.buildStrategy=function(t,e){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(e){return[2,t]})})},e.prototype.getType=function(e){return e.token||e.type},e.prototype.getTokenMetaConfig=function(e,t){var n;if(h.isClass(e))n=this.getMetaConfig(e);else if(h.isToken(e)){var o=this.container?this.container.getTokenImpl(e):e;h.isClass(o)&&(n=this.getMetaConfig(o))}return n?h.lang.assign({},n,t||{}):t||{}},e.prototype.getDecorator=function(){return u.Annotation.toString()},e.prototype.getMetaConfig=function(e){var t=this.getDecorator();if(h.hasOwnClassMetadata(t,e)){var n=h.getTypeMetadata(t,e);if(n&&n.length)return n[0]}return null},e.prototype.isEqual=function(e){return!!e&&(e===this||e.constructor===this.constructor)},e.prototype.resolveToken=function(e,t){return this.container.resolve(e,t)},e.classAnnations={name:"AnnotationBuilder",params:{constructor:[],build:["token","config","data"],buildByConfig:["config","data"],createInstance:["token","config","data"],getBuilder:["token","config"],buildStrategy:["instance","config"],getType:["config"],getTokenMetaConfig:["token","config"],getDecorator:[],getMetaConfig:["token"],isEqual:["build"],resolveToken:["token","data"]}},g.__decorate([h.Inject(h.ContainerToken),g.__metadata("design:type",Object)],e.prototype,"container",void 0),e=r=g.__decorate([h.Injectable(d.AnnotationBuilderToken),g.__metadata("design:paramtypes",[])],e)}();t.AnnotationBuilder=n});t(f);f.AnnotationBuilder;var p=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(t){function e(e){return t.call(this,e,"boot__metaAccessor")||this}return g.__extends(e,t),e.classAnnations={name:"InjectMetaAccessorToken",params:{constructor:["type"]}},e}(h.Registration);t.InjectMetaAccessorToken=n,t.DefaultMetaAccessorToken=new n("default");var o=function(){function e(e){this.decorator=e}return e.prototype.get=function(e,t){var n=h.isClass(t)?t:e.getTokenImpl(t);if(h.isClass(n)){var o=h.getTypeMetadata(this.decorator,n);if(o&&o.length)return o[0]}return null},e.classAnnations={name:"MetaAccessor",params:{constructor:["decorator"],get:["container","token"]}},e=g.__decorate([h.Injectable(t.DefaultMetaAccessorToken),g.__metadata("design:paramtypes",[String])],e)}();t.MetaAccessor=o});t(p);p.InjectMetaAccessorToken,p.DefaultMetaAccessorToken,p.MetaAccessor;var v=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.container=e}return e.prototype.setup=function(){var e=this.container,t=e.get(h.LifeScopeToken);t.registerDecorator(u.DIModule,h.CoreActions.bindProvider,h.CoreActions.cache,h.CoreActions.componentBeforeInit,h.CoreActions.componentInit,h.CoreActions.componentAfterInit),t.registerDecorator(u.Bootstrap,h.CoreActions.bindProvider,h.CoreActions.cache,h.CoreActions.componentBeforeInit,h.CoreActions.componentInit,h.CoreActions.componentAfterInit),e.register(p.MetaAccessor),e.register(s.ModuleBuilder),e.register(f.AnnotationBuilder),e.register(l.DefaultApplicationBuilder)},e.classAnnations={name:"BootModule",params:{constructor:["container"],setup:[]}},e=g.__decorate([h.IocExt("setup"),g.__param(0,h.Inject(h.ContainerToken)),g.__metadata("design:paramtypes",[Object])],e)}();t.BootModule=n});t(v);v.BootModule;var _=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.classAnnations={name:"LoadedModule",params:{}},e}();t.LoadedModule=n});t(_);_.LoadedModule;var y=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.inited=!1,this.pools=new h.MapSet,this.globalModules=[]}return e.prototype.getTokenKey=function(e){return e instanceof h.Registration?e.toString():e},e.prototype.use=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.globalModules=this.globalModules.concat(e),this.inited=!1,this},e.prototype.hasInit=function(){return this.inited},e.prototype.initDefault=function(){return g.__awaiter(this,void 0,void 0,function(){var t,n;return g.__generator(this,function(e){switch(e.label){case 0:return t=this.getDefault(),this.globalModules.length?(n=this.globalModules,[4,t.loadModule.apply(t,n)]):[3,2];case 1:e.sent(),e.label=2;case 2:return this.inited=!0,[2,t]}})})},e.prototype.isDefault=function(e){return e===this.defaults},e.prototype.hasDefault=function(){return!!this.defaults},e.prototype.setDefault=function(e){this.defaults=e},e.prototype.getDefault=function(){return this.defaults},e.prototype.set=function(e,t){this.getTokenKey(e);this.pools.has(e)&&console.log(e.toString()+" module has loaded"),this.pools.set(e,t)},e.prototype.get=function(e){var t=this.getTokenKey(e);return this.has(t)?this.pools.get(e):null},e.prototype.has=function(e){return this.pools.has(this.getTokenKey(e))},e.classAnnations={name:"ContainerPool",params:{constructor:[],getTokenKey:["token"],use:["modules"],hasInit:[],initDefault:[],isDefault:["container"],hasDefault:[],setDefault:["container"],getDefault:[],set:["token","container"],get:["token"],has:["token"]}},e}();t.ContainerPool=n,t.ContainerPoolToken=new h.InjectToken("ContainerPool"),t.containerPools=new n});t(y);y.ContainerPool,y.ContainerPoolToken,y.containerPools;var C=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.classAnnations={name:"Service",params:{start:[],stop:[]}},e}();t.Service=n;var o=function(t){function e(e){return t.call(this,e,"boot__service")||this}return g.__extends(e,t),e.classAnnations={name:"InjectServiceToken",params:{constructor:["type"]}},e}(h.Registration);t.InjectServiceToken=o,t.DefaultServiceToken=new o("default")});t(C);C.Service,C.InjectServiceToken,C.DefaultServiceToken;var k=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.classAnnations={name:"Boot",params:{run:["app"]}},e}();t.Boot=n;var o=function(t){function e(e){return t.call(this,e,"boot__runner")||this}return g.__extends(e,t),e.classAnnations={name:"InjectRunnerToken",params:{constructor:["type"]}},e}(h.Registration);t.InjectRunnerToken=o,t.DefaultRunnerToken=new o("default")});t(k);k.Boot,k.InjectRunnerToken,k.DefaultRunnerToken;var s=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var s="__exportProviders",l=function(t){function e(e){return t.call(this,e,"module_loader")||this}return g.__extends(e,t),e.classAnnations={name:"InjectModuleLoadToken",params:{constructor:["token"]}},e}(h.Registration);t.InjectModuleLoadToken=l;var n=function(){function e(){}var a;return(a=e).prototype.getPools=function(){return this.pools||(this.pools=y.containerPools),this.pools.hasDefault()||this.regDefaultContainer(),this.pools},e.prototype.setPools=function(e){this.pools=e},e.prototype.regDefaultContainer=function(){var e=this.createContainer();return e.register(v.BootModule),this.pools.setDefault(e),e},e.prototype.getContainer=function(e,t,n){var o;if(t instanceof _.LoadedModule&&t.token===e)return o=t.container,this.setParent(o,n),o;var r=this.getContainerInEnv(t),i=this.getPools();if(!h.isToken(e)){var a=this.getConfigId(e);return a&&i.has(a)?i.get(a):((o=e.container||r)&&r instanceof h.Container||(o=a?this.createContainer():i.getDefault(),e.container=o),this.setParent(o,n),a||!e.container?i.set(a,o):e.container=o,o)}return i.has(e)?i.get(e):((o=this.getConfigure(e,r).container||r)&&r instanceof h.Container||(o=this.isDIModule(e)?this.createContainer():i.getDefault()),this.setParent(o,n),i.set(e,o),o)},e.prototype.getContainerInEnv=function(e){var t;return e instanceof _.LoadedModule?t=e.container:e instanceof h.Container&&(t=e),t},e.prototype.getConfigId=function(e){return e.name},e.prototype.setParent=function(e,t){var n=this.getPools();n.isDefault(e)||e.parent||(e.parent=t&&t!==e?t:n.getDefault())},e.prototype.createContainer=function(){return this.getContainerBuilder().create()},e.prototype.getContainerBuilder=function(){return this.containerBuilder||(this.containerBuilder=this.createContainerBuilder()),this.containerBuilder},e.prototype.createContainerBuilder=function(){return new h.DefaultContainerBuilder},e.prototype.load=function(s,u,c){return g.__awaiter(this,void 0,void 0,function(){var t,n,o,r,i,a;return g.__generator(this,function(e){switch(e.label){case 0:return this.getPools().hasInit()?[3,2]:[4,this.getPools().initDefault()];case 1:e.sent(),e.label=2;case 2:return t=this.getContainer(s,u,c),n=h.isToken(s)?s:this.getConfigId(s),o=new l(n),n&&t.has(o)?[2,t.resolve(o)]:(r=this.getConfigure(s,t),[4,this.registerDepdences(t,r)]);case 3:return r=e.sent(),i=h.isToken(s)?s:this.getType(r),h.isClass(i)&&!t.has(i)&&t.register(i),a={token:s,moduleToken:i,container:t,moduleConfig:r},n&&t.bindProvider(o,function(){return a}),[2,a]}})})},e.prototype.cleanLoadModule=function(e,t){var n=new l(t);e.unregister(n)},e.prototype.build=function(c,l,d){return g.__awaiter(this,void 0,void 0,function(){var t,n,o,r,i,a,s,u;return g.__generator(this,function(e){switch(e.label){case 0:return[4,this.load(c,l)];case 1:return t=e.sent(),n=t.container,o=t.moduleConfig,(r=this.getBuilder(c,l))&&r!==this?(i=h.isToken(c)?c:this.getConfigId(c),this.cleanLoadModule(n,i),[4,r.build(c,t,d)]):[3,3];case 2:return[2,e.sent()];case 3:return a=this.getAnnoBuilder(n,t.moduleToken,o.annotationBuilder),t.moduleToken?[3,5]:[4,a.buildByConfig(o,d)];case 4:return[2,s=e.sent()];case 5:return[4,a.build(t.moduleToken,o,d)];case 6:return s=e.sent(),(u=s)&&h.isFunction(u.mdOnInit)&&u.mdOnInit(t),[2,s]}})})},e.prototype.bootstrap=function(d,f,p){return g.__awaiter(this,void 0,void 0,function(){var t,n,o,r,i,a,s,u,c,l;return g.__generator(this,function(e){switch(e.label){case 0:return[4,this.load(d,f)];case 1:return t=e.sent(),n=t.moduleConfig,o=t.container,(r=this.getBuilder(d,f))&&r!==this?(i=h.isToken(d)?d:this.getConfigId(d),this.cleanLoadModule(o,i),[4,r.bootstrap(d,t,p)]):[3,3];case 2:return[2,e.sent()];case 3:return[4,this.build(d,t,p)];case 4:return a=e.sent(),s=this.getBootType(n),u=this.getAnnoBuilder(o,s,n.annotationBuilder),[4,s?u.build(s,n,p):u.buildByConfig(n,p)];case 5:return c=e.sent(),l=void 0,c?[4,this.autoRun(o,s||u.getType(n),n,c)]:[3,9];case 6:return l=e.sent(),a&&h.isFunction(a.mdOnStart)?[4,Promise.resolve(a.mdOnStart(c))]:[3,8];case 7:e.sent(),e.label=8;case 8:return[3,11];case 9:return[4,this.autoRun(o,t.moduleToken,n,a)];case 10:l=e.sent(),e.label=11;case 11:return[2,l]}})})},e.prototype.getBuilder=function(e,t){var n,o=this.getContainerInEnv(t)||this.getPools().getDefault(),r=this.getConfigure(e,o);r&&(h.isClass(r.builder)&&(o.has(r.builder)||o.register(r.builder)),h.isToken(r.builder)?n=o.resolve(r.builder):r.builder instanceof a&&(n=r.builder));var i=h.isToken(e)?e:this.getType(e);return!n&&i&&o.getTokenExtendsChain(i).forEach(function(e){if(n)return!1;var t=new c.InjectModuleBuilderToken(e);return o.has(t)&&(n=o.get(t)),!0}),n||(n=this.getDefaultBuilder(o)),n&&n.setPools(this.getPools()),n||this},e.prototype.getDefaultBuilder=function(e){return e.has(c.DefaultModuleBuilderToken)?e.resolve(c.DefaultModuleBuilderToken):null},e.prototype.autoRun=function(a,t,n,s){return g.__awaiter(this,void 0,void 0,function(){var o,r,i;return g.__generator(this,function(e){switch(e.label){case 0:return s?s instanceof k.Boot?[4,s.run()]:[3,2]:[2,null];case 1:return e.sent(),[2,s];case 2:return s instanceof C.Service?[4,s.start()]:[3,4];case 3:return e.sent(),[2,s];case 4:return i={token:t,instance:s,config:n},a.getTokenExtendsChain(t).forEach(function(e){if(o||r)return!1;var t=new k.InjectRunnerToken(e);a.has(t)&&(o=a.resolve(t,i));var n=new C.InjectServiceToken(e);return a.has(n)&&(r=a.resolve(n,i)),!0}),o||this.getDefaultRunner(a,i),o||r||this.getDefaultService(a,i),o?[4,o.run(s)]:[3,6];case 5:return e.sent(),[2,o];case 6:return r?[4,r.start()]:[3,8];case 7:return e.sent(),[2,r];case 8:return t&&n.autorun?[4,a.invoke(t,n.autorun,s)]:[3,10];case 9:return e.sent(),[2,s];case 10:return[2,s]}})})},e.prototype.getDefaultRunner=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.has(k.DefaultRunnerToken)?e.resolve.apply(e,[k.DefaultRunnerToken].concat(t)):null},e.prototype.getDefaultService=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.has(C.DefaultServiceToken)?e.resolve.apply(e,[C.DefaultServiceToken].concat(t)):null},e.prototype.getAnnoBuilder=function(n,e,t){var o;return h.isClass(t)&&(n.has(t)||n.register(t)),h.isToken(t)?o=n.resolve(t):t instanceof f.AnnotationBuilder&&(o=t),!o&&e&&n.getTokenExtendsChain(e).forEach(function(e){if(o)return!1;var t=new d.InjectAnnotationBuilder(e);return n.has(t)&&(o=n.resolve(t)),!0}),o||(o=this.getDefaultAnnBuilder(n)),o&&(o.container=n),o},e.prototype.getDefaultAnnBuilder=function(e){return e.has(d.DefaultAnnotationBuilderToken)?e.resolve(d.DefaultAnnotationBuilderToken):e.resolve(d.AnnotationBuilderToken)},e.prototype.importModule=function(n,o){return g.__awaiter(this,void 0,void 0,function(){var t;return g.__generator(this,function(e){switch(e.label){case 0:return o&&h.isClass(n)&&!this.isDIModule(n)?(o.register(n),[2,o]):[4,this.load(n,null,o)];case 1:return t=e.sent(),o.has(t.moduleToken)?[3,3]:[4,this.importConfigExports(o,t.container,t.moduleConfig)];case 2:e.sent(),t.container.parent=o,t.moduleToken&&o.bindProvider(t.moduleToken,t),e.label=3;case 3:return[2,o]}})})},e.prototype.getDecorator=function(){return u.DIModule.toString()},e.prototype.getConfigure=function(e,t){var n;if(t=t||this.getPools().getDefault(),h.isToken(e))n=this.getMetaConfig(e,t);else if(h.isObject(e)){var o=this.getType(e);n=h.lang.assign(e||{},this.getMetaConfig(o,t),e||{})}return n||{}},e.prototype.registerDepdences=function(t,n){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(e){switch(e.label){case 0:return[4,this.registerExts(t,n)];case 1:return e.sent(),[4,this.registerConfgureDepds(t,n)];case 2:return[2,n=e.sent()]}})})},e.prototype.getType=function(e){return e.token||e.type},e.prototype.getBootType=function(e){return e.bootstrap},e.prototype.importConfigExports=function(r,i,n){return g.__awaiter(this,void 0,void 0,function(){var t,o=this;return g.__generator(this,function(e){switch(e.label){case 0:return n.exports&&n.exports.length?[4,Promise.all(n.exports.map(function(n){return g.__awaiter(o,void 0,void 0,function(){return g.__generator(this,function(e){return r.bindProvider(n,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.resolve.apply(i,[n].concat(e))}),[2,n]})})}))]:[3,2];case 1:e.sent(),e.label=2;case 2:return(t=n[s])&&t.length&&t.forEach(function(e){r.bindProvider(e,function(){return i.get(e)})}),[2,r]}})})},e.prototype.registerConfgureDepds=function(o,r){return g.__awaiter(this,void 0,void 0,function(){var t,n=this;return g.__generator(this,function(e){switch(e.label){case 0:return h.isArray(r.imports)&&r.imports.length?[4,o.getBuilder().loader.loadTypes(r.imports,function(e){return n.isIocExt(e)||n.isDIModule(e)})]:[3,3];case 1:return t=e.sent(),[4,Promise.all(t.map(function(e){return n.importModule(e,o)}))];case 2:e.sent(),e.label=3;case 3:return h.isArray(r.providers)&&r.providers.length&&(r[s]=this.bindProvider(o,r.providers)),[2,r]}})})},e.prototype.getMetaConfig=function(e,n){if(h.isToken(e)){var o,r={decorator:this.getDecorator()};return n.getTokenExtendsChain(e).forEach(function(e){if(o)return!1;var t=new p.InjectMetaAccessorToken(e);return n.has(t)&&(o=n.resolve(t,r)),!0}),o||(o=this.getDefaultMetaAccessor(n,r)),o?o.get(n,e):null}return null},e.prototype.getDefaultMetaAccessor=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.resolve.apply(e,[p.DefaultMetaAccessorToken].concat(t))},e.prototype.isIocExt=function(e){return h.hasOwnClassMetadata(h.IocExt,e)},e.prototype.isDIModule=function(e){return!!h.isClass(e)&&(!!h.hasOwnClassMetadata(this.getDecorator(),e)||h.hasOwnClassMetadata(u.DIModule,e))},e.prototype.registerExts=function(t,e){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(e){return[2,t]})})},e.prototype.bindProvider=function(r,e){var i=[];return e.forEach(function(n,e){if(!h.isUndefined(n)&&!h.isNull(n))if(h.isProviderMap(n))n.forEach(function(e,t){i.push(e),r.bindProvider(e,t)});else if(n instanceof h.Provider)i.push(n.type),r.bindProvider(n.type,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.resolve.apply(n,[r].concat(e))});else if(h.isClass(n))r.has(n)||(i.push(n),r.register(n));else if(h.isBaseObject(n)){var t=n,o=!1;h.isToken(t.provide)?(h.isArray(t.deps)&&t.deps.length&&t.deps.forEach(function(e){h.isClass(e)&&!r.has(e)&&r.register(e)}),h.isUndefined(t.useValue)?h.isClass(t.useClass)?(r.has(t.useClass)||r.register(t.useClass),i.push(t.provide),r.bindProvider(t.provide,t.useClass)):h.isFunction(t.useFactory)?(i.push(t.provide),r.bindProvider(t.provide,function(){var e=[];return h.isArray(t.deps)&&t.deps.length&&(e=t.deps.map(function(e){return h.isClass(e)?r.get(e):e})),t.useFactory.apply(t,e)})):h.isToken(t.useExisting)?r.has(t.useExisting)?(i.push(t.provide),r.bindProvider(t.provide,t.useExisting)):console.log("has not register:",t.useExisting):o=!0:(i.push(t.provide),r.bindProvider(t.provide,function(){return t.useValue}))):o=!0,o&&h.lang.forIn(n,function(e,t){h.isUndefined(e)||(h.isClass(e)?r.bindProvider(t,e):h.isFunction(e)||h.isString(e)?r.bindProvider(t,function(){return e}):r.bindProvider(t,e),i.push(t))})}else h.isFunction(n)&&(i.push(name),r.bindProvider(name,function(){return n}))}),i},e.classAnnations={name:"ModuleBuilder",params:{constructor:[],getPools:[],setPools:["pools"],regDefaultContainer:[],getContainer:["token","env","parent"],getContainerInEnv:["env"],getConfigId:["cfg"],setParent:["container","parent"],createContainer:[],getContainerBuilder:[],createContainerBuilder:[],load:["token","env","parent"],cleanLoadModule:["container","tk"],build:["token","env","data"],bootstrap:["token","env","data"],getBuilder:["token","env"],getDefaultBuilder:["container"],autoRun:["container","token","cfg","instance"],getDefaultRunner:["container","providers"],getDefaultService:["container","providers"],getAnnoBuilder:["container","token","annBuilder"],getDefaultAnnBuilder:["container"],importModule:["token","container"],getDecorator:[],getConfigure:["token","container"],registerDepdences:["container","config"],getType:["cfg"],getBootType:["cfg"],importConfigExports:["container","providerContainer","cfg"],registerConfgureDepds:["container","config"],getMetaConfig:["token","container"],getDefaultMetaAccessor:["container","providers"],isIocExt:["token"],isDIModule:["token"],registerExts:["container","config"],bindProvider:["container","providers"]}},g.__decorate([h.Inject(h.ContainerBuilderToken),g.__metadata("design:type",Object)],e.prototype,"containerBuilder",void 0),e=a=g.__decorate([h.Singleton(c.ModuleBuilderToken),g.__metadata("design:paramtypes",[])],e)}();t.ModuleBuilder=n});t(s);s.InjectModuleLoadToken,s.ModuleBuilder;var l=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(i){function t(e){var t=i.call(this)||this;return t.baseURL=e,t.customRegs=[],t.providers=new h.MapSet,t.pools=new y.ContainerPool,t}return g.__extends(t,i),t.create=function(e){return new t(e)},t.prototype.useConfiguration=function(e,t){var o;return t=t||this.getPools().getDefault(),this.globalConfig||(this.globalConfig=Promise.resolve(this.getDefaultConfig(t))),h.isString(e)||h.isUndefined(e)?o=this.loadConfig(t,e):e&&(o=Promise.resolve(e)),o&&(this.globalConfig=this.globalConfig.then(function(n){return o.then(function(e){if(e){var t=e.default?e.default:e;n=h.lang.assign(n||{},t||{})}return n||{}})})),this},t.prototype.loadConfig=function(e,t){return e.has(a.AppConfigureLoaderToken)?e.resolve(a.AppConfigureLoaderToken,{baseURL:this.baseURL,container:e}).load(t):t?e.getBuilder().loader.load([t]).then(function(e){return e.length?e[0]:null}):Promise.resolve(null)},t.prototype.use=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return(e=this.pools).use.apply(e,t),this},t.prototype.provider=function(e,t){return this.providers.set(e,t),this},t.prototype.registerConfgureDepds=function(n,o){return g.__awaiter(this,void 0,void 0,function(){var t;return g.__generator(this,function(e){switch(e.label){case 0:return this.globalConfig||this.useConfiguration(void 0,n),[4,this.globalConfig];case 1:return t=e.sent(),o=this.mergeGlobalConfig(t,o),this.bindAppConfig(o),[4,i.prototype.registerConfgureDepds.call(this,n,o)];case 2:return o=e.sent(),n.bindProvider(a.AppConfigureToken,o),[2,o]}})})},t.prototype.mergeGlobalConfig=function(e,t){return h.lang.assign({},e,t)},t.prototype.regDefaultContainer=function(){var e=this,t=i.prototype.regDefaultContainer.call(this);return t.bindProvider(y.ContainerPoolToken,function(){return e.getPools()}),t.resolve(c.ModuleBuilderToken).setPools(this.getPools()),t},t.prototype.registerExts=function(o,r){return g.__awaiter(this,void 0,void 0,function(){var n=this;return g.__generator(this,function(e){switch(e.label){case 0:return[4,i.prototype.registerExts.call(this,o,r)];case 1:return e.sent(),this.providers.forEach(function(e,t){o.bindProvider(t,e)}),this.customRegs.length?[4,Promise.all(this.customRegs.map(function(t){return g.__awaiter(n,void 0,void 0,function(){return g.__generator(this,function(e){switch(e.label){case 0:return[4,t(o,r,this)];case 1:return[2,e.sent()]}})})}))]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2,o]}})})},t.prototype.bindAppConfig=function(e){return this.baseURL&&(e.baseURL=this.baseURL),e},t.prototype.getDefaultConfig=function(t){return g.__awaiter(this,void 0,void 0,function(){return g.__generator(this,function(e){return t.has(a.DefaultConfigureToken)?[2,t.resolve(a.DefaultConfigureToken)]:[2,{}]})})},t.classAnnations={name:"DefaultApplicationBuilder",params:{constructor:["baseURL"],create:["baseURL"],useConfiguration:["config","container"],loadConfig:["container","src"],use:["modules"],provider:["provide","provider"],registerConfgureDepds:["container","config"],mergeGlobalConfig:["globalCfg","moduleCfg"],regDefaultContainer:[],registerExts:["container","config"],bindAppConfig:["config"],getDefaultConfig:["container"]}},t}(s.ModuleBuilder);t.DefaultApplicationBuilder=n});t(l);l.DefaultApplicationBuilder;var b=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ApplicationBuilderToken=new h.InjectToken("DI_AppBuilder")});t(b);b.ApplicationBuilderToken;return t(n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),g.__exportStar(u,t),g.__exportStar(a,t),g.__exportStar(l,t),g.__exportStar(b,t),g.__exportStar(c,t),g.__exportStar(s,t),g.__exportStar(y,t),g.__exportStar(v,t),g.__exportStar(p,t),g.__exportStar(d,t),g.__exportStar(f,t),g.__exportStar(k,t),g.__exportStar(C,t),g.__exportStar(_,t)}))});
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("tslib"),require("@ts-ioc/core"),require("reflect-metadata")):"function"==typeof define&&define.amd?define(["tslib","@ts-ioc/core","reflect-metadata"],t):(e.bootstrap=e.bootstrap||{},e.bootstrap.umd=e.bootstrap.umd||{},e.bootstrap.umd.js=t(e.tslib_1,e.core_1,e.Reflect))}(this,function(f,p,e){"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,t){return e(t={exports:{}},t.exports),t.exports}f=f&&f.hasOwnProperty("default")?f.default:f,p=p&&p.hasOwnProperty("default")?p.default:p,e=e&&e.hasOwnProperty("default")?e.default:e;var o=n(function(e,t){function n(e,t,n,o){return p.createClassDecorator(e,function(e){n&&n(e)},function(e){return o&&(e=o(e)),t&&!e.annotationBuilder&&(e.annotationBuilder=t),e})}Object.defineProperty(t,"__esModule",{value:!0}),t.createAnnotationDecorator=n,t.Annotation=n("Annotation")});t(o);o.createAnnotationDecorator,o.Annotation;var i=n(function(e,t){function n(t,n,o,r,i){return p.createClassDecorator(t,function(e){r&&r(e)},function(e){(i&&(e=i(e)),!e.name&&p.isClass(e.token))&&(/^[a-z]$/.test(e.token.name)&&e.token.classAnnations?e.name=e.token.classAnnations.name:e.name=e.token.name);return e.decorType=t,n&&!e.builder&&(e.builder=n),o&&!e.annotationBuilder&&(e.annotationBuilder=o),e})}Object.defineProperty(t,"__esModule",{value:!0}),t.createDIModuleDecorator=n,t.DIModule=n("DIModule")});t(i);i.createDIModuleDecorator,i.DIModule;var r=n(function(e,t){function n(e,t,n,o,r){return i.createDIModuleDecorator(e,t,n,o,function(n){return r&&r(n),n.builder&&setTimeout(function(){var e,t=n.builder;p.isClass(t)?e=p.isFunction(t.create)?t.create():new t:p.isObject(t)&&(e=t),e&&(n.globals&&e.use.apply(e,n.globals),e.bootstrap(n.type))},500),n})}Object.defineProperty(t,"__esModule",{value:!0}),t.createBootstrapDecorator=n,t.Bootstrap=n("Bootstrap")});t(r);r.createBootstrapDecorator,r.Bootstrap;var a=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),f.__exportStar(o,t),f.__exportStar(i,t),f.__exportStar(r,t)});t(a);var s=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.AppConfigureToken=new p.InjectToken("DI_APP_Configuration"),t.DefaultConfigureToken=new p.InjectToken("DI_Default_Configuration"),t.AppConfigureLoaderToken=new p.InjectToken("DI_Configure_Loader")});t(s);s.AppConfigureToken,s.DefaultConfigureToken,s.AppConfigureLoaderToken;var u=n(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DIModuelValidateToken=new p.InjectModuleValidateToken(a.DIModule.toString());var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return f.__extends(t,e),t.prototype.getDecorator=function(){return a.DIModule.toString()},t.classAnnations={name:"DIModuelValidate",params:{getDecorator:[]}},t=f.__decorate([p.Singleton(n.DIModuelValidateToken)],t)}(p.BaseModuelValidate);n.DIModuelValidate=t});t(u);u.DIModuelValidateToken,u.DIModuelValidate;var c=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.containerBuilder=e,this.pools=new p.MapSet}return e.prototype.createContainer=function(){return this.containerBuilder.create()},e.prototype.getTokenKey=function(e){return e instanceof p.Registration?e.toString():e},e.prototype.isDefault=function(e){return e===this._default},e.prototype.hasDefault=function(){return!!this._default},e.prototype.getDefault=function(){return this._default||(this._default=this.createContainer()),this._default},e.prototype.set=function(e,t){this.getTokenKey(e);this.pools.has(e)&&console.log(e.toString()+" module has loaded"),this.pools.set(e,t)},e.prototype.get=function(e){var t=this.getTokenKey(e);return this.has(t)?this.pools.get(e):null},e.prototype.has=function(e){return this.pools.has(this.getTokenKey(e))},e.prototype.create=function(e){var t=(e=e||this.getDefault()).getBuilder().create();return this.setParent(t,e),t},e.prototype.setParent=function(e,t){this.isDefault(e)||(e.parent=t&&t!==e?t:this.getDefault())},e.classAnnations={name:"ContainerPool",params:{constructor:["containerBuilder"],createContainer:[],getTokenKey:["token"],isDefault:["container"],hasDefault:[],getDefault:[],set:["token","container"],get:["token"],has:["token"],create:["parent"],setParent:["container","parent"]}},e}();t.ContainerPool=n,t.ContainerPoolToken=new p.InjectToken("ContainerPool")});t(c);c.ContainerPool,c.ContainerPoolToken;var l=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.eventsMap={}}return e.prototype.on=function(e,t){return this.eventsMap[e]=this.eventsMap[e]||[],this.eventsMap[e].indexOf(t)<0&&this.eventsMap[e].push(t),this},e.prototype.off=function(e,t){return this.eventsMap[e]&&(t?this.eventsMap[e].splice(this.eventsMap[e].indexOf(t),1):delete this.eventsMap[e]),this},e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=this.eventsMap[e];p.isArray(o)&&o.forEach(function(e){e.apply(void 0,t)})},e.classAnnations={name:"Events",params:{constructor:[],on:["name","event"],off:["name","event"],emit:["name","args"]}},e}();t.Events=n});t(l);l.Events;var d=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),f.__exportStar(c,t),f.__exportStar(l,t)});t(d);var h=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n,o,r,i){this.token=e,this.config=t,this.container=n,this.type=o,this.exports=r,this.providers=i}return e.classAnnations={name:"InjectedModule",params:{constructor:["token","config","container","type","exports","providers"]}},e}();t.InjectedModule=n;var o=function(t){function e(e){return t.call(this,e,"InjectedModule")||this}return f.__extends(e,t),e.classAnnations={name:"InjectedModuleToken",params:{constructor:["type"]}},e}(p.Registration);t.InjectedModuleToken=o});t(h);h.InjectedModule,h.InjectedModuleToken;var g=n(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var s="__exportProviders";n.DIModuleInjectorToken=new p.InjectModuleInjectorToken(a.DIModule.toString());var t=function(t){function e(e){return t.call(this,e)||this}return f.__extends(e,t),e.prototype.setup=function(t,n){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(e){switch(e.label){case 0:return[4,this.importModule(t,n)];case 1:return e.sent(),[2]}})})},e.prototype.import=function(t,n){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(e){switch(e.label){case 0:return this.validate.validate(n)?[4,this.importModule(t,n)]:[3,2];case 1:return[2,e.sent()];case 2:return[2,null]}})})},e.prototype.importByConfig=function(t,n){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(e){switch(e.label){case 0:return[4,this.registerConfgureDepds(t,n)];case 1:return e.sent(),p.isArray(n.providers)&&n.providers.length?[4,this.bindProvider(t,n.providers)]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2,null]}})})},e.prototype.importModule=function(i,a){return f.__awaiter(this,void 0,void 0,function(){var t,n,o,r;return f.__generator(this,function(e){switch(e.label){case 0:return t=i.get(d.ContainerPoolToken),(n=t.create(i)).register(a),o=this.validate.getMetaConfig(a,n),[4,this.registerConfgureDepds(n,o)];case 1:return o=e.sent(),r=new h.InjectedModule(o.token||a,o,n,a,o.exports||[],o[s]),i.bindProvider(new h.InjectedModuleToken(a),r),[4,this.importConfigExports(i,n,r)];case 2:return e.sent(),[2,r]}})})},e.prototype.registerConfgureDepds=function(t,n){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(e){switch(e.label){case 0:return p.isArray(n.imports)&&n.imports.length?[4,t.loadModule.apply(t,n.imports)]:[3,2];case 1:e.sent(),e.label=2;case 2:return p.isArray(n.providers)&&n.providers.length&&(n[s]=this.bindProvider(t,n.providers)),[2,n]}})})},e.prototype.importConfigExports=function(t,n,o){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(e){return t===n||o&&(t.resolvers.next(o),o.exports&&o.exports.length&&n.resolvers.toArray().filter(function(e){return!(e instanceof p.Container)&&0<=o.exports.indexOf(e.type)}).forEach(function(e){t.resolvers.next(e)})),[2,t]})})},e.prototype.bindProvider=function(r,e){var i=[];return e.forEach(function(n,e){if(!p.isUndefined(n)&&!p.isNull(n))if(p.isProviderMap(n))n.forEach(function(e,t){i.push(e),r.bindProvider(e,t)});else if(n instanceof p.Provider)i.push(n.type),r.bindProvider(n.type,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.resolve.apply(n,[r].concat(e))});else if(p.isClass(n))r.has(n)||(i.push(n),r.register(n));else if(p.isBaseObject(n)){var t=n,o=!1;p.isToken(t.provide)?(p.isArray(t.deps)&&t.deps.length&&t.deps.forEach(function(e){p.isClass(e)&&!r.has(e)&&r.register(e)}),p.isUndefined(t.useValue)?p.isClass(t.useClass)?(r.has(t.useClass)||r.register(t.useClass),i.push(t.provide),r.bindProvider(t.provide,t.useClass)):p.isFunction(t.useFactory)?(i.push(t.provide),r.bindProvider(t.provide,function(){var e=[];return p.isArray(t.deps)&&t.deps.length&&(e=t.deps.map(function(e){return p.isClass(e)?r.get(e):e})),t.useFactory.apply(t,e)})):p.isToken(t.useExisting)?r.has(t.useExisting)?(i.push(t.provide),r.bindProvider(t.provide,t.useExisting)):console.log("has not register:",t.useExisting):o=!0:(i.push(t.provide),r.bindProvider(t.provide,function(){return t.useValue}))):o=!0,o&&p.lang.forIn(n,function(e,t){p.isUndefined(e)||(p.isClass(e)?r.bindProvider(t,e):p.isFunction(e)||p.isString(e)?r.bindProvider(t,function(){return e}):r.bindProvider(t,e),i.push(t))})}else p.isFunction(n)&&(i.push(name),r.bindProvider(name,function(){return n}))}),i},e.classAnnations={name:"DIModuleInjector",params:{constructor:["validate"],setup:["container","type"],import:["container","type"],importByConfig:["container","config"],importModule:["container","type"],registerConfgureDepds:["container","config"],importConfigExports:["container","providerContainer","injMd"],bindProvider:["container","providers"]}},e=f.__decorate([p.Injectable(n.DIModuleInjectorToken),f.__param(0,p.Inject(u.DIModuelValidateToken)),f.__metadata("design:paramtypes",[Object])],e)}(p.ModuleInjector);n.DIModuleInjector=t});t(g);g.DIModuleInjectorToken,g.DIModuleInjector;var v=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="DI_ModuleBuilder",o=function(t){function e(e){return t.call(this,e,n)||this}return f.__extends(e,t),e.classAnnations={name:"InjectModuleBuilderToken",params:{constructor:["type"]}},e}(p.Registration);t.InjectModuleBuilderToken=o,t.DefaultModuleBuilderToken=new o(Object),t.ModuleBuilderToken=new p.Registration("any",n)});t(v);v.InjectModuleBuilderToken,v.DefaultModuleBuilderToken,v.ModuleBuilderToken;var _=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n){this.token=e,this.instance=t,this.config=n}return e.classAnnations={name:"Runner",params:{constructor:["token","instance","config"],run:["data"]}},e}(),o=function(r){function e(e,t,n){var o=r.call(this,e,t,n)||this;return o.token=e,o.instance=t,o.config=n,o}return f.__extends(e,r),e.classAnnations={name:"Boot",params:{constructor:["token","instance","config"]}},e}(t.Runner=n);t.Boot=o;var r=function(t){function e(e){return t.call(this,e,"boot__runner")||this}return f.__extends(e,t),e.classAnnations={name:"InjectRunnerToken",params:{constructor:["type"]}},e}(p.Registration);t.InjectRunnerToken=r,t.DefaultRunnerToken=new r("default")});t(_);_.Runner,_.Boot,_.InjectRunnerToken,_.DefaultRunnerToken;var y=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t,n){this.token=e,this.instance=t,this.config=n}return e.classAnnations={name:"Service",params:{constructor:["token","instance","config"],start:["data"],stop:[]}},e}();t.Service=n;var o=function(t){function e(e){return t.call(this,e,"boot__service")||this}return f.__extends(e,t),e.classAnnations={name:"InjectServiceToken",params:{constructor:["type"]}},e}(p.Registration);t.InjectServiceToken=o,t.DefaultServiceToken=new o("default")});t(y);y.Service,y.InjectServiceToken,y.DefaultServiceToken;var b=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),f.__exportStar(_,t),f.__exportStar(y,t)});t(b);var k=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n="DI_AnnotationBuilder",o=function(t){function e(e){return t.call(this,e,n)||this}return f.__extends(e,t),e.classAnnations={name:"InjectAnnotationBuilder",params:{constructor:["type"]}},e}(p.Registration);t.InjectAnnotationBuilder=o,t.AnnotationBuilderToken=new p.Registration(Object,n),t.DefaultAnnotationBuilderToken=new o("default")});t(k);k.InjectAnnotationBuilder,k.AnnotationBuilderToken,k.DefaultAnnotationBuilderToken;var C=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}var r;return(r=e).prototype.build=function(o,r,i){return f.__awaiter(this,void 0,void 0,function(){var t,n;return f.__generator(this,function(e){switch(e.label){case 0:return p.isClass(o)&&!this.container.hasRegister(o)&&this.container.register(o),r=this.getTokenMetaConfig(o,r),t=this.getBuilder(o,r),this.isEqual(t)?[3,1]:[2,t.build(o,r,i)];case 1:return[4,this.registerExts(r)];case 2:return e.sent(),[4,this.createInstance(o,r,i)];case 3:return(n=e.sent())?p.isFunction(n.anBeforeInit)?[4,Promise.resolve(n.anBeforeInit(r))]:[3,5]:[2,null];case 4:e.sent(),e.label=5;case 5:return[4,this.buildStrategy(n,r)];case 6:return n=e.sent(),p.isFunction(n.anAfterInit)?[4,Promise.resolve(n.anAfterInit(r))]:[3,8];case 7:e.sent(),e.label=8;case 8:return[2,n]}})})},e.prototype.buildByConfig=function(n,o){return f.__awaiter(this,void 0,void 0,function(){var t;return f.__generator(this,function(e){return p.isToken(n)?(t=n,[2,this.build(t,null,o)]):(t=this.getType(n),[2,this.build(t,n,o)])})})},e.prototype.createInstance=function(t,e,n){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(e){return t?this.container.has(t)?[2,this.resolveToken(t,n)]:(console.log("can not find token "+(t?t.toString():null)+" in container."),[2,null]):(console.log("can not find annotation token."),[2,null])})})},e.prototype.getBuilder=function(e,t){var n,o=this;return t&&t.annotationBuilder&&(p.isClass(t.annotationBuilder)&&(this.container.has(t.annotationBuilder)||this.container.register(t.annotationBuilder)),p.isToken(t.annotationBuilder)?n=this.container.resolve(t.annotationBuilder,{container:this.container}):t.annotationBuilder instanceof r&&(n=t.annotationBuilder)),!n&&e&&this.container.getTokenExtendsChain(e).forEach(function(e){if(n)return!1;var t=new k.InjectAnnotationBuilder(e);return o.container.has(t)&&(n=o.container.resolve(t,{container:o.container})),!0}),n&&!n.container&&(n.container=this.container),n||this},e.prototype.buildStrategy=function(t,e){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(e){return[2,t]})})},e.prototype.getType=function(e){return e.token||e.type},e.prototype.registerExts=function(e){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(e){return[2]})})},e.prototype.getTokenMetaConfig=function(e,t){var n;if(p.isClass(e))n=this.getMetaConfig(e);else if(p.isToken(e)){var o=this.container?this.container.getTokenImpl(e):e;p.isClass(o)&&(n=this.getMetaConfig(o))}return n?p.lang.assign({},n,t||{}):t||{}},e.prototype.getDecorator=function(){return a.Annotation.toString()},e.prototype.getMetaConfig=function(e){var t=this.container.resolve(p.AnnotationMetaAccessorToken,{decorator:this.getDecorator()});return t?t.getMetadata(e,this.container):null},e.prototype.isEqual=function(e){return!!e&&(e===this||e.constructor===this.constructor)},e.prototype.resolveToken=function(e,t){return this.container.resolve(e)},e.classAnnations={name:"AnnotationBuilder",params:{constructor:[],build:["token","config","data"],buildByConfig:["config","data"],createInstance:["token","config","data"],getBuilder:["token","config"],buildStrategy:["instance","config"],getType:["config"],registerExts:["config"],getTokenMetaConfig:["token","config"],getDecorator:[],getMetaConfig:["token"],isEqual:["build"],resolveToken:["token","data"]}},f.__decorate([p.Inject(p.ContainerToken),f.__metadata("design:type",Object)],e.prototype,"container",void 0),e=r=f.__decorate([p.Injectable(k.AnnotationBuilderToken),f.__metadata("design:paramtypes",[])],e)}();t.AnnotationBuilder=n});t(C);C.AnnotationBuilder;var M=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),f.__exportStar(C,t),f.__exportStar(k,t)});t(M);var m=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(t){function e(e){return t.call(this,e,"module_loader")||this}return f.__extends(e,t),e.classAnnations={name:"InjectModuleLoadToken",params:{constructor:["token"]}},e}(p.Registration);t.InjectModuleLoadToken=n;var o=function(){function e(){}return e.prototype.getPools=function(){return this.pools},e.prototype.build=function(s,u,c){return f.__awaiter(this,void 0,void 0,function(){var t,n,o,r,i,a;return f.__generator(this,function(e){switch(e.label){case 0:return[4,this.load(s,u)];case 1:return t=e.sent(),n=t.container,o=t.config,r=this.getAnnoBuilder(n,t.token,o.annotationBuilder),t.token?[3,3]:[4,r.buildByConfig(o,c)];case 2:return[2,i=e.sent()];case 3:return[4,r.build(t.token,o,c)];case 4:return i=e.sent(),(a=i)&&p.isFunction(a.mdOnInit)&&a.mdOnInit(t),[2,i]}})})},e.prototype.bootstrap=function(c,l,d){return f.__awaiter(this,void 0,void 0,function(){var t,n,o,r,i,a,s,u;return f.__generator(this,function(e){switch(e.label){case 0:return[4,this.load(c,l)];case 1:return t=e.sent(),n=t.config,o=t.container,[4,this.build(c,t,d)];case 2:return r=e.sent(),i=this.getBootType(n),a=this.getAnnoBuilder(o,i,n.annotationBuilder),[4,i?a.build(i,n,d):a.buildByConfig(n,d)];case 3:return(s=e.sent())?[4,this.autoRun(o,i||a.getType(n),n,s,d)]:[3,7];case 4:return u=e.sent(),r&&p.isFunction(r.mdOnStart)?[4,Promise.resolve(r.mdOnStart(s))]:[3,6];case 5:e.sent(),e.label=6;case 6:return[3,9];case 7:return[4,this.autoRun(o,t.token,n,r,d)];case 8:u=e.sent(),e.label=9;case 9:return[2,u]}})})},e.prototype.import=function(o,r){return f.__awaiter(this,void 0,void 0,function(){var t,n;return f.__generator(this,function(e){switch(e.label){case 0:return r?[3,2]:[4,this.getParentContainer()];case 1:r=e.sent(),e.label=2;case 2:return t=p.isClass(o)?o:r.getTokenImpl(o),p.isClass(t)?(n=new h.InjectedModuleToken(t),r.hasRegister(n.toString())?[2,r.get(n)]:[3,3]):[3,5];case 3:return[4,r.loadModule(t)];case 4:if(e.sent(),r.has(n))return[2,r.get(n)];e.label=5;case 5:return[2,null]}})})},e.prototype.load=function(a,s){return f.__awaiter(this,void 0,void 0,function(){var t,n,o,r,i;return f.__generator(this,function(e){switch(e.label){case 0:return s instanceof h.InjectedModule?[2,s]:(t=null,[4,this.getParentContainer(s)]);case 1:return n=e.sent(),p.isToken(a)?[4,this.import(a,n)]:[3,3];case 2:return(t=e.sent())||(o=n.get(p.AnnotationMetaAccessorToken).getMetadata(a,n),t=new h.InjectedModule(a,o,n)),[3,10];case 3:return r=this.getType(a),p.isToken(r)?[4,this.import(r,n)]:[3,7];case 4:return(t=e.sent())instanceof h.InjectedModule?(i=t.container,[4,i.get(g.DIModuleInjectorToken).importByConfig(i,a)]):[3,6];case 5:e.sent(),t.config=p.lang.assign(t.config,a),e.label=6;case 6:return[3,8];case 7:r=null,e.label=8;case 8:return t?[3,10]:[4,n.get(g.DIModuleInjectorToken).importByConfig(n,a)];case 9:e.sent(),t=new h.InjectedModule(r,a,n),e.label=10;case 10:return[2,t]}})})},e.prototype.getParentContainer=function(n){return f.__awaiter(this,void 0,void 0,function(){var t;return f.__generator(this,function(e){return n&&(n instanceof p.Container?t=n:n instanceof h.InjectedModule&&(t=n.container.parent)),t||(t=this.getPools().getDefault()),[2,t]})})},e.prototype.autoRun=function(a,t,n,s,u){return f.__awaiter(this,void 0,void 0,function(){var o,r,i;return f.__generator(this,function(e){switch(e.label){case 0:return s?s instanceof b.Runner?[4,s.run(u)]:[3,2]:[2,null];case 1:return e.sent(),[2,s];case 2:return s instanceof b.Service?[4,s.start(u)]:[3,4];case 3:return e.sent(),[2,s];case 4:return i={token:t,instance:s,config:n},a.getTokenExtendsChain(t).forEach(function(e){if(o||r)return!1;var t=new b.InjectRunnerToken(e);a.has(t)&&(o=a.resolve(t,i));var n=new b.InjectServiceToken(e);return a.has(n)&&(r=a.resolve(n,i)),!0}),o||this.getDefaultRunner(a,i),o||r||this.getDefaultService(a,i),o?[4,o.run(u)]:[3,6];case 5:return e.sent(),[2,o];case 6:return r?[4,r.start(u)]:[3,8];case 7:return e.sent(),[2,r];case 8:return t&&n.autorun?[4,a.invoke(t,n.autorun,s,{data:u})]:[3,10];case 9:return e.sent(),[2,s];case 10:return[2,s]}})})},e.prototype.getDefaultRunner=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.has(b.DefaultRunnerToken)?e.resolve.apply(e,[b.DefaultRunnerToken].concat(t)):null},e.prototype.getDefaultService=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e.has(b.DefaultServiceToken)?e.resolve.apply(e,[b.DefaultServiceToken].concat(t)):null},e.prototype.getAnnoBuilder=function(n,e,t){var o;return p.isClass(t)&&(n.has(t)||n.register(t)),p.isToken(t)?o=n.resolve(t):t instanceof M.AnnotationBuilder&&(o=t),!o&&e&&n.getTokenExtendsChain(e).forEach(function(e){if(o)return!1;var t=new M.InjectAnnotationBuilder(e);return n.has(t)&&(o=n.resolve(t)),!0}),o||(o=this.getDefaultAnnBuilder(n)),o&&(o.container=n),o},e.prototype.getDefaultAnnBuilder=function(e){return e.has(M.DefaultAnnotationBuilderToken)?e.resolve(M.DefaultAnnotationBuilderToken):e.resolve(M.AnnotationBuilderToken)},e.prototype.getType=function(e){return e.token||e.type},e.prototype.getBootType=function(e){return e.bootstrap},e.classAnnations={name:"ModuleBuilder",params:{constructor:[],getPools:[],build:["token","env","data"],bootstrap:["token","env","data"],import:["token","parent"],load:["token","env"],getParentContainer:["env"],autoRun:["container","token","cfg","instance","data"],getDefaultRunner:["container","providers"],getDefaultService:["container","providers"],getAnnoBuilder:["container","token","annBuilder"],getDefaultAnnBuilder:["container"],getType:["cfg"],getBootType:["cfg"]}},f.__decorate([p.Inject(d.ContainerPoolToken),f.__metadata("design:type",d.ContainerPool)],e.prototype,"pools",void 0),e=f.__decorate([p.Singleton(v.ModuleBuilderToken),f.__metadata("design:paramtypes",[])],e)}();t.ModuleBuilder=o});t(m);m.InjectModuleLoadToken,m.ModuleBuilder;var I=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),f.__exportStar(g,t),f.__exportStar(u,t),f.__exportStar(h,t),f.__exportStar(v,t),f.__exportStar(m,t)});t(I);var T=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.container=e}return e.prototype.setup=function(){var e=this.container,t=e.get(p.LifeScopeToken);t.registerDecorator(a.DIModule,p.CoreActions.bindProvider,p.CoreActions.cache,p.CoreActions.componentBeforeInit,p.CoreActions.componentInit,p.CoreActions.componentAfterInit),t.registerDecorator(a.Bootstrap,p.CoreActions.bindProvider,p.CoreActions.cache,p.CoreActions.componentBeforeInit,p.CoreActions.componentInit,p.CoreActions.componentAfterInit),e.use(M,I,j)},e.classAnnations={name:"BootModule",params:{constructor:["container"],setup:[]}},e=f.__decorate([p.IocExt("setup"),f.__param(0,p.Inject(p.ContainerToken)),f.__metadata("design:paramtypes",[Object])],e)}();t.BootModule=n});t(T);T.BootModule;var B=n(function(e,t){var r,n;Object.defineProperty(t,"__esModule",{value:!0}),(n=r=t.ApplicationEvents||(t.ApplicationEvents={})).onRootContainerCreated="onRootContainerCreated",n.onRootContainerInited="onRooConatianerInited";var o=function(o){function t(e){var t=o.call(this)||this;return t.baseURL=e,t.inited=!1,t.customRegs=[],t.globalModules=[],t.configs=[],t.beforeInitPds=new p.MapSet,t.afterInitPds=new p.MapSet,t.events=new d.Events,t.initEvents(),t}return f.__extends(t,o),t.prototype.initEvents=function(){var e=this;this.events.on("onRooConatianerInited",function(n){e.afterInitPds.forEach(function(e,t){n.bindProvider(t,e)})})},t.create=function(e){return new t(e)},t.prototype.on=function(e,t){return this.events.on(e,t),this},t.prototype.off=function(e,t){return this.events.off(e,t),this},t.prototype.emit=function(e){for(var t,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];(t=this.events).emit.apply(t,[e].concat(n))},t.prototype.getPools=function(){return this.pools||(this.pools=new d.ContainerPool(this.createContainerBuilder()),this.createDefaultContainer()),this.pools},t.prototype.createContainerBuilder=function(){return new p.DefaultContainerBuilder},t.prototype.useConfiguration=function(e){p.isUndefined(e)&&(e=""),this.globalConfig=null;var t=this.configs.indexOf(e);return 0<=t&&this.configs.splice(t,1),this.configs.push(e),this},t.prototype.loadConfig=function(e,t){return e.has(s.AppConfigureLoaderToken)?e.resolve(s.AppConfigureLoaderToken,{baseURL:this.baseURL,container:e}).load(t):t?e.getBuilder().loader.load([t]).then(function(e){return e.length?e[0]:null}):Promise.resolve(null)},t.prototype.use=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.globalModules=this.globalModules.concat(e),this.inited=!1,this},t.prototype.provider=function(e,t,n){return n?this.beforeInitPds.set(e,t):this.afterInitPds.set(e,t),this},t.prototype.load=function(t,n){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(e){switch(e.label){case 0:return[4,this.initRootContainer()];case 1:return e.sent(),[2,o.prototype.load.call(this,t,n)]}})})},t.prototype.build=function(n,o,r){return f.__awaiter(this,void 0,void 0,function(){var t;return f.__generator(this,function(e){switch(e.label){case 0:return[4,this.load(n,o)];case 1:return t=e.sent(),[4,this.getBuilder(t).build(n,t,r)];case 2:return[2,e.sent()]}})})},t.prototype.bootstrap=function(n,o,r){return f.__awaiter(this,void 0,void 0,function(){var t;return f.__generator(this,function(e){switch(e.label){case 0:return[4,this.load(n,o)];case 1:return t=e.sent(),[4,this.getBuilder(t).bootstrap(n,t,r)];case 2:return[2,e.sent()]}})})},t.prototype.getBuilderByConfig=function(n,o){return f.__awaiter(this,void 0,void 0,function(){var t;return f.__generator(this,function(e){switch(e.label){case 0:return[4,this.load(n,o)];case 1:return t=e.sent(),[2,this.getBuilder(t)]}})})},t.prototype.getBuilder=function(e){var n,t=e.config,o=e.container;t&&(p.isClass(t.builder)&&(o.has(t.builder)||o.register(t.builder)),p.isToken(t.builder)?n=o.resolve(t.builder):t.builder instanceof I.ModuleBuilder&&(n=t.builder));var r=e.token;return!n&&r&&o.getTokenExtendsChain(r).forEach(function(e){if(n)return!1;var t=new I.InjectModuleBuilderToken(e);return o.has(t)&&(n=o.get(t)),!0}),n||(n=this.getDefaultBuilder(o)),n||this},t.prototype.getDefaultBuilder=function(e){return e.has(I.DefaultModuleBuilderToken)?e.resolve(I.DefaultModuleBuilderToken):e.resolve(I.ModuleBuilderToken)},t.prototype.getGlobalConfig=function(o){return f.__awaiter(this,void 0,void 0,function(){var t,n=this;return f.__generator(this,function(e){switch(e.label){case 0:return this.globalConfig?[3,3]:[4,this.getDefaultConfig(o)];case 1:return t=e.sent(),this.configs.length<1&&this.configs.push(""),[4,Promise.all(this.configs.map(function(e){return p.isString(e)?n.loadConfig(o,e):e}))];case 2:e.sent().forEach(function(e){e&&p.lang.assign(t,e)}),this.globalConfig=t,e.label=3;case 3:return[2,this.globalConfig]}})})},t.prototype.createDefaultContainer=function(){var e=this,n=this.pools.getDefault();return n.register(T.BootModule),n.getBuilder().getInjectorChain(n).first(n.resolve(I.DIModuleInjectorToken)),n.bindProvider(d.ContainerPoolToken,function(){return e.getPools()}),this.beforeInitPds.forEach(function(e,t){n.bindProvider(t,e)}),this.events.emit(r.onRootContainerCreated,n),n},t.prototype.initRootContainer=function(n){return f.__awaiter(this,void 0,void 0,function(){var t;return f.__generator(this,function(e){switch(e.label){case 0:return this.inited?[2]:(n=n||this.getPools().getDefault(),[4,this.getGlobalConfig(n)]);case 1:return t=e.sent(),[4,this.registerExts(n,t)];case 2:return e.sent(),this.bindAppConfig(t),n.bindProvider(s.AppConfigureToken,t),this.inited=!0,this.events.emit(r.onRootContainerInited,n),[2]}})})},t.prototype.registerExts=function(o,r){return f.__awaiter(this,void 0,void 0,function(){var t,n=this;return f.__generator(this,function(e){switch(e.label){case 0:return this.globalModules.length?(t=this.globalModules,[4,o.loadModule.apply(o,t)]):[3,2];case 1:e.sent(),e.label=2;case 2:return this.customRegs.length?[4,Promise.all(this.customRegs.map(function(t){return f.__awaiter(n,void 0,void 0,function(){return f.__generator(this,function(e){switch(e.label){case 0:return[4,t(o,r,this)];case 1:return[2,e.sent()]}})})}))]:[3,4];case 3:e.sent(),e.label=4;case 4:return[2,o]}})})},t.prototype.bindAppConfig=function(e){return this.baseURL&&(e.baseURL=this.baseURL),e},t.prototype.getDefaultConfig=function(t){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(e){return t.has(s.DefaultConfigureToken)?[2,t.resolve(s.DefaultConfigureToken)]:[2,{}]})})},t.classAnnations={name:"DefaultApplicationBuilder",params:{constructor:["baseURL"],initEvents:[],create:["baseURL"],on:["name","event"],off:["name","event"],emit:["name","args"],getPools:[],createContainerBuilder:[],useConfiguration:["config"],loadConfig:["container","src"],use:["modules"],provider:["provide","provider","beforRootInit"],load:["token","env"],build:["token","env","data"],bootstrap:["token","env","data"],getBuilderByConfig:["token","env"],getBuilder:["injmdl"],getDefaultBuilder:["container"],getGlobalConfig:["container"],createDefaultContainer:[],initRootContainer:["container"],registerExts:["container","config"],bindAppConfig:["config"],getDefaultConfig:["container"]}},t}(I.ModuleBuilder);t.DefaultApplicationBuilder=o});t(B);B.ApplicationEvents,B.DefaultApplicationBuilder;var D=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ApplicationBuilderToken=new p.InjectToken("DI_AppBuilder")});t(D);D.ApplicationBuilderToken;var j=n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),f.__exportStar(s,t),f.__exportStar(B,t),f.__exportStar(D,t)});return t(j),t(n(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),f.__exportStar(a,t),f.__exportStar(j,t),f.__exportStar(M,t),f.__exportStar(I,t),f.__exportStar(b,t),f.__exportStar(d,t),f.__exportStar(T,t)}))});
//# sourceMappingURL=sourcemaps/bootstrap.umd.min.js.map

//# sourceMappingURL=sourcemaps/bootstrap.umd.min.js.map

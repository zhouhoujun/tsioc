!function(o,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@ts-ioc/core"),require("@ts-ioc/aop")):"function"==typeof define&&define.amd?define(["@ts-ioc/core","@ts-ioc/aop"],e):(o.logs=o.logs||{},o.logs.umd=o.logs.umd||{},o.logs.umd.js=e(o["@ts-ioc/core"],o["@ts-ioc/aop"]))}(this,function(o,e){"use strict";o=o&&o.hasOwnProperty("default")?o.default:o,e=e&&e.hasOwnProperty("default")?e.default:e;var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function r(o,e){return o(e={exports:{}},e.exports),e.exports}var a=r(function(o,e){Object.defineProperty(e,"__esModule",{value:!0}),e.LogSymbols={LogConfigure:Symbol("LogConfigure"),ILoggerManager:Symbol("ILoggerManager"),IConfigureLoggerManager:Symbol("IConfigureLoggerManager")}});n(a);a.LogSymbols;var i=r(function(n,r){var i=t&&t.__decorate||function(o,e,t,n){var r,a=arguments.length,i=a<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(o,e,t,n);else for(var g=o.length-1;g>=0;g--)(r=o[g])&&(i=(a<3?r(i):a>3?r(e,t,i):r(e,t))||i);return a>3&&i&&Object.defineProperty(e,t,i),i},g=t&&t.__metadata||function(o,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(o,e)},s=function(){function t(o){this.adapter=o||"console"}return t.prototype.format=function(o,t){switch(o.state){case e.JoinpointState.Before:case e.JoinpointState.Pointcut:return'%s invoke method "%s" with args %o.';case e.JoinpointState.After:return'%s invoke method "%s".';case e.JoinpointState.AfterReturning:return'Invoke method "%s" returning value %o.';case e.JoinpointState.AfterThrowing:return'Invoke method "%s" throw error %o.';default:return""}},t.prototype.formatArgs=function(o,t){switch(o.state){case e.JoinpointState.Before:case e.JoinpointState.Pointcut:return[o.state,o.fullName,o.args];case e.JoinpointState.After:return[o.state,o.fullName];case e.JoinpointState.AfterReturning:return[o.fullName,o.returningValue||""];case e.JoinpointState.AfterThrowing:return[o.fullName,o.throwing||""];default:return[]}},t.classAnnations={name:"DefaultLogConfigure",params:{constructor:["adapter"],format:["joinPoint","logger"],formatArgs:["joinPoint","logger"]}},t=i([e.NonePointcut(),o.Singleton(a.LogSymbols.LogConfigure),g("design:paramtypes",[Object])],t)}();r.DefaultLogConfigure=s});n(i);i.DefaultLogConfigure;var g=r(function(n,r){var g=t&&t.__param||function(o,e){return function(t,n){e(t,n,o)}},s=function(){function t(o,e){this.container=o,this.setLogConfigure(e)}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config||(this.container.has(a.LogSymbols.LogConfigure)||this.container.register(i.DefaultLogConfigure),this._config=this.container.resolve(a.LogSymbols.LogConfigure)),this._config},enumerable:!0,configurable:!0}),t.prototype.setLogConfigure=function(e){e&&(o.isClass(e)?this.container.has(a.LogSymbols.LogConfigure)?this.container.has(e)||(this.container.register(e),this._config=this.container.get(e)):(this.container.register(a.LogSymbols.LogConfigure,e),this._config=this.container.get(a.LogSymbols.LogConfigure)):this._config=e,this._logManger=null)},Object.defineProperty(t.prototype,"logManger",{get:function(){if(!this._logManger){var e=this.config||{},t=e.adapter||"console",n=void 0;n=o.isString(t)?new o.Registration(a.LogSymbols.ILoggerManager,t):t,this._logManger=this.container.get(n),e.config&&this._logManger.configure(e.config)}return this._logManger},enumerable:!0,configurable:!0}),t.prototype.configure=function(o){this.logManger.configure(o)},t.prototype.getLogger=function(o){return this.logManger.getLogger(o)},t.classAnnations={name:"ConfigureLoggerManger",params:{constructor:["container","config"],setLogConfigure:["config"],configure:["config"],getLogger:["name"]}},t=__decorate([e.NonePointcut(),o.Injectable(a.LogSymbols.IConfigureLoggerManager),g(0,o.Inject(o.symbols.IContainer)),__metadata("design:paramtypes",[Object,Object])],t)}();r.ConfigureLoggerManger=s});n(g);g.ConfigureLoggerManger;var s=r(function(t,n){var r=function(){function t(){this.logger=new i}return t.prototype.configure=function(o){},t.prototype.getLogger=function(o){return this.logger},t.classAnnations={name:"ConsoleLogManager",params:{constructor:[],configure:["config"],getLogger:["name"]}},t=__decorate([e.NonePointcut(),o.Singleton(),o.Injectable(a.LogSymbols.ILoggerManager,"console"),__metadata("design:paramtypes",[])],t)}();n.ConsoleLogManager=r;var i=function(){function o(){}return o.prototype.log=function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];console.log.apply(console,o)},o.prototype.trace=function(o){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];console.trace.apply(console,[o].concat(e))},o.prototype.debug=function(o){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];console.debug.apply(console,[o].concat(e))},o.prototype.info=function(o){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];console.info.apply(console,[o].concat(e))},o.prototype.warn=function(o){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];console.warn.apply(console,[o].concat(e))},o.prototype.error=function(o){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];console.error.apply(console,[o].concat(e))},o.prototype.fatal=function(o){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];console.error.apply(console,[o].concat(e))},o.classAnnations={name:"ConsoleLog",params:{log:["args"],trace:["message","args"],debug:["message","args"],info:["message","args"],warn:["message","args"],error:["message","args"],fatal:["message","args"]}},o}();n.ConsoleLog=i});n(s);s.ConsoleLogManager,s.ConsoleLog;var c=r(function(t,n){var r=function(){function t(o,e){this.container=o,this.config=e}return Object.defineProperty(t.prototype,"logger",{get:function(){return this._logger||(this._logger=this.logManger.getLogger()),this._logger},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logManger",{get:function(){return this._logManger||(this._logManger=this.container.resolve(a.LogSymbols.IConfigureLoggerManager,{config:this.config})),this._logManger},enumerable:!0,configurable:!0}),t.prototype.processLog=function(o,e){var t=this;e&&e.length?e.forEach(function(e){var n=!1;e.express&&e.express(o)?n=!0:e.express||(n=!0),n&&t.writeLog(e.logname?t.logManger.getLogger(e.logname):t.logger,o,e.message)}):this.writeLog(this.logger,o)},t.prototype.writeLog=function(t,n,r){var a=this.logManger.config,i=o.isFunction(a.customFormat);if(r&&t.info(r),i)a.customFormat(n,t);else if(a.format){var g=o.isFunction(a.format)?a.format(n,t):"";if(!g)return;var s=o.isFunction(a.formatArgs)?a.formatArgs(n,t):[];switch(n.state){case e.JoinpointState.Before:case e.JoinpointState.After:case e.JoinpointState.AfterReturning:t.debug.apply(t,[g].concat(s));break;case e.JoinpointState.Pointcut:t.info.apply(t,[g].concat(s));break;case e.JoinpointState.AfterThrowing:t.error.apply(t,[g].concat(s))}}},t.classAnnations={name:"LoggerAspect",params:{constructor:["container","config"],processLog:["joinPoint","annotation"],writeLog:["logger","joinPoint","message"]}},t}();n.LoggerAspect=r});n(c);c.LoggerAspect;var u=r(function(n,r){var a,i=t&&t.__extends||(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,e){o.__proto__=e}||function(o,e){for(var t in e)e.hasOwnProperty(t)&&(o[t]=e[t])},function(o,e){function t(){this.constructor=o}a(o,e),o.prototype=null===e?Object.create(e):(t.prototype=e.prototype,new t)}),g=function(t){function n(o){return t.call(this,o)||this}return i(n,t),n.prototype.logging=function(o,e){this.processLog(o,e)},n.classAnnations={name:"AnnotationLogerAspect",params:{constructor:["container"],logging:["joinPoint","annotation"]}},__decorate([e.Pointcut("@annotation(Logger)","annotation"),__metadata("design:type",Function),__metadata("design:paramtypes",[e.Joinpoint,Array]),__metadata("design:returntype",void 0)],n.prototype,"logging",null),n=__decorate([o.Singleton(),e.Aspect(),__param(0,o.Inject(o.symbols.IContainer)),__metadata("design:paramtypes",[Object])],n)}(c.LoggerAspect);r.AnnotationLogerAspect=g});n(u);u.AnnotationLogerAspect;var f=r(function(e,t){t.Logger=o.createClassMethodDecorator("Logger",function(e){e.next({isMetadata:function(e){return o.isClassMetadata(e,["logname"])},match:function(e){return o.isString(e)},setMetadata:function(o,e){o.logname=e}}),e.next({match:function(e){return o.isFunction(e)},setMetadata:function(o,e){o.express=e}}),e.next({match:function(e){return o.isString(e)},setMetadata:function(o,e){o.message=e}})})});n(f);f.Logger;var l=r(function(t,n){var r=function(){function t(o){this.container=o}return t.prototype.setup=function(){var t=this.container;t.has(e.AopModule)||t.register(e.AopModule),t.get(o.symbols.LifeScope).registerDecorator(f.Logger,o.LifeState.onInit,o.CoreActions.bindParameterProviders),t.register(g.ConfigureLoggerManger),t.register(u.AnnotationLogerAspect),t.register(s.ConsoleLogManager)},t.symbols=a.LogSymbols,t.classAnnations={name:"LogModule",params:{constructor:["container"],setup:[]}},t=__decorate([o.IocModule("setup"),__param(0,o.Inject(o.symbols.IContainer)),__metadata("design:paramtypes",[Object])],t)}();n.LogModule=r});n(l);l.LogModule;return n(r(function(o,e){function t(o){for(var t in o)e.hasOwnProperty(t)||(e[t]=o[t])}t(a),t(g),t(s),t(i),t(c),t(u),t(f),t(l)}))});
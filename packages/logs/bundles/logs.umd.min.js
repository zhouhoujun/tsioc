!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("tslib"),require("@ts-ioc/core"),require("@ts-ioc/aop")):"function"==typeof define&&define.amd?define(["tslib","@ts-ioc/core","@ts-ioc/aop"],t):(e.logs=e.logs||{},e.logs.umd=e.logs.umd||{},e.logs.umd.js=t(e.tslib_1,e["@ts-ioc/core"],e["@ts-ioc/aop"]))}(this,function(r,a,i){"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}r=r&&r.hasOwnProperty("default")?r.default:r,a=a&&a.hasOwnProperty("default")?a.default:a,i=i&&i.hasOwnProperty("default")?i.default:i;var s=t(function(e,t){var o,n;Object.defineProperty(t,"__esModule",{value:!0}),(n=t.Level||(t.Level={})).log="log",n.trace="trace",n.debug="debug",n.info="info",n.warn="warn",n.error="error",n.fatal="fatal",(o=t.Levels||(t.Levels={}))[o.trace=0]="trace",o[o.debug=1]="debug",o[o.info=2]="info",o[o.warn=3]="warn",o[o.error=4]="error",o[o.fatal=5]="fatal"});e(s);s.Level,s.Levels;var g=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerManagerToken=new a.InjectToken("DI_ILoggerManager")});e(g);g.LoggerManagerToken;var n=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigureLoggerManagerToken=new a.InjectToken("DI_IConfigureLoggerManager")});e(n);n.ConfigureLoggerManagerToken;var c=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LogConfigureToken=new a.InjectToken("DI_LogConfigure")});e(c);c.LogConfigureToken;var u=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.container=e,this.setLogConfigure(t)}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config||(this.container.has(c.LogConfigureToken)?this._config=this.container.resolve(c.LogConfigureToken):this._config={adapter:"console"}),this._config},enumerable:!0,configurable:!0}),e.prototype.setLogConfigure=function(e){e&&(a.isClass(e)?this.container.has(c.LogConfigureToken)?this.container.has(e)||(this.container.register(e),this._config=this.container.get(e)):(this.container.register(c.LogConfigureToken,e),this._config=this.container.get(c.LogConfigureToken)):this._config=e,this._logManger=null)},Object.defineProperty(e.prototype,"logManger",{get:function(){if(!this._logManger){var e,t=this.config||{},o=t.adapter||"console";e=a.isString(o)?new a.Registration(g.LoggerManagerToken,o):o,this._logManger=this.container.get(e),t.config&&this._logManger.configure(t.config)}return this._logManger},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){this.logManger.configure(e)},e.prototype.getLogger=function(e){return this.logManger.getLogger(e)},e.classAnnations={name:"ConfigureLoggerManger",params:{constructor:["container","config"],setLogConfigure:["config"],configure:["config"],getLogger:["name"]}},r.__decorate([i.NonePointcut(),a.Injectable(n.ConfigureLoggerManagerToken),r.__param(0,a.Inject(a.ContainerToken)),r.__metadata("design:paramtypes",[Object,Object])],e)}();t.ConfigureLoggerManger=o});e(u);u.ConfigureLoggerManger;var f=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.logger=new n}return e.prototype.configure=function(e){e&&e.level&&(this.logger.level=e.level)},e.prototype.getLogger=function(e){return this.logger},e.classAnnations={name:"ConsoleLogManager",params:{constructor:[],configure:["config"],getLogger:["name"]}},r.__decorate([i.NonePointcut(),a.Singleton(),a.Injectable(g.LoggerManagerToken,"console"),r.__metadata("design:paramtypes",[])],e)}();t.ConsoleLogManager=o;var n=function(){function e(){}return e.prototype.log=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];console.log.apply(console,[e].concat(t))},e.prototype.trace=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.level&&0!==s.Levels[this.level]||console.debug.apply(console,[e].concat(t))},e.prototype.debug=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];(!this.level||s.Levels[this.level]<=1)&&console.debug.apply(console,[e].concat(t))},e.prototype.info=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];(!this.level||s.Levels[this.level]<=2)&&console.info.apply(console,[e].concat(t))},e.prototype.warn=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];(!this.level||s.Levels[this.level]<=3)&&console.warn.apply(console,[e].concat(t))},e.prototype.error=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];(!this.level||s.Levels[this.level]<=4)&&console.error.apply(console,[e].concat(t))},e.prototype.fatal=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];(!this.level||s.Levels[this.level]<=5)&&console.error.apply(console,[e].concat(t))},e.classAnnations={name:"ConsoleLog",params:{constructor:[],log:["message","args"],trace:["message","args"],debug:["message","args"],info:["message","args"],warn:["message","args"],error:["message","args"],fatal:["message","args"]}},e}()});e(f);f.ConsoleLogManager;var l=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LogFormaterToken=new a.InjectToken("DI_LogFormater");var o=function(){function e(){}return e.prototype.format=function(e,t){var o;switch(e.state){case i.JoinpointState.Before:case i.JoinpointState.Pointcut:o=e.state+' invoke method "'+e.fullName+'" with args '+this.stringifyArgs(e.params,e.args)+".";break;case i.JoinpointState.After:o=e.state+'  invoke method "'+e.fullName+'".';break;case i.JoinpointState.AfterReturning:o='Invoke method "'+e.fullName+'" returning value '+this.stringify(e.returningValue)+".";break;case i.JoinpointState.AfterThrowing:o='Invoke method "'+e.fullName+'" throw error '+this.stringify(e.throwing)+".";break;default:o=""}return this.joinMessage([o,t])},e.prototype.stringifyArgs=function(e,n){var r=this,t=e.map(function(e,t){var o=n.length>=t?n[t]:null;return'<param name: "'+(e.name||"")+'", param type: "'+r.stringify(e.type)+'"> '+r.stringify(o)}).join(", ");return t?this.joinMessage(["[",t,"]"]," "):"[]"},e.prototype.joinMessage=function(e,t){return void 0===t&&(t="; "),e.filter(function(e){return e}).map(function(e){return a.isString(e)?e:e.toString()}).join(t)},e.prototype.stringifyArray=function(e){var t=this;return e.length?"[ "+e.map(function(e){return t.stringify(e)}).join(", ")+" ]":"[]"},e.prototype.stringify=function(t){if(a.isString(t))return t;if(a.isArray(t))return this.stringifyArray(t);if(a.isBaseType(t))return t;if(a.isClass(t))return"[class "+a.getClassName(t)+"]";if(a.isFunction(t)||a.isDate(t)||a.isSymbol(t))return t.toString();if(a.isObject(t))try{return JSON.stringify(t)}catch(e){if(a.isFunction(t.toString))return t.toString()}return""},e.classAnnations={name:"LogFormater",params:{constructor:[],format:["joinPoint","message"],stringifyArgs:["params","args"],joinMessage:["messgs","separator"],stringifyArray:["args"],stringify:["target"]}},r.__decorate([i.NonePointcut(),a.Singleton(t.LogFormaterToken,"default"),r.__metadata("design:paramtypes",[])],e)}();t.LogFormater=o});e(l);l.LogFormaterToken,l.LogFormater;var p=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.container=e,this.config=t}return Object.defineProperty(e.prototype,"logger",{get:function(){return this._logger||(this._logger=this.logManger.getLogger()),this._logger},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"logManger",{get:function(){return this._logManger||(this._logManger=this.container.resolve(n.ConfigureLoggerManagerToken,{config:this.config})),this._logManger},enumerable:!0,configurable:!0}),e.prototype.processLog=function(o,e,n,r){var a=this;e&&e.length?e.forEach(function(e){var t=!1;e.express&&e.express(o)?t=!0:e.express||(t=!0),t&&a.writeLog(e.logname?a.logManger.getLogger(e.logname):a.logger,o,a.joinMessage(n,e.message),e.level||r)}):this.writeLog(this.logger,o,n,r)},e.prototype.formatMessage=function(e,t){var o=this.logManger.config;if(a.isClass(o.format))return this.container.has(o.format)||this.container.register(o.format),this.container.resolve(o.format).format(e,t);if(a.isFunction(o.format))return o.format(e,t);if(a.isObject(o.format)&&a.isFunction(o.format))return o.format.format(e,t);var n=a.isString(o.format)?o.format:"",r=this.container.resolve(new a.Registration(l.LogFormaterToken,n||"default"));return r?r.format(e,t):""},e.prototype.joinMessage=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.filter(function(e){return e}).map(function(e){return a.isString(e)?e:e.toString()}).join("; ")},e.prototype.writeLog=function(e,t,o,n){var r=this.formatMessage(t,o);if(n)e[n](r);else switch(t.state){case i.JoinpointState.Before:case i.JoinpointState.After:case i.JoinpointState.AfterReturning:e.debug(r);break;case i.JoinpointState.Pointcut:e.info(r);break;case i.JoinpointState.AfterThrowing:e.error(r)}},e.classAnnations={name:"LoggerAspect",params:{constructor:["container","config"],processLog:["joinPoint","annotation","message","level"],formatMessage:["joinPoint","message"],joinMessage:["messgs"],writeLog:["logger","joinPoint","message","level"]}},r.__decorate([a.Abstract(),r.__metadata("design:paramtypes",[Object,Object])],e)}();t.LoggerAspect=o});e(p);p.LoggerAspect;var m=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=function(t){function e(e){return t.call(this,e)||this}return r.__extends(e,t),e.prototype.logging=function(e,t){this.processLog(e,t)},e.classAnnations={name:"AnnotationLogerAspect",params:{constructor:["container"],logging:["joinPoint","annotation"]}},r.__decorate([i.Pointcut("@annotation(Logger)","annotation"),r.__metadata("design:type",Function),r.__metadata("design:paramtypes",[i.Joinpoint,Array]),r.__metadata("design:returntype",void 0)],e.prototype,"logging",null),r.__decorate([a.Singleton(),i.Aspect(),r.__param(0,a.Inject(a.ContainerToken)),r.__metadata("design:paramtypes",[Object])],e)}(p.LoggerAspect);t.AnnotationLogerAspect=o});e(m);m.AnnotationLogerAspect;var h=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=a.createClassMethodDecorator("Logger",function(e){e.next({isMetadata:function(e){return a.isClassMetadata(e,["logname"])},match:function(e){return a.isString(e)},setMetadata:function(e,t){e.logname=t}}),e.next({match:function(e){return a.isFunction(e)},setMetadata:function(e,t){e.express=t}}),e.next({match:function(e){return a.isString(e)},setMetadata:function(e,t){e.message=t}}),e.next({match:function(e){return a.isString(e)},setMetadata:function(e,t){e.level=s.Level[t]}})})});e(h);h.Logger;var o=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e){this.container=e}return e.prototype.setup=function(){var e=this.container;e.has(i.AopModule)||e.register(i.AopModule),e.get(a.LifeScopeToken).registerDecorator(h.Logger,a.LifeState.onInit,a.CoreActions.bindParameterProviders),e.register(u.ConfigureLoggerManger),e.register(m.AnnotationLogerAspect),e.register(l.LogFormater),e.register(f.ConsoleLogManager)},e.classAnnations={name:"LogModule",params:{constructor:["container"],setup:[]}},r.__decorate([a.IocExt("setup"),r.__param(0,a.Inject(a.ContainerToken)),r.__metadata("design:paramtypes",[Object])],e)}();t.LogModule=o});e(o);o.LogModule;return e(t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),r.__exportStar(s,t),r.__exportStar(g,t),r.__exportStar(n,t),r.__exportStar(u,t),r.__exportStar(f,t),r.__exportStar(c,t),r.__exportStar(l,t),r.__exportStar(p,t),r.__exportStar(m,t),r.__exportStar(h,t),r.__exportStar(o,t)}))});
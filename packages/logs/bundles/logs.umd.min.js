!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@ts-ioc/core"),require("@ts-ioc/aop")):"function"==typeof define&&define.amd?define(["@ts-ioc/core","@ts-ioc/aop"],t):(e.logs=e.logs||{},e.logs.umd=e.logs.umd||{},e.logs.umd.js=t(e["@ts-ioc/core"],e["@ts-ioc/aop"]))}(this,function(a,i){"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function t(e,t){return e(t={exports:{}},t.exports),t.exports}a=a&&a.hasOwnProperty("default")?a.default:a,i=i&&i.hasOwnProperty("default")?i.default:i;var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};var n=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};function r(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function s(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,a=n.call(e),i=[];try{for(;(void 0===t||0<t--)&&!(o=a.next()).done;)i.push(o.value)}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i}function f(e){return this instanceof f?(this.v=e,this):new f(e)}var c=Object.freeze({__extends:function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__assign:n,__rest:function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&(n[o[r]]=e[o[r]])}return n},__decorate:function(e,t,n,o){var r,a=arguments.length,i=a<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;0<=s;s--)(r=e[s])&&(i=(a<3?r(i):3<a?r(t,n,i):r(t,n))||i);return 3<a&&i&&Object.defineProperty(t,n,i),i},__param:function(n,o){return function(e,t){o(e,t,n)}},__metadata:function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter:function(a,i,s,c){return new(s||(s=Promise))(function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function o(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(n,o)}r((c=c.apply(a,i||[])).next())})},__generator:function(n,o){var r,a,i,e,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,a&&(i=a[2&t[0]?"return":t[0]?"throw":"next"])&&!(i=i.call(a,t[1])).done)return i;switch(a=0,i&&(t=[0,i.value]),t[0]){case 0:case 1:i=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){s.label=t[1];break}if(6===t[0]&&s.label<i[1]){s.label=i[1],i=t;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(t);break}i[2]&&s.ops.pop(),s.trys.pop();continue}t=o.call(n,s)}catch(e){t=[6,e],a=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},__exportStar:function(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])},__values:r,__read:s,__spread:function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(s(arguments[t]));return e},__await:f,__asyncGenerator:function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,a=n.apply(e,t||[]),i=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(o){a[o]&&(r[o]=function(n){return new Promise(function(e,t){1<i.push([o,n,e,t])||s(o,n)})})}function s(e,t){try{(n=a[e](t)).value instanceof f?Promise.resolve(n.value.v).then(c,g):u(i[0][2],n)}catch(e){u(i[0][3],e)}var n}function c(e){s("next",e)}function g(e){s("throw",e)}function u(e,t){e(t),i.shift(),i.length&&s(i[0][0],i[0][1])}},__asyncDelegator:function(o){var e,r;return e={},t("next"),t("throw",function(e){throw e}),t("return"),e[Symbol.iterator]=function(){return this},e;function t(t,n){o[t]&&(e[t]=function(e){return(r=!r)?{value:f(o[t](e)),done:"return"===t}:n?n(e):e})}},__asyncValues:function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=e[Symbol.asyncIterator];return t?t.call(e):r(e)},__makeTemplateObject:function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__importStar:function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},__importDefault:function(e){return e&&e.__esModule?e:{default:e}}}),g=t(function(e,t){var n,o;Object.defineProperty(t,"__esModule",{value:!0}),(n=t.Level||(t.Level={})).log="log",n.trace="trace",n.debug="debug",n.info="info",n.warn="warn",n.error="error",n.fatal="fatal",(o=t.Levels||(t.Levels={}))[o.trace=0]="trace",o[o.debug=1]="debug",o[o.info=2]="info",o[o.warn=3]="warn",o[o.error=4]="error",o[o.fatal=5]="fatal"});e(g);g.Level,g.Levels;var u=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerManagerToken=new a.InjectToken("__IOC_ILoggerManager")});e(u);u.LoggerManagerToken;var l=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigureLoggerManagerToken=new a.InjectToken("__IOC_IConfigureLoggerManager")});e(l);l.ConfigureLoggerManagerToken;var p=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LogConfigureToken=new a.InjectToken("__IOC_LogConfigure")});e(p);p.LogConfigureToken;var _=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.container=e,this.setLogConfigure(t)}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config||(this.container.has(p.LogConfigureToken)?this._config=this.container.resolve(p.LogConfigureToken):this._config={adapter:"console"}),this._config},enumerable:!0,configurable:!0}),e.prototype.setLogConfigure=function(e){e&&(a.isClass(e)?this.container.has(p.LogConfigureToken)?this.container.has(e)||(this.container.register(e),this._config=this.container.get(e)):(this.container.register(p.LogConfigureToken,e),this._config=this.container.get(p.LogConfigureToken)):this._config=e,this._logManger=null)},Object.defineProperty(e.prototype,"logManger",{get:function(){if(!this._logManger){var e=this.config||{},t=e.adapter||"console",n=void 0;n=a.isString(t)?new a.Registration(u.LoggerManagerToken,t):t,this._logManger=this.container.get(n),e.config&&this._logManger.configure(e.config)}return this._logManger},enumerable:!0,configurable:!0}),e.prototype.configure=function(e){this.logManger.configure(e)},e.prototype.getLogger=function(e){return this.logManger.getLogger(e)},e.classAnnations={name:"ConfigureLoggerManger",params:{constructor:["container","config"],setLogConfigure:["config"],configure:["config"],getLogger:["name"]}},e=c.__decorate([i.NonePointcut(),a.Injectable(l.ConfigureLoggerManagerToken),c.__param(0,a.Inject(a.ContainerToken)),c.__metadata("design:paramtypes",[Object,Object])],e)}();t.ConfigureLoggerManger=n});e(_);_.ConfigureLoggerManger;var y=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.logger=new o}return e.prototype.configure=function(e){e&&e.level&&(this.logger.level=e.level)},e.prototype.getLogger=function(e){return this.logger},e.classAnnations={name:"ConsoleLogManager",params:{constructor:[],configure:["config"],getLogger:["name"]}},e=c.__decorate([i.NonePointcut(),a.Singleton(),a.Injectable(u.LoggerManagerToken,"console"),c.__metadata("design:paramtypes",[])],e)}();t.ConsoleLogManager=n;var o=function(){function e(){}return e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];console.log.apply(console,[e].concat(t))},e.prototype.trace=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.level&&0!==g.Levels[this.level]||console.debug.apply(console,[e].concat(t))},e.prototype.debug=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];(!this.level||g.Levels[this.level]<=1)&&console.debug.apply(console,[e].concat(t))},e.prototype.info=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];(!this.level||g.Levels[this.level]<=2)&&console.info.apply(console,[e].concat(t))},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];(!this.level||g.Levels[this.level]<=3)&&console.warn.apply(console,[e].concat(t))},e.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];(!this.level||g.Levels[this.level]<=4)&&console.error.apply(console,[e].concat(t))},e.prototype.fatal=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];(!this.level||g.Levels[this.level]<=5)&&console.error.apply(console,[e].concat(t))},e.classAnnations={name:"ConsoleLog",params:{constructor:[],log:["message","args"],trace:["message","args"],debug:["message","args"],info:["message","args"],warn:["message","args"],error:["message","args"],fatal:["message","args"]}},e}()});e(y);y.ConsoleLogManager;var h=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LogFormaterToken=new a.InjectToken("__IOC_LogFormater");var n=function(){function e(){}return e.prototype.format=function(e,t){var n;switch(e.state){case i.JoinpointState.Before:case i.JoinpointState.Pointcut:n=e.state+' invoke method "'+e.fullName+'" with args '+this.stringifyArgs(e.params,e.args)+".";break;case i.JoinpointState.After:n=e.state+'  invoke method "'+e.fullName+'".';break;case i.JoinpointState.AfterReturning:n='Invoke method "'+e.fullName+'" returning value '+this.stringify(e.returningValue)+".";break;case i.JoinpointState.AfterThrowing:n='Invoke method "'+e.fullName+'" throw error '+this.stringify(e.throwing)+".";break;default:n=""}return this.joinMessage([n,t])},e.prototype.stringifyArgs=function(e,o){var r=this,t=e.map(function(e,t){var n=o.length>=t?o[t]:null;return'<param name: "'+(e.name||"")+'", param type: "'+r.stringify(e.type)+'"> '+r.stringify(n)}).join(", ");return t?this.joinMessage(["[",t,"]"]," "):"[]"},e.prototype.joinMessage=function(e,t){return void 0===t&&(t="; "),e.filter(function(e){return e}).map(function(e){return a.isString(e)?e:e.toString()}).join(t)},e.prototype.stringifyArray=function(e){var t=this;return e.length?"[ "+e.map(function(e){return t.stringify(e)}).join(", ")+" ]":"[]"},e.prototype.stringify=function(t){if(a.isString(t))return t;if(a.isArray(t))return this.stringifyArray(t);if(a.isBaseType(t))return t;if(a.isClass(t))return"[class "+a.getClassName(t)+"]";if(a.isFunction(t)||a.isDate(t)||a.isSymbol(t))return t.toString();if(a.isObject(t))try{return JSON.stringify(t)}catch(e){if(a.isFunction(t.toString))return t.toString()}return""},e.classAnnations={name:"LogFormater",params:{constructor:[],format:["joinPoint","message"],stringifyArgs:["params","args"],joinMessage:["messgs","separator"],stringifyArray:["args"],stringify:["target"]}},e=c.__decorate([i.NonePointcut(),a.Singleton(t.LogFormaterToken,"default"),c.__metadata("design:paramtypes",[])],e)}();t.LogFormater=n});e(h);h.LogFormaterToken,h.LogFormater;var m=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.container=e,this.config=t}return Object.defineProperty(e.prototype,"logger",{get:function(){return this._logger||(this._logger=this.logManger.getLogger()),this._logger},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"logManger",{get:function(){return this._logManger||(this._logManger=this.container.resolve(l.ConfigureLoggerManagerToken,{config:this.config})),this._logManger},enumerable:!0,configurable:!0}),e.prototype.processLog=function(n,e,o,r){var a=this;e&&e.length?e.forEach(function(e){var t=!1;e.express&&e.express(n)?t=!0:e.express||(t=!0),t&&a.writeLog(e.logname?a.logManger.getLogger(e.logname):a.logger,n,a.joinMessage(o,e.message),e.level||r)}):this.writeLog(this.logger,n,o,r)},e.prototype.formatMessage=function(e,t){var n=this.logManger.config;if(a.isClass(n.format))return this.container.has(n.format)||this.container.register(n.format),this.container.resolve(n.format).format(e,t);if(a.isFunction(n.format))return n.format(e,t);if(a.isObject(n.format)&&a.isFunction(n.format))return n.format.format(e,t);var o=a.isString(n.format)?n.format:"",r=this.container.resolve(new a.Registration(h.LogFormaterToken,o||"default"));return r?r.format(e,t):""},e.prototype.joinMessage=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e.filter(function(e){return e}).map(function(e){return a.isString(e)?e:e.toString()}).join("; ")},e.prototype.writeLog=function(e,t,n,o){var r=this.formatMessage(t,n);if(o)e[o](r);else switch(t.state){case i.JoinpointState.Before:case i.JoinpointState.After:case i.JoinpointState.AfterReturning:e.debug(r);break;case i.JoinpointState.Pointcut:e.info(r);break;case i.JoinpointState.AfterThrowing:e.error(r)}},e.classAnnations={name:"LoggerAspect",params:{constructor:["container","config"],processLog:["joinPoint","annotation","message","level"],formatMessage:["joinPoint","message"],joinMessage:["messgs"],writeLog:["logger","joinPoint","message","level"]}},e=c.__decorate([a.Abstract(),c.__metadata("design:paramtypes",[Object,Object])],e)}();t.LoggerAspect=n});e(m);m.LoggerAspect;var d=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(t){function e(e){return t.call(this,e)||this}return c.__extends(e,t),e.prototype.logging=function(e,t){this.processLog(e,t)},e.classAnnations={name:"AnnotationLogerAspect",params:{constructor:["container"],logging:["joinPoint","annotation"]}},c.__decorate([i.Pointcut("@annotation(Logger)","annotation"),c.__metadata("design:type",Function),c.__metadata("design:paramtypes",[i.Joinpoint,Array]),c.__metadata("design:returntype",void 0)],e.prototype,"logging",null),e=c.__decorate([a.Singleton(),i.Aspect(),c.__param(0,a.Inject(a.ContainerToken)),c.__metadata("design:paramtypes",[Object])],e)}(m.LoggerAspect);t.AnnotationLogerAspect=n});e(d);d.AnnotationLogerAspect;var v=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Logger=a.createClassMethodDecorator("Logger",function(e){e.next({isMetadata:function(e){return a.isClassMetadata(e,["logname"])},match:function(e){return a.isString(e)},setMetadata:function(e,t){e.logname=t}}),e.next({match:function(e){return a.isFunction(e)},setMetadata:function(e,t){e.express=t}}),e.next({match:function(e){return a.isString(e)},setMetadata:function(e,t){e.message=t}}),e.next({match:function(e){return a.isString(e)},setMetadata:function(e,t){e.level=g.Level[t]}})})});e(v);v.Logger;var b=t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.container=e}return e.prototype.setup=function(){var e=this.container;e.has(i.AopModule)||e.register(i.AopModule),e.get(a.LifeScopeToken).registerDecorator(v.Logger,a.LifeState.onInit,a.CoreActions.bindParameterProviders),e.register(_.ConfigureLoggerManger),e.register(d.AnnotationLogerAspect),e.register(h.LogFormater),e.register(y.ConsoleLogManager)},e.classAnnations={name:"LogModule",params:{constructor:["container"],setup:[]}},e=c.__decorate([a.IocExt("setup"),c.__param(0,a.Inject(a.ContainerToken)),c.__metadata("design:paramtypes",[Object])],e)}();t.LogModule=n});e(b);b.LogModule;return e(t(function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),c.__exportStar(g,t),c.__exportStar(u,t),c.__exportStar(l,t),c.__exportStar(_,t),c.__exportStar(y,t),c.__exportStar(p,t),c.__exportStar(h,t),c.__exportStar(m,t),c.__exportStar(d,t),c.__exportStar(v,t),c.__exportStar(b,t)}))});
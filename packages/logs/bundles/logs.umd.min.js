!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o(require("@ts-ioc/core"),require("@ts-ioc/aop")):"function"==typeof define&&define.amd?define(["@ts-ioc/core","@ts-ioc/aop"],o):(e.logs=e.logs||{},e.logs.umd=e.logs.umd||{},e.logs.umd.js=o(e["@ts-ioc/core"],e["@ts-ioc/aop"]))}(this,function(e,o){"use strict";function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function n(e,o){return o={exports:{}},e(o,o.exports),o.exports}e=e&&e.hasOwnProperty("default")?e.default:e,o=o&&o.hasOwnProperty("default")?o.default:o;var r="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},a=n(function(e,o){Object.defineProperty(o,"__esModule",{value:!0}),o.LogSymbols={LogConfigure:Symbol("LogConfigure"),ILoggerManager:Symbol("ILoggerManager"),IConfigureLoggerManager:Symbol("IConfigureLoggerManager")}});t(a);var i=n(function(t,n){var i=r&&r.__decorate||function(e,o,t,n){var r,a=arguments.length,i=a<3?o:null===n?n=Object.getOwnPropertyDescriptor(o,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,o,t,n);else for(var g=e.length-1;g>=0;g--)(r=e[g])&&(i=(a<3?r(i):a>3?r(o,t,i):r(o,t))||i);return a>3&&i&&Object.defineProperty(o,t,i),i},g=r&&r.__metadata||function(e,o){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,o)},s=function(){function t(e){this.adapter=e||"console"}return t.prototype.format=function(e,t){switch(e.state){case o.JoinpointState.Before:case o.JoinpointState.Pointcut:return'%s invoke method "%s" with args %o.';case o.JoinpointState.After:return'%s invoke method "%s".';case o.JoinpointState.AfterReturning:return'Invoke method "%s" returning value %o.';case o.JoinpointState.AfterThrowing:return'Invoke method "%s" throw error %o.';default:return""}},t.prototype.formatArgs=function(e,t){switch(e.state){case o.JoinpointState.Before:case o.JoinpointState.Pointcut:return[e.state,e.fullName,e.args];case o.JoinpointState.After:return[e.state,e.fullName];case o.JoinpointState.AfterReturning:return[e.fullName,e.returningValue||""];case o.JoinpointState.AfterThrowing:return[e.fullName,e.throwing||""];default:return[]}},t.classAnnations={name:"DefaultLogConfigure",params:{constructor:["adapter"],format:["joinPoint","logger"],formatArgs:["joinPoint","logger"]}},t=i([o.NonePointcut(),e.Singleton(a.LogSymbols.LogConfigure),g("design:paramtypes",[Object])],t)}();n.DefaultLogConfigure=s});t(i);var g=n(function(t,n){var g=r&&r.__param||function(e,o){return function(t,n){o(t,n,e)}},s=function(){function t(e,o){this.container=e,this.setLogConfigure(o)}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config||(this.container.has(a.LogSymbols.LogConfigure)||this.container.register(i.DefaultLogConfigure),this._config=this.container.resolve(a.LogSymbols.LogConfigure)),this._config},enumerable:!0,configurable:!0}),t.prototype.setLogConfigure=function(o){o&&(e.isClass(o)?this.container.has(a.LogSymbols.LogConfigure)?this.container.has(o)||(this.container.register(o),this._config=this.container.get(o)):(this.container.register(a.LogSymbols.LogConfigure,o),this._config=this.container.get(a.LogSymbols.LogConfigure)):this._config=o,this._logManger=null)},Object.defineProperty(t.prototype,"logManger",{get:function(){if(!this._logManger){var o=this.config||{},t=o.adapter||"console",n=void 0;n=e.isString(t)?new e.Registration(a.LogSymbols.ILoggerManager,t):t,this._logManger=this.container.get(n),o.config&&this._logManger.configure(o.config)}return this._logManger},enumerable:!0,configurable:!0}),t.prototype.configure=function(e){this.logManger.configure(e)},t.prototype.getLogger=function(e){return this.logManger.getLogger(e)},t.classAnnations={name:"ConfigureLoggerManger",params:{constructor:["container","config"],setLogConfigure:["config"],configure:["config"],getLogger:["name"]}},t=__decorate([o.NonePointcut(),e.Injectable(a.LogSymbols.IConfigureLoggerManager),g(0,e.Inject(e.symbols.IContainer)),__metadata("design:paramtypes",[Object,Object])],t)}();n.ConfigureLoggerManger=s});t(g);var s=n(function(t,n){var r=function(){function t(){this.logger=new i}return t.prototype.configure=function(e){},t.prototype.getLogger=function(e){return this.logger},t.classAnnations={name:"ConsoleLogManager",params:{constructor:[],configure:["config"],getLogger:["name"]}},t=__decorate([o.NonePointcut(),e.Singleton(),e.Injectable(a.LogSymbols.ILoggerManager,"console"),__metadata("design:paramtypes",[])],t)}();n.ConsoleLogManager=r;var i=function(){function e(){}return e.prototype.log=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];console.log.apply(console,e)},e.prototype.trace=function(e){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];console.trace.apply(console,[e].concat(o))},e.prototype.debug=function(e){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];console.debug.apply(console,[e].concat(o))},e.prototype.info=function(e){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];console.info.apply(console,[e].concat(o))},e.prototype.warn=function(e){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];console.warn.apply(console,[e].concat(o))},e.prototype.error=function(e){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];console.error.apply(console,[e].concat(o))},e.prototype.fatal=function(e){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];console.error.apply(console,[e].concat(o))},e.classAnnations={name:"ConsoleLog",params:{log:["args"],trace:["message","args"],debug:["message","args"],info:["message","args"],warn:["message","args"],error:["message","args"],fatal:["message","args"]}},e}()});t(s);var c=n(function(t,n){var r=function(){function t(e,o){this.container=e,this.config=o}return Object.defineProperty(t.prototype,"logger",{get:function(){return this._logger||(this._logger=this.logManger.getLogger()),this._logger},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logManger",{get:function(){return this._logManger||(this._logManger=this.container.resolve(a.LogSymbols.IConfigureLoggerManager,{config:this.config})),this._logManger},enumerable:!0,configurable:!0}),t.prototype.processLog=function(e,o){var t=this;o&&o.length?o.forEach(function(o){var n=!1;o.express&&o.express(e)?n=!0:o.express||(n=!0),n&&t.writeLog(o.logname?t.logManger.getLogger(o.logname):t.logger,e,o.message)}):this.writeLog(this.logger,e)},t.prototype.writeLog=function(t,n,r){var a=this.logManger.config,i=e.isFunction(a.customFormat);if(r&&t.info(r),i)a.customFormat(n,t);else if(a.format){var g=e.isFunction(a.format)?a.format(n,t):"";if(!g)return;var s=e.isFunction(a.formatArgs)?a.formatArgs(n,t):[];switch(n.state){case o.JoinpointState.Before:case o.JoinpointState.After:case o.JoinpointState.AfterReturning:t.debug.apply(t,[g].concat(s));break;case o.JoinpointState.Pointcut:t.info.apply(t,[g].concat(s));break;case o.JoinpointState.AfterThrowing:t.error.apply(t,[g].concat(s))}}},t.classAnnations={name:"LoggerAspect",params:{constructor:["container","config"],processLog:["joinPoint","annotation"],writeLog:["logger","joinPoint","message"]}},t}();n.LoggerAspect=r});t(c);var u=n(function(t,n){var a=r&&r.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,o){e.__proto__=o}||function(e,o){for(var t in o)o.hasOwnProperty(t)&&(e[t]=o[t])};return function(o,t){function n(){this.constructor=o}e(o,t),o.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}(),i=function(t){function n(e){return t.call(this,e)||this}return a(n,t),n.prototype.logging=function(e,o){this.processLog(e,o)},n.classAnnations={name:"AnnotationLogerAspect",params:{constructor:["container"],logging:["joinPoint","annotation"]}},__decorate([o.Pointcut("@annotation(Logger)","annotation"),__metadata("design:type",Function),__metadata("design:paramtypes",[o.Joinpoint,Array]),__metadata("design:returntype",void 0)],n.prototype,"logging",null),n=__decorate([e.Singleton(),o.Aspect(),__param(0,e.Inject(e.symbols.IContainer)),__metadata("design:paramtypes",[Object])],n)}(c.LoggerAspect);n.AnnotationLogerAspect=i});t(u);var f=n(function(o,t){t.Logger=e.createClassMethodDecorator("Logger",function(o){o.next({isMetadata:function(o){return e.isClassMetadata(o,["logname"])},match:function(o){return e.isString(o)},setMetadata:function(e,o){e.logname=o}}),o.next({match:function(o){return e.isFunction(o)},setMetadata:function(e,o){e.express=o}}),o.next({match:function(o){return e.isString(o)},setMetadata:function(e,o){e.message=o}})})});t(f);var l=n(function(t,n){var r=function(){function t(e){this.container=e}return t.prototype.setup=function(){var t=this.container;t.has(o.AopModule)||t.register(o.AopModule);t.get(e.symbols.LifeScope).registerDecorator(f.Logger,e.LifeState.onInit,e.CoreActions.bindParameterProviders),t.register(g.ConfigureLoggerManger),t.register(u.AnnotationLogerAspect),t.register(s.ConsoleLogManager)},t.symbols=a.LogSymbols,t.classAnnations={name:"LogModule",params:{constructor:["container"],setup:[]}},t=__decorate([e.IocModule("setup"),__param(0,e.Inject(e.symbols.IContainer)),__metadata("design:paramtypes",[Object])],t)}();n.LogModule=r});t(l);return t(n(function(e,o){function t(e){for(var t in e)o.hasOwnProperty(t)||(o[t]=e[t])}t(a),t(g),t(s),t(i),t(c),t(u),t(f),t(l)}))});
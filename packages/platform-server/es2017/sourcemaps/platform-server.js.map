{"version":3,"file":"../platform-server.js","sources":["toAbsolute.ts","NodeModuleLoader.ts","ContainerBuilder.ts","index.ts"],"sourcesContent":["import { isString } from '@ts-ioc/core';\r\nimport * as path from 'path';\r\n\r\n/**\r\n * convert path to absolute path.\r\n *\r\n * @export\r\n * @param {string} root\r\n * @param {string} pathstr\r\n * @returns {string}\r\n */\r\nexport function toAbsolutePath(root: string, pathstr: string): string {\r\n    if (!root || path.isAbsolute(pathstr)) {\r\n        return pathstr;\r\n    }\r\n    return path.join(root, pathstr);\r\n}\r\n\r\n/**\r\n * convert src to absolute path src.\r\n *\r\n * @export\r\n * @param {string} root\r\n * @param {(string|string[])} src\r\n * @returns {(string|string[])}\r\n */\r\nexport function toAbsoluteSrc(root: string, src: string | string[]): string | string[] {\r\n    if (isString(src)) {\r\n        return prefixSrc(root, src);\r\n    } else {\r\n        return src.map(p => prefixSrc(root, p));\r\n    }\r\n}\r\n\r\nfunction prefixSrc(root: string, strSrc: string): string {\r\n    let prefix = '';\r\n    if (/^!/.test(strSrc)) {\r\n        prefix = '!';\r\n        strSrc = strSrc.substring(1, strSrc.length);\r\n    }\r\n    return prefix + toAbsolutePath(root, strSrc);\r\n}\r\n","import { IModuleLoader, Modules, DefaultModuleLoader } from '@ts-ioc/core';\r\nimport { toAbsoluteSrc } from './toAbsolute';\r\n\r\ndeclare let require: any;\r\n\r\n\r\n\r\n/**\r\n * server nodule loader.\r\n *\r\n * @export\r\n * @class NodeModuleLoader\r\n * @implements {IModuleLoader}\r\n */\r\nexport class NodeModuleLoader extends DefaultModuleLoader implements IModuleLoader {\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    protected loadFile(files: string | string[], basePath?: string): Promise<Modules[]> {\r\n        let globby = require('globby');\r\n        return globby(toAbsoluteSrc(basePath, files)).then((mflies: string[]) => {\r\n            return mflies.map(fp => {\r\n                return require(fp);\r\n            });\r\n        });\r\n    }\r\n\r\n    protected createLoader(): (modulepath: string) => Promise<Modules[]> {\r\n        return (modulepath: string) => Promise.resolve(require(modulepath));\r\n    }\r\n\r\n\n                        static classAnnations:any  = {\"name\":\"NodeModuleLoader\",\"params\":{\"constructor\":[],\"loadFile\":[\"files\",\"basePath\"],\"createLoader\":[]}};\n                   }\r\n","import { IModuleLoader, DefaultContainerBuilder } from '@ts-ioc/core';\r\nimport { NodeModuleLoader } from './NodeModuleLoader';\r\n\r\n/**\r\n * container builder.\r\n *\r\n * @export\r\n * @class ContainerBuilder\r\n * @extends {DefaultContainerBuilder}\r\n */\r\nexport class ContainerBuilder extends DefaultContainerBuilder {\r\n\r\n    constructor(loader?: IModuleLoader) {\r\n        super(loader || new NodeModuleLoader())\r\n    }\r\n\n                        static classAnnations:any  = {\"name\":\"ContainerBuilder\",\"params\":{\"constructor\":[\"loader\"]}};\n                   }\r\n","export * from './NodeModuleLoader';\r\nexport * from './ContainerBuilder';\r\nexport * from './toAbsolute';\r\n\r\n"],"names":["globby","require$$0","toAbsolute_1","require"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAWA,SAAgB,cAAc,CAAC,IAAY,EAAE,OAAe;IACxD,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,EAAE;QACnC,OAAO,OAAO,CAAC;KAClB;IACD,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;CACnC;AALD,wCAKC;;;;;;;;;AAUD,SAAgB,aAAa,CAAC,IAAY,EAAE,GAAsB;IAC9D,IAAI,eAAQ,CAAC,GAAG,CAAC,EAAE;QACf,OAAO,SAAS,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;KAC/B;SAAM;QACH,OAAO,GAAG,CAAC,GAAG,CAAC,CAAC,IAAI,SAAS,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC;KAC3C;CACJ;AAND,sCAMC;AAED,SAAS,SAAS,CAAC,IAAY,EAAE,MAAc;IAC3C,IAAI,MAAM,GAAG,EAAE,CAAC;IAChB,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;QACnB,MAAM,GAAG,GAAG,CAAC;QACb,MAAM,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC;KAC/C;IACD,OAAO,MAAM,GAAG,cAAc,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;CAChD;;;;;;;;;;;;;;;;;;;;;;AC3BD,MAAa,gBAAiB,SAAQ,0BAAmB;IAErD;QACI,KAAK,EAAE,CAAC;KACX;IAES,QAAQ,CAAC,KAAwB,EAAE,QAAiB;QAC1D,IAAIA,SAAM,GAAGC,MAAiB,CAAC;QAC/B,OAAOD,SAAM,CAACE,wBAAa,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,MAAgB;YAChE,OAAO,MAAM,CAAC,GAAG,CAAC,EAAE;gBAChB,OAAOC,eAAO,CAAC,EAAE,CAAC,CAAC;aACtB,CAAC,CAAC;SACN,CAAC,CAAC;KACN;IAES,YAAY;QAClB,OAAO,CAAC,UAAkB,KAAK,OAAO,CAAC,OAAO,CAACA,eAAO,CAAC,UAAU,CAAC,CAAC,CAAC;KACvE;;AAG0B,+BAAc,GAAQ,EAAC,MAAM,EAAC,kBAAkB,EAAC,QAAQ,EAAC,EAAC,aAAa,EAAC,EAAE,EAAC,UAAU,EAAC,CAAC,OAAO,EAAC,UAAU,CAAC,EAAC,cAAc,EAAC,EAAE,EAAC,EAAC,CAAC;AApB/J,4CAqBoB;;;;;;;;;;;;;;;;;;;;;ACzBpB,MAAa,gBAAiB,SAAQ,8BAAuB;IAEzD,YAAY,MAAsB;QAC9B,KAAK,CAAC,MAAM,IAAI,IAAI,mCAAgB,EAAE,CAAC,CAAA;KAC1C;;AAE0B,+BAAc,GAAQ,EAAC,MAAM,EAAC,kBAAkB,EAAC,QAAQ,EAAC,EAAC,aAAa,EAAC,CAAC,QAAQ,CAAC,EAAC,EAAC,CAAC;AANrH,4CAOoB;;;;;;;;;;;;;ACjBpB,kDAAmC;AACnC,kDAAmC;AACnC,0CAA6B;;;;;;;;;;;"}